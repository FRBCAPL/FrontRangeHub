<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dues Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <style>
        .login-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        }
        .main-container {
            min-height: 100vh;
            background: #1a1d29;
            position: relative;
        }
        .main-container::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(79, 70, 229, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(124, 58, 237, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        .container-fluid {
            position: relative;
            z-index: 1;
        }
        .card {
            border: none;
            border-radius: 16px;
            background: #252936;
            backdrop-filter: blur(10px);
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.3),
                0 1px 4px rgba(0, 0, 0, 0.2);
            transition: box-shadow 0.2s ease, transform 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .card:hover {
            box-shadow: 
                0 8px 30px rgba(0, 0, 0, 0.4),
                0 2px 8px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }
        .btn {
            border-radius: 12px;
            font-weight: 600;
            padding: 10px 20px;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            border: none;
        }
        .btn-primary:hover {
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
            opacity: 0.9;
        }
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
        }
        .btn-success:hover {
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            opacity: 0.9;
        }
        .btn-danger {
            background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%);
            border: none;
        }
        .btn-danger:hover {
            box-shadow: 0 4px 15px rgba(244, 63, 94, 0.3);
            opacity: 0.9;
        }
        .btn-info {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            border: none;
        }
        .btn-info:hover {
            box-shadow: 0 4px 15px rgba(14, 165, 233, 0.3);
            opacity: 0.9;
        }
        .status-paid {
            color: #10b981;
            font-weight: 600;
        }
        .status-unpaid {
            color: #ef4444;
            font-weight: 600;
        }
        .text-muted {
            color: #94a3b8 !important;
        }
        .summary-card {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border-radius: 24px;
            position: relative;
            overflow: hidden;
        }
        .summary-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: shimmer 3s infinite;
        }
        @keyframes shimmer {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-20px, -20px) rotate(180deg); }
        }
        .summary-card h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
            position: relative;
            z-index: 1;
        }
        .summary-card h5 {
            font-size: 1rem;
            opacity: 0.95;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }
        .table {
            border-radius: 16px;
            overflow: hidden;
            background: #252936;
            backdrop-filter: blur(10px);
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.3),
                0 1px 4px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .table thead th {
            background: #f8f9fa;
            color: #111827;
            border: none;
            font-weight: 600;
            padding: 18px 16px;
            text-transform: none;
            font-size: 0.9rem;
            letter-spacing: 0.2px;
            text-align: center;
            position: relative;
            border-bottom: 2px solid rgba(79, 70, 229, 0.3);
        }
        /* Keep "Day of Play" header/value on a single line (avoid wrapping after stacking division names) */
        .table thead th:nth-child(3),
        .table tbody td:nth-child(3) {
            white-space: nowrap;
            min-width: 120px;
        }
        /* Reduce perceived gap between Division (col 2) and Day of Play (col 3) */
        .table thead th:nth-child(2),
        .table tbody td:nth-child(2) {
            padding-right: 8px;
            width: 150px;
            max-width: 150px;
        }
        .table thead th:nth-child(3),
        .table tbody td:nth-child(3) {
            padding-left: 8px;
        }

        /* Keep Division column compact even with stacked (double-play) names */
        .table tbody td:nth-child(2) .division-badge {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            max-width: 140px;
        }
        .table thead th::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(79, 70, 229, 0.5), transparent);
        }
        .table tbody td {
            padding: 16px;
            vertical-align: middle;
            border-color: rgba(255, 255, 255, 0.05);
            background: #252936;
            color: #e2e8f0;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        /* BCA Status Styling */
        .bca-status-container {
            min-width: 120px;
        }
        
        .bca-status-container .btn-group {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .bca-status-container .btn-check:checked + .btn {
            box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.25);
        }
        
        .bca-status-container .btn-check:checked + .btn-outline-warning {
            background-color: #ffc107;
            border-color: #ffc107;
            color: #000;
        }
        
        .bca-status-container .btn-check:checked + .btn-outline-success {
            background-color: #198754;
            border-color: #198754;
            color: #fff;
        }
        
        .bca-status-container .btn-check:checked + .btn-outline-info {
            background-color: #0dcaf0;
            border-color: #0dcaf0;
            color: #000;
        }
        .table tbody tr {
            transition: background-color 0.15s ease;
        }
        .table tbody tr:hover {
            background: rgba(79, 70, 229, 0.15);
        }
        .table tbody tr:hover td {
            background: transparent;
            color: #ffffff;
        }
        .badge {
            border-radius: 12px;
            font-weight: 600;
            padding: 8px 14px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            letter-spacing: 0.3px;
        }
        .form-control, .form-select {
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 18px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: #2d3142;
            color: #e2e8f0;
            font-weight: 500;
        }
        .form-control:focus, .form-select:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
            background: #353849;
            color: #ffffff;
        }
        .form-control::placeholder, .form-select::placeholder {
            color: rgba(226, 232, 240, 0.5);
        }
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .navbar {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%) !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .navbar-brand {
            font-weight: 700;
            font-size: 1.4rem;
            color: #e2e8f0 !important;
            text-align: center;
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .member-card {
            transition: box-shadow 0.2s;
        }
        .member-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .hidden {
            display: none !important;
        }

        /* Theme support (default = dark; add body.theme-light for light mode) */
        /* Dark theme defaults (fix unreadable black text) */
        body:not(.theme-light) {
            color: #e2e8f0;
        }
        body:not(.theme-light) .card-body {
            color: #e2e8f0;
        }
        body:not(.theme-light) .main-container h1,
        body:not(.theme-light) .main-container h2,
        body:not(.theme-light) .main-container h3,
        body:not(.theme-light) .main-container h4,
        body:not(.theme-light) .main-container h5,
        body:not(.theme-light) .main-container h6 {
            color: #e2e8f0;
        }
        body:not(.theme-light) .text-dark {
            color: #e2e8f0 !important;
        }
        body:not(.theme-light) .bg-warning.text-dark,
        body:not(.theme-light) .bg-light,
        body:not(.theme-light) .modal-footer.bg-light,
        body:not(.theme-light) .input-group-text.bg-white {
            background: #2d3142 !important;
            color: #e2e8f0 !important;
            border-color: rgba(255, 255, 255, 0.1) !important;
        }
        body:not(.theme-light) .form-control.bg-light {
            background: #2d3142 !important;
            color: #e2e8f0 !important;
        }
        body:not(.theme-light) .input-group-text {
            background: #2d3142 !important;
            color: #e2e8f0 !important;
            border-color: rgba(255, 255, 255, 0.1) !important;
        }
        /* Dark mode: modals (Edit Team, Weekly Payment, etc.) */
        body:not(.theme-light) .modal-content {
            background-color: #252936 !important;
            color: #e2e8f0 !important;
            border-color: rgba(255, 255, 255, 0.12) !important;
        }
        body:not(.theme-light) .modal-header,
        body:not(.theme-light) .modal-footer {
            background: #2d3142 !important;
            color: #e2e8f0 !important;
            border-color: rgba(255, 255, 255, 0.12) !important;
        }
        body:not(.theme-light) .modal-title {
            color: #e2e8f0 !important;
        }
        body:not(.theme-light) .modal-body {
            color: #e2e8f0 !important;
        }
        body:not(.theme-light) .modal .form-label,
        body:not(.theme-light) .modal label {
            color: rgba(226, 232, 240, 0.85) !important;
        }
        body:not(.theme-light) .modal .text-muted {
            color: rgba(226, 232, 240, 0.65) !important;
        }
        body:not(.theme-light) .btn-close {
            filter: invert(1) grayscale(100%);
            opacity: 0.85;
        }
        body:not(.theme-light) .btn-close:hover {
            opacity: 1;
        }
        body:not(.theme-light) #teamMembersContainer {
            border-color: rgba(255, 255, 255, 0.12) !important;
        }
        body:not(.theme-light) .modal .alert-info {
            background: rgba(56, 189, 248, 0.12) !important;
            color: #e2e8f0 !important;
            border-color: rgba(56, 189, 248, 0.25) !important;
        }
        body:not(.theme-light) .modal .card.bg-light {
            background: #2d3142 !important;
            border-color: rgba(255, 255, 255, 0.12) !important;
        }
        body:not(.theme-light) .modal input[readonly],
        body:not(.theme-light) .modal input:disabled {
            background: #1f2433 !important;
            color: rgba(226, 232, 240, 0.85) !important;
            border-color: rgba(255, 255, 255, 0.12) !important;
            opacity: 1 !important;
        }

        /* Dark mode: Division Management modal table (ensure text is always visible, not only on hover) */
        body:not(.theme-light) #divisionManagementModal .table td,
        body:not(.theme-light) #divisionManagementModal .table th {
            color: #e2e8f0 !important;
        }
        body:not(.theme-light) #divisionManagementModal .table thead th {
            background: #2d3142 !important;
            color: #e2e8f0 !important;
        }
        body:not(.theme-light) #divisionManagementModal .table-striped > tbody > tr:nth-of-type(odd) > * {
            background-color: #252936 !important;
            color: #e2e8f0 !important;
        }
        body:not(.theme-light) #divisionManagementModal .table-striped > tbody > tr:nth-of-type(even) > * {
            background-color: #2d3142 !important;
            color: #e2e8f0 !important;
        }
        body:not(.theme-light) #divisionManagementModal .text-muted {
            color: rgba(226, 232, 240, 0.7) !important;
        }

        /* Dark mode: Payment History modal table (fix odd rows appearing "blank") */
        body:not(.theme-light) #paymentHistoryModal .table td,
        body:not(.theme-light) #paymentHistoryModal .table th {
            color: #e2e8f0 !important;
        }
        body:not(.theme-light) #paymentHistoryModal .table thead th,
        body:not(.theme-light) #paymentHistoryModal .table thead.table-dark th {
            background: #2d3142 !important;
            color: #e2e8f0 !important;
            border-color: rgba(255, 255, 255, 0.12) !important;
        }
        body:not(.theme-light) #paymentHistoryModal .table-striped > tbody > tr:nth-of-type(odd) > * {
            background-color: #252936 !important;
            color: #e2e8f0 !important;
        }
        body:not(.theme-light) #paymentHistoryModal .table-striped > tbody > tr:nth-of-type(even) > * {
            background-color: #2d3142 !important;
            color: #e2e8f0 !important;
        }
        body:not(.theme-light) #paymentHistoryModal .text-muted,
        body:not(.theme-light) #paymentHistoryModal small.text-muted {
            color: rgba(226, 232, 240, 0.7) !important;
        }
        /* Card headers are light colored; in dark mode force header text to dark so it isn't white-on-white */
        body:not(.theme-light) .card-header,
        body:not(.theme-light) .card-header h1,
        body:not(.theme-light) .card-header h2,
        body:not(.theme-light) .card-header h3,
        body:not(.theme-light) .card-header h4,
        body:not(.theme-light) .card-header h5,
        body:not(.theme-light) .card-header h6 {
            color: #111827 !important;
        }
        /* Dark mode table header - light background with dark text for readability */
        body:not(.theme-light) .table thead th {
            background: #f8f9fa !important;
            color: #111827 !important;
        }

        body.theme-light {
            color: #111827;
        }
        body.theme-light .main-container {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 50%, #e2e8f0 100%);
        }
        body.theme-light .main-container::before {
            background:
                radial-gradient(circle at 20% 50%, rgba(79, 70, 229, 0.04) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(124, 58, 237, 0.04) 0%, transparent 50%);
        }
        body.theme-light .navbar {
            background: #1e293b !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.12);
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
        }
        body.theme-light .card {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.06);
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.06),
                0 2px 8px rgba(0, 0, 0, 0.04);
        }
        body.theme-light .card-header {
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
            color: #111827;
        }
        body.theme-light .card-body {
            color: #111827;
        }
        body.theme-light .text-muted {
            color: #64748b !important;
        }
        body.theme-light .table {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.06);
        }
        body.theme-light .table thead th {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: #ffffff;
            border-bottom: none;
        }
        body.theme-light .table tbody td {
            background: rgba(255, 255, 255, 0.6);
            color: #111827;
            border-color: rgba(0, 0, 0, 0.06);
        }
        body.theme-light .table tbody tr:hover {
            background: rgba(79, 70, 229, 0.03);
        }
        body.theme-light .form-control,
        body.theme-light .form-select {
            background: rgba(255, 255, 255, 0.95);
            color: #111827;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        body.theme-light .form-control::placeholder {
            color: rgba(100, 116, 139, 0.9);
        }
        body.theme-light .form-control:focus,
        body.theme-light .form-select:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.18);
            background: #ffffff;
            color: #111827;
        }
        .container-fluid {
            max-width: 2500px !important;
            width: 100% !important;
        }
        
        /* Force wider layout */
        body .container-fluid {
            max-width: 2500px !important;
        }
        
        /* Target the specific container in the main app */
        #mainApp .container-fluid {
            max-width: 2500px !important;
            width: 100% !important;
        }
        
        /* Nuclear option - override everything */
        .main-container .container-fluid {
            max-width: 2500px !important;
            width: 100% !important;
        }
        
        /* Override global CSS constraints */
        #mainApp {
            max-width: none !important;
            width: 100vw !important;
        }
        
        .main-container {
            max-width: none !important;
            width: 100vw !important;
        }
        
        /* Override the global max-width unset rule */
        .main-container * {
            max-width: unset !important;
        }
        
        .main-container .container-fluid {
            max-width: 3500px !important;
        }
        
        /* Ensure action buttons don't get cut off */
        .table-responsive {
            overflow-x: auto;
        }
        
        /* Make sure action column has enough space */
        .table th:last-child, .table td:last-child {
            min-width: 120px;
            white-space: nowrap;
        }
        
        /* Make Division column narrower */
        .table th:nth-child(2), .table td:nth-child(2) { 
            width: 15%; /* Reduced from default */
            max-width: 15%;
        }
        
        /* Division color buttons */
        .division-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
            white-space: normal;
            overflow: visible;
            max-width: 100%;
            line-height: 1.4;
        }
        
        /* Division color schemes */
        .division-nay-nay { background: #e91e63; color: white; }
        .division-3310 { background: #2196f3; color: white; }
        .division-tuesday { background: #4caf50; color: white; }
        .division-wednesday { background: #ff9800; color: white; }
        .division-thursday { background: #9c27b0; color: white; }
        .division-friday { background: #f44336; color: white; }
        .division-saturday { background: #00bcd4; color: white; }
        .division-sunday { background: #795548; color: white; }
        .division-default { background: #607d8b; color: white; }
        
        /* Make players modal wider */
        #playersModal .modal-dialog {
            max-width: 95vw;
            width: 95vw;
        }
        
        @media (min-width: 1200px) {
            #playersModal .modal-dialog {
                max-width: 90vw;
                width: 90vw;
            }
        }
        .card-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 2px solid #dee2e6;
            font-weight: 600;
        }
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.875rem;
        }
        .btn-group .btn {
            border-radius: 0;
        }
        .btn-group .btn:first-child {
            border-top-left-radius: 8px;
            border-bottom-left-radius: 8px;
        }
        .btn-group .btn:last-child {
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
        }
        .form-select {
            position: relative;
        }
        .form-select:focus {
            z-index: 3;
        }
        /* Force select dropdown to open downward */
        select.form-select {
            background-position: right 0.75rem center !important;
        }
        /* Override any Bootstrap dropdown positioning */
        .dropdown-menu {
            transform: none !important;
            top: 100% !important;
            bottom: auto !important;
        }
        /* Ensure select elements open downward */
        select {
            direction: ltr;
        }
        
        /* Fix modal positioning to center on viewport */
        .modal {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            z-index: 1055 !important;
            display: none !important;
        }
        
        .modal.show {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        .modal-dialog {
            position: relative !important;
            width: auto !important;
            margin: 0 !important;
            pointer-events: none !important;
        }
        
        .modal-content {
            position: relative !important;
            display: flex !important;
            flex-direction: column !important;
            width: 100% !important;
            pointer-events: auto !important;
            background-color: #fff !important;
            background-clip: padding-box !important;
            border: 1px solid rgba(0,0,0,.2) !important;
            border-radius: 0.3rem !important;
            outline: 0 !important;
        }
        
        .modal-backdrop {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            z-index: 1050 !important;
            width: 100vw !important;
            height: 100vh !important;
            background-color: #000 !important;
        }
        
        /* Ensure modals and their content appear above all select dropdowns */
        .modal.show {
            z-index: 1055 !important;
        }
        
        .modal.show .modal-dialog {
            z-index: 1056 !important;
        }
        
        .modal.show .modal-content {
            z-index: 1057 !important;
        }
        
        /* Lower z-index for select dropdowns when modal is open */
        .modal.show ~ * select,
        body.modal-open select {
            z-index: 1 !important;
        }
        
        /* Hide week filter when modal is open */
        body.modal-open #weekFilter,
        body.modal-open label[for="weekFilter"] {
            display: none !important;
        }
        
        /* Modal size overrides with proper centering */
        .modal-dialog:not(.modal-lg):not(.modal-xl) {
            max-width: 500px !important;
        }
        
        .modal-dialog.modal-lg {
            max-width: 800px !important;
        }
        
        /* Specific override for weekly payment modal */
        #weeklyPaymentModal .modal-dialog {
            max-width: 800px !important;
            width: 800px !important;
        }
        
        /* Even more specific override */
        .modal#weeklyPaymentModal .modal-dialog.modal-lg {
            max-width: 800px !important;
            width: 800px !important;
        }
        
        .modal-dialog.modal-xl {
            max-width: 1140px !important;
        }
        
        /* Ensure all modals are centered regardless of size */
        .modal.show .modal-dialog {
            transform: none !important;
            margin: 0 !important;
            max-height: calc(100vh - 2rem) !important;
            overflow-y: auto !important;
        }
        
        /* Compact payment history table */
        #paymentHistoryModal .table td {
            padding: 0.25rem 0.5rem !important;
            vertical-align: middle !important;
        }
        
        #paymentHistoryModal .table th {
            padding: 0.5rem !important;
            font-size: 0.875rem !important;
        }
        
        #paymentHistoryModal .badge-sm {
            font-size: 0.75rem !important;
            padding: 0.25rem 0.5rem !important;
        }
        /* Force weekly payment modal to be wider - highest priority */
        #weeklyPaymentModal .modal-dialog {
            max-width: 1000px !important;
            width: 1000px !important;
        }
        
        /* Payment History Modal - same as weekly payment modal */
        #paymentHistoryModal .modal-dialog {
            max-width: 100px !important;
            width: 100px !important;
        }
        
        .modal#paymentHistoryModal .modal-dialog.modal-lg {
            max-width: 1000px !important;
            width: 1000px !important;
        }
        
        /* Sortable column styles */
        .sortable-column {
            user-select: none;
            transition: background-color 0.2s ease;
        }
        
        .sortable-column:hover {
            background-color: rgba(255, 255, 255, 0.1) !important;
        }
        
        .sort-icon {
            margin-left: 5px;
            font-size: 0.8em;
            opacity: 0.7;
        }
        
        .sortable-column:hover .sort-icon {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Login/Register Screen -->
    <div id="loginScreen" class="login-container d-flex align-items-center justify-content-center hidden">
        <div class="card p-4" style="width: 450px;">
            <div class="text-center mb-4">
                <a href="/" class="text-decoration-none text-muted mb-2 d-block" style="font-size: 0.9rem;">
                    <i class="fas fa-arrow-left me-1"></i>Back to Homepage
                </a>
                <i class="fas fa-pool fa-3x text-primary mb-3"></i>
                <h2 id="loginScreenTitle">Dues Tracker</h2>
                <p class="text-muted">For League Operators</p>
            </div>
            
            <!-- Toggle between Login and Register -->
            <ul class="nav nav-pills nav-justified mb-4" id="authTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="login-tab" data-bs-toggle="pill" data-bs-target="#loginPane" type="button" role="tab">Login</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="register-tab" data-bs-toggle="pill" data-bs-target="#registerPane" type="button" role="tab">Sign Up</button>
                </li>
            </ul>
            
            <div class="tab-content" id="authTabContent">
                <!-- Login Form -->
                <div class="tab-pane fade show active" id="loginPane" role="tabpanel">
                    <!-- Google Sign In Button -->
                    <button type="button" class="btn btn-outline-danger w-100 mb-3" onclick="signInWithGoogle()" style="border: 2px solid #db4437; color: #db4437;">
                        <i class="fab fa-google me-2"></i>Continue with Google
                    </button>
                    
                    <div class="text-center my-3">
                        <small class="text-muted">OR</small>
                    </div>
                    
                    <!-- Email/Password Login -->
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-sign-in-alt me-2"></i>Login
                        </button>
                    </form>
                    <div id="loginError" class="alert alert-danger mt-3 hidden" role="alert"></div>
                </div>
                
                <!-- Registration Form -->
                <div class="tab-pane fade" id="registerPane" role="tabpanel">
                    <!-- Google Sign Up Button -->
                    <button type="button" class="btn btn-outline-danger w-100 mb-3" onclick="signUpWithGoogle()" style="border: 2px solid #db4437; color: #db4437;">
                        <i class="fab fa-google me-2"></i>Sign Up with Google
                    </button>
                    
                    <div class="text-center my-3">
                        <small class="text-muted">OR</small>
                    </div>
                    
                    <!-- Email/Password Registration -->
                    <form id="registerForm">
                        <div class="mb-3">
                            <label for="regName" class="form-label">Your Name</label>
                            <input type="text" class="form-control" id="regName" required>
                        </div>
                        <div class="mb-3">
                            <label for="regEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="regEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="regPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="regPassword" required minlength="6">
                            <small class="text-muted">Minimum 6 characters</small>
                        </div>
                        <div class="mb-3">
                            <label for="regOrgName" class="form-label">Organization/League Name (Optional)</label>
                            <input type="text" class="form-control" id="regOrgName">
                        </div>
                        <button type="submit" class="btn btn-success w-100">
                            <i class="fas fa-user-plus me-2"></i>Create Account
                        </button>
                    </form>
                    <div id="registerError" class="alert alert-danger mt-3 hidden" role="alert"></div>
                    <div id="registerSuccess" class="alert alert-success mt-3 hidden" role="alert">
                        Account created! You can now login.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-container">
        <!-- Navigation -->
        <nav class="navbar navbar-dark bg-dark">
            <div class="container-fluid d-flex align-items-center">
                <div style="flex: 1;"></div>
                <span class="navbar-brand mb-0 h1" id="navbarBrand" style="flex: 1; text-align: center;">
                    <i class="fas fa-pool me-2"></i>Dues Tracker
                </span>
                <div class="d-flex align-items-center gap-3" style="flex: 1; justify-content: flex-end;">
                    <!-- Local Clock -->
                    <div id="localClock" style="
                        background: rgba(255, 255, 255, 0.1);
                        border: 1px solid rgba(255, 255, 255, 0.2);
                        border-radius: 8px;
                        padding: 6px 12px;
                        font-family: 'Courier New', monospace;
                        font-size: 0.9rem;
                        min-width: 200px;
                        text-align: center;
                    ">
                        <div id="clockTime" style="font-weight: bold; color: #10b981; font-size: 0.95rem;"></div>
                        <div id="clockDate" style="font-size: 0.75rem; color: #ffffff; opacity: 0.9; margin-top: 2px;"></div>
                    </div>
                    <button class="btn btn-outline-light btn-sm" onclick="showProfileModal()" title="Profile & Settings">
                        <i class="fas fa-user-cog me-1"></i>Settings
                    </button>
                    <button class="btn btn-outline-light" onclick="logout()">
                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                    </button>
                </div>
            </div>
        </nav>

        <div class="container-fluid px-4 pt-2 pb-4">
            <!-- Overview Section -->
            <div class="row mb-3">
                <div class="col-12 mb-2">
                    <h5 class="text-muted mb-0"><i class="fas fa-chart-line me-2"></i>Overview</h5>
                </div>
                <div class="col-md-3 mb-2">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-users fa-2x text-primary me-2"></i>
                            </div>
                            <h6 class="text-muted mb-1 small text-uppercase">Total Teams</h6>
                            <h3 class="mb-0 fw-bold" id="totalTeams">0</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-2">
                    <div class="card border-0 shadow-sm h-100 bg-danger text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-exclamation-triangle fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75">Teams Behind</h6>
                            <h3 class="mb-0 fw-bold" id="unpaidTeams">0</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-2">
                    <div class="card border-0 shadow-sm h-100 bg-info text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-dollar-sign fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75">Total Collected</h6>
                            <h3 class="mb-0 fw-bold" id="totalCollected">$0</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-2" id="divisionSpecificSummary" style="display: none;">
                    <div class="card border-0 shadow-sm h-100 bg-primary text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-layer-group fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75" id="divisionSpecificTitle">Division</h6>
                            <h3 class="mb-0 fw-bold" id="divisionSpecificCollected">$0</h3>
                            <small class="opacity-75" id="divisionSpecificSubtitle">Division total</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Financial Breakdown Section -->
            <div class="row mb-4">
                <div class="col-12 mb-3">
                    <h5 class="text-muted mb-0 fw-bold" style="font-size: 1.1rem; letter-spacing: 0.5px;">
                        <i class="fas fa-money-bill-wave me-2" style="color: #4f46e5;"></i>Financial Breakdown
                    </h5>
                </div>
                <div class="col-md-3 mb-2">
                    <div class="card border-0 shadow-sm h-100 bg-warning text-dark">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-trophy fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75">Prize Fund</h6>
                            <h4 class="mb-0 fw-bold" id="totalPrizeFund">$0</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-2">
                    <div class="card border-0 shadow-sm h-100 bg-success text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-user-tie fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75">League Income</h6>
                            <h4 class="mb-0 fw-bold" id="totalLeagueManager">$0</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-2">
                    <div class="card border-0 shadow-sm h-100 bg-info text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-flag fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75">CSI</h6>
                            <h4 class="mb-0 fw-bold" id="totalUSAPoolLeague">$0</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-2">
                    <div class="card border-0 shadow-sm h-100 bg-secondary text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-certificate fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75">
                                <span id="sanctionFeesCardTitle">Sanction Fees</span>
                                <button class="btn btn-sm btn-link text-white p-0 ms-1" type="button" data-bs-toggle="collapse" data-bs-target="#sanctionFeesDetails" aria-expanded="false" aria-controls="sanctionFeesDetails" style="text-decoration: none; font-size: 0.7rem;">
                                    <i class="fas fa-chevron-down" id="sanctionFeesChevron"></i>
                                </button>
                            </h6>
                            <h4 class="mb-0 fw-bold" id="totalBCASanctionFees">$0</h4>
                            <div class="collapse" id="sanctionFeesDetails">
                                <div class="text-start mt-2 pt-2 border-top border-white border-opacity-25" style="font-size: 0.75rem;">
                                    <div class="mb-1"><strong>Total:</strong> $<span id="sanctionFeesTotal">0.00</span></div>
                                    <div class="mb-1" style="color: #90EE90;"><strong>Paid:</strong> $<span id="sanctionFeesPaid">0.00</span></div>
                                    <div class="mb-1 text-warning"><strong>Owed:</strong> $<span id="sanctionFeesOwed">0.00</span></div>
                                    <div class="mb-1"><strong>To Payout:</strong> $<span id="sanctionFeesToPayout">0.00</span></div>
                                    <div class="mb-0 fw-bold" style="color: #90EE90;"><strong>Profit:</strong> $<span id="sanctionFeesProfit">0.00</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Division Breakdown -->


            <!-- Horizontal Controls Bar -->
            <div class="row mb-3">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body py-3">
                            <div class="row align-items-center">
                                <div class="col-md-3">
                                    <label for="divisionFilter" class="form-label fw-bold mb-1" style="color: #cbd5e1;">
                                        <i class="fas fa-filter me-1"></i>Division
                                    </label>
                                    <select class="form-select form-select-sm" id="divisionFilter" onchange="filterTeamsByDivision()">
                                        <option value="all">All Teams</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="weekFilter" class="form-label fw-bold mb-1" style="color: #cbd5e1;">
                                        <i class="fas fa-calendar-week me-1"></i>Week
                                    </label>
                                    <select class="form-select form-select-sm" id="weekFilter" onchange="updateWeekDisplay()">
                                        <option value="1">Week 1</option>
                                        <option value="2">Week 2</option>
                                        <option value="3">Week 3</option>
                                        <option value="4">Week 4</option>
                                        <option value="5">Week 5</option>
                                        <option value="6">Week 6</option>
                                        <option value="7">Week 7</option>
                                        <option value="8">Week 8</option>
                                        <option value="9">Week 9</option>
                                        <option value="10">Week 10</option>
                                        <option value="11">Week 11</option>
                                        <option value="12">Week 12</option>
                                        <option value="13">Week 13</option>
                                        <option value="14">Week 14</option>
                                        <option value="15">Week 15</option>
                                        <option value="16">Week 16</option>
                                        <option value="17">Week 17</option>
                                        <option value="18">Week 18</option>
                                        <option value="19">Week 19</option>
                                        <option value="20">Week 20</option>
                                        <option value="21">Week 21</option>
                                        <option value="22">Week 22</option>
                                        <option value="23">Week 23</option>
                                        <option value="24">Week 24</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-bold mb-1">
                                        <i class="fas fa-tools me-1"></i>Actions
                                    </label>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-primary btn-sm" onclick="showAddTeamModal()">
                                            <i class="fas fa-plus me-1"></i>Add Team
                                        </button>
                                        <button class="btn btn-success btn-sm" onclick="showSmartBuilderModal()">
                                            <i class="fas fa-magic me-1"></i>Smart Builder
                                        </button>
                                        <button class="btn btn-info btn-sm" onclick="showDivisionManagement()">
                                            <i class="fas fa-cogs me-1"></i>Divisions
                                        </button>
                                        <button class="btn btn-warning btn-sm" onclick="showPlayersView()">
                                            <i class="fas fa-users me-1"></i>Players
                                        </button>
                                        <button class="btn btn-success btn-sm" onclick="refreshData()">
                                            <i class="fas fa-sync-alt me-1"></i>Refresh
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Teams List -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-center align-items-center">
                            <h5 class="mb-0 text-center">
                                <span class="d-inline-flex align-items-center gap-5">
                                    <i class="fas fa-users"></i>
                                    <span id="teamsSectionTitleText">League Teams</span>
                                    <span class="badge bg-primary fs-6" id="teamCount">0 Teams</span>
                                </span>
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th class="sortable-column" onclick="sortTable('teamName')" style="cursor: pointer;">
                                                Team Name
                                                <i class="fas fa-sort sort-icon" id="sort-icon-teamName"></i>
                                            </th>
                                            <th class="sortable-column" onclick="sortTable('division')" style="cursor: pointer;">
                                                Division
                                                <i class="fas fa-sort sort-icon" id="sort-icon-division"></i>
                                            </th>
                                            <th class="sortable-column" onclick="sortTable('dayOfPlay')" style="cursor: pointer;">
                                                <span class="d-inline-flex align-items-center gap-1">
                                                    Day of Play
                                                    <i class="fas fa-sort sort-icon" id="sort-icon-dayOfPlay"></i>
                                                </span>
                                            </th>
                                            <th>Players</th>
                                            <th>BCA Status</th>
                                            <th>
                                                Dues Owed
                                                <i class="fas fa-info-circle" data-bs-toggle="tooltip" data-bs-placement="top" 
                                                   title="Total amount currently owed: Weekly dues for unpaid weeks (dues per player  players per week  matches per week  unpaid weeks)"></i>
                                            </th>
                                            <th class="sortable-column" onclick="sortTable('status')" style="cursor: pointer;">
                                                Status
                                                <i class="fas fa-sort sort-icon" id="sort-icon-status"></i>
                                            </th>
                                            <th>Payment Date</th>
                                            <th>Week <span id="currentWeekDisplay">1</span> Payment</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="teamsTable">
                                        <!-- Teams will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Team Modal -->
    <div class="modal fade" id="addTeamModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Team</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto;">
                    <form id="addTeamForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-2">
                                    <label for="teamName" class="form-label small">Team Name *</label>
                                    <input type="text" class="form-control form-control-sm" id="teamName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-2">
                                    <label for="division" class="form-label small">Division *</label>
                                    <select class="form-select form-select-sm" id="division" required onchange="updateDuesCalculation()">
                                        <option value="">Select Division</option>
                                        <!-- Divisions will be loaded dynamically -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <h6 class="mt-2 mb-2 small fw-bold">Team Captain</h6>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="captainName" class="form-label small">Captain Name *</label>
                                    <select class="form-select form-select-sm" id="captainName" required>
                                        <option value="">Select Captain</option>
                                        <!-- Team members will be populated dynamically -->
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="captainEmail" class="form-label small">Captain Email</label>
                                    <input type="email" class="form-control form-control-sm" id="captainEmail">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="captainPhone" class="form-label small">Captain Phone</label>
                                    <input type="tel" class="form-control form-control-sm" id="captainPhone">
                                </div>
                            </div>
                        </div>
                        
                        <h6 class="mt-2 mb-1 small fw-bold">Team Members</h6>
                        <div class="alert alert-info py-1 mb-2" style="font-size: 0.75rem;">
                            <i class="fas fa-info-circle me-1"></i><strong>Dues:</strong> Rate  players  weeks = total dues
                        </div>
                        <div id="teamMembersContainer" style="max-height: 250px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 8px;">
                            <div class="row mb-2 member-row">
                                <div class="col-md-4">
                                    <input type="text" class="form-control form-control-sm" placeholder="Player name" name="memberName" oninput="updateDuesCalculation()" onblur="handleNameInputBlur(this)">
                                </div>
                                <div class="col-md-3">
                                    <input type="email" class="form-control form-control-sm" placeholder="Email (optional)" name="memberEmail">
                                </div>
                                <div class="col-md-4">
                                    <div class="bca-status-container">
                                        <div class="btn-group w-100" role="group" title="BCA Status: Pending/Paid = $25 fee | Previously = Already sanctioned">
                                            <input type="radio" class="btn-check" name="bcaSanctionPaid" id="bcaPending" value="false" checked>
                                            <label class="btn btn-outline-warning btn-sm" for="bcaPending">
                                                <i class="fas fa-clock"></i> Pending
                                            </label>
                                            
                                            <input type="radio" class="btn-check" name="bcaSanctionPaid" id="bcaPaid" value="true">
                                            <label class="btn btn-outline-success btn-sm" for="bcaPaid">
                                                <i class="fas fa-check"></i> Paid
                                            </label>
                                            
                                            <input type="radio" class="btn-check" name="bcaSanctionPaid" id="bcaPreviously" value="previously">
                                            <label class="btn btn-outline-info btn-sm" for="bcaPreviously">
                                                <i class="fas fa-history"></i> Previously
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-1">
                                    <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeMember(this)" title="Remove member">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-primary mt-1" onclick="addTeamMember()">
                            <i class="fas fa-plus me-1"></i>Add Member
                        </button>
                        <div id="duesCalculation" class="mt-1">
                            <small class="text-muted" style="font-size: 0.75rem;">Total dues calculated automatically</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addTeam()">Add Team</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Smart Builder Modal -->
    <div class="modal fade" id="smartBuilderModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-magic me-2"></i>Smart Team & Division Builder
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Step 1: Data Source Selection -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-database me-2"></i>Step 1: Choose Data Source
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="dataSource" id="fargoRate" value="fargo" checked>
                                                <label class="form-check-label" for="fargoRate">
                                                    <strong>Fargo Rate Public Reports</strong>
                                                    <br><small class="text-muted">Import teams and divisions from Fargo Rate standings</small>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="dataSource" id="manualEntry" value="manual">
                                                <label class="form-check-label" for="manualEntry">
                                                    <strong>Manual Entry</strong>
                                                    <br><small class="text-muted">Create teams and divisions manually</small>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 1.5: Update Mode Selection -->
                    <div class="row mb-4" id="updateModeSection">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-cogs me-2"></i>Step 1.5: Choose Update Mode
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="updateMode" id="createNew" value="create" checked>
                                                <label class="form-check-label" for="createNew">
                                                    <strong>Create New Division</strong>
                                                    <br><small class="text-muted">Create a new division with teams</small>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="updateMode" id="updateExisting" value="update">
                                                <label class="form-check-label" for="updateExisting">
                                                    <strong>Update Existing Division</strong>
                                                    <br><small class="text-muted">Complete roster data for existing division</small>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Fargo Rate Configuration -->
                    <div id="fargoConfig" class="row mb-4">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-cog me-2"></i>Step 2: Fargo Rate Configuration
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-12">
                                            <label for="fargoLeagueUrl" class="form-label">Fargo Rate League Reports URL</label>
                                            <input type="url" class="form-control" id="fargoLeagueUrl" placeholder="https://lms.fargorate.com/PublicReport/LeagueReports?leagueId=...">
                                            <small class="form-text text-muted">
                                                Copy the URL from your Fargo Rate league reports page (any division URL will work). 
                                                <br><strong>Example:</strong> https://lms.fargorate.com/PublicReport/LeagueReports?leagueId=e05896bb-b0f4-4a80-bf99-b2ca012ceaaa&divisionId=b345a437-3415-4765-b19a-b2f7014f2cfa
                                            </small>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-12">
                                            <button class="btn btn-primary" onclick="fetchFargoDivisions()">
                                                <i class="fas fa-magic me-2"></i>Import from Fargo Rate
                                            </button>
                                            <div id="fargoLoading" class="spinner-border spinner-border-sm ms-2 d-none" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <small class="form-text text-muted d-block mt-2">
                                                <strong>Tip:</strong> Just paste the URL above and click "Import from Fargo Rate". The app will automatically extract the division and teams!
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2.5: Division Selection -->
                    <div id="divisionSelectionSection" class="row mb-4" style="display: none;">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-trophy me-2"></i>Step 2.5: Select Division
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="selectedDivision" class="form-label">Choose Division to Import</label>
                                            <select class="form-select" id="selectedDivision" onchange="onDivisionSelected()">
                                                <option value="">Select a division...</option>
                                            </select>
                                            <small class="form-text text-muted">
                                                Select the division you want to import teams from.
                                            </small>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="manualDivisionId" class="form-label">Or Enter Division ID Manually</label>
                                            <input type="text" class="form-control" id="manualDivisionId" placeholder="Enter division ID from URL">
                                            <small class="form-text text-muted">
                                                If the dropdown doesn't work, enter the divisionId from your Fargo Rate URL.
                                            </small>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-12">
                                            <button class="btn btn-success" onclick="fetchSelectedDivisionTeams()" id="fetchTeamsBtn">
                                                <i class="fas fa-download me-2"></i>Fetch Teams for Division
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2.6: Fargo Rate Teams Preview -->
                    <div id="fargoTeamsSection" class="row mb-4" style="display: none;">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-eye me-2"></i>Step 2.6: Fargo Rate Teams Found
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Team Name</th>
                                                    <th>Captain</th>
                                                    <th>Players</th>
                                                    <th>Total Players</th>
                                                </tr>
                                            </thead>
                                            <tbody id="fargoTeamsPreview">
                                                <!-- Fargo Rate teams will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-12">
                                            <button class="btn btn-primary" onclick="showDivisionSelection()">
                                                <i class="fas fa-arrow-right me-2"></i>Continue to Division Selection
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2.7: Existing Division Selection -->
                    <div id="existingDivisionSection" class="row mb-4" style="display: none;">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-search me-2"></i>Step 2.7: Select Division to Update
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-12">
                                            <label for="existingDivisionSelect" class="form-label">Choose Division to Update</label>
                                            <select class="form-select" id="existingDivisionSelect">
                                                <option value="">Loading existing divisions...</option>
                                            </select>
                                            <small class="form-text text-muted">
                                                Select the division you want to update with the Fargo Rate roster data.
                                            </small>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <button class="btn btn-primary" onclick="loadExistingDivisionTeams()">
                                                <i class="fas fa-sync me-2"></i>Load Division Teams
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2.8: Merge Confirmation -->
                    <div id="mergeConfirmationSection" class="row mb-4" style="display: none;">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-exchange-alt me-2"></i>Step 2.8: Confirm Team Merge
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Action</th>
                                                    <th>Fargo Rate Team</th>
                                                    <th>Existing Team</th>
                                                    <th>Players to Add</th>
                                                </tr>
                                            </thead>
                                            <tbody id="mergePreviewTable">
                                                <!-- Merge preview will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-12">
                                            <button class="btn btn-success" onclick="executeMerge()">
                                                <i class="fas fa-check me-2"></i>Confirm Merge
                                            </button>
                                            <button class="btn btn-secondary ms-2" onclick="cancelMerge()">
                                                <i class="fas fa-times me-2"></i>Cancel
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Preview and Configure -->
                    <div id="previewSection" class="row mb-4" style="display: none;">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-eye me-2"></i>Step 3: Preview & Configure Teams
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-8">
                                            <label for="divisionName" class="form-label">Division Name *</label>
                                            <input type="text" class="form-control" id="divisionName" placeholder="Enter division name" required>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="firstGameType" class="form-label">Game Type *</label>
                                            <select class="form-select" id="firstGameType" required onchange="updateGameTypeOptions()">
                                                <option value="">Select Game Type</option>
                                                <option value="8-ball">8-ball</option>
                                                <option value="9-ball">9-ball</option>
                                                <option value="10-ball">10-ball</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="smartBuilderIsDoublePlay" onchange="toggleSmartBuilderDoublePlayOptions()">
                                            <label class="form-check-label" for="smartBuilderIsDoublePlay">
                                                <strong>Double Play Division</strong> (Teams play both 8-ball and 10-ball each week)
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <!-- Double Play Options for Smart Builder (hidden by default) -->
                                    <div id="smartBuilderDoublePlayOptions" style="display: none;">
                                        <div class="mb-3">
                                            <label for="smartBuilderDoublePlayDivisionName" class="form-label">Division Base Name *</label>
                                            <input type="text" class="form-control" id="smartBuilderDoublePlayDivisionName" placeholder="e.g., Tuesday Night or 13061">
                                        </div>
                                        <div class="mb-3">
                                            <label for="smartBuilderSecondGameType" class="form-label">Second Game Type *</label>
                                            <select class="form-select" id="smartBuilderSecondGameType" required onchange="updateGameTypeOptions()">
                                                <option value="">Select Second Game Type</option>
                                                <option value="8-ball">8-ball</option>
                                                <option value="9-ball">9-ball</option>
                                                <option value="10-ball">10-ball</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-3">
                                            <label for="duesPerPlayer" class="form-label">Dues Per Player Per Match ($) *</label>
                                            <select class="form-select" id="duesPerPlayer" required>
                                                <option value="">Select Dues</option>
                                                <option value="8" selected>$8</option>
                                                <option value="10">$10</option>
                                                <option value="11">$11</option>
                                                <option value="12">$12</option>
                                                <option value="13">$13</option>
                                                <option value="14">$14</option>
                                                <option value="15">$15</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="smartBuilderPlayersPerWeek" class="form-label">Players Per Week *</label>
                                            <select class="form-select" id="smartBuilderPlayersPerWeek" required>
                                                <option value="">Select Players</option>
                                                <option value="3">3 Players</option>
                                                <option value="4">4 Players</option>
                                                <option value="5" selected>5 Players</option>
                                                <option value="6">6 Players</option>
                                                <option value="7">7 Players</option>
                                                <option value="8">8 Players</option>
                                            </select>
                                            <small class="text-muted">How many players play each week</small>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="smartBuilderTotalWeeks" class="form-label">Total Weeks *</label>
                                            <select class="form-select" id="smartBuilderTotalWeeks" required onchange="calculateSmartBuilderEndDate()">
                                                <option value="">Select Weeks</option>
                                                <option value="10">10 Weeks</option>
                                                <option value="11">11 Weeks</option>
                                                <option value="12">12 Weeks</option>
                                                <option value="13">13 Weeks</option>
                                                <option value="14">14 Weeks</option>
                                                <option value="15">15 Weeks</option>
                                                <option value="16">16 Weeks</option>
                                                <option value="17">17 Weeks</option>
                                                <option value="18">18 Weeks</option>
                                                <option value="19">19 Weeks</option>
                                                <option value="20" selected>20 Weeks</option>
                                                <option value="21">21 Weeks</option>
                                                <option value="22">22 Weeks</option>
                                                <option value="23">23 Weeks</option>
                                                <option value="24">24 Weeks</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="smartBuilderStartDate" class="form-label">Season Start Date *</label>
                                            <input type="date" class="form-control" id="smartBuilderStartDate" required onchange="calculateSmartBuilderEndDate()">
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="smartBuilderEndDate" class="form-label">Season End Date</label>
                                            <input type="date" class="form-control" id="smartBuilderEndDate" readonly>
                                            <small class="text-muted">Calculated automatically based on start date and weeks</small>
                                        </div>
                                    </div>
                                    
                                    <div class="table-responsive">
                                        <table class="table table-sm table-striped">
                                            <thead>
                                                <tr>
                                                    <th>
                                                        <input type="checkbox" id="selectAllTeams" onchange="toggleAllTeams()">
                                                    </th>
                                                    <th>Team Name</th>
                                                    <th>Captain</th>
                                                    <th>Players</th>
                                                    <th>Dues Owed</th>
                                                </tr>
                                            </thead>
                                            <tbody id="teamsPreview">
                                                <!-- Teams will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Create -->
                    <div id="createSection" class="row mb-4" style="display: none;">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-rocket me-2"></i>Step 4: Create Teams & Division
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Ready to create <span id="selectedTeamsCount">0</span> teams in the division "<span id="selectedDivisionName">-</span>"
                                    </div>
                                    <button class="btn btn-success btn-lg" onclick="createTeamsAndDivision()">
                                        <i class="fas fa-magic me-2"></i>Create Teams & Division
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal fade" id="paymentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Record Payment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="paymentForm">
                        <div class="mb-3">
                            <label for="paymentMethod" class="form-label">Payment Method</label>
                            <select class="form-select" id="paymentMethod">
                                <option value="Cash">Cash</option>
                                <option value="Check">Check</option>
                                <option value="Venmo">Venmo</option>
                                <option value="CashApp">CashApp</option>
                                <option value="PayPal">PayPal</option>
                                <option value="Zelle">Zelle</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="paymentAmount" class="form-label">Payment Amount</label>
                            <select class="form-select" id="paymentAmount" onchange="updatePaymentAmount()">
                                <option value="">Select Amount</option>
                                <!-- Options will be populated dynamically -->
                            </select>
                            <small class="text-muted">Select multiple weeks to pay at once</small>
                        </div>
                        <div class="mb-3">
                            <label for="paymentNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="paymentNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="recordPayment()">Record Payment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Weekly Payment Modal -->
    <div class="modal fade" id="weeklyPaymentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Weekly Payment - <span id="weeklyPaymentTeamName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Success Message -->
                    <div id="weeklyPaymentSuccess" class="alert alert-success d-none" role="alert">
                        <i class="fas fa-check-circle me-2"></i>
                        <span id="weeklyPaymentSuccessMessage">Payment updated successfully!</span>
                        <button type="button" class="btn btn-sm btn-outline-success ms-2" onclick="closeWeeklyPaymentModal()">
                            OK
                        </button>
                    </div>
                    
                    <form id="weeklyPaymentForm">
                        <div class="row">
                            <!-- Left Column: Payment Status & Details -->
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Week <span id="weeklyPaymentWeek"></span> Payment Status</label>
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidYes" value="true">
                                                <label class="form-check-label" for="weeklyPaidYes">
                                                    <span class="badge bg-success">Paid</span>
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidNo" value="false" checked>
                                                <label class="form-check-label" for="weeklyPaidNo">
                                                    <span class="badge bg-danger">Not Paid</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidBye" value="bye">
                                                <label class="form-check-label" for="weeklyPaidBye">
                                                    <span class="badge bg-info"><strong>Bye Week</strong></span>
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidMakeup" value="makeup">
                                                <label class="form-check-label" for="weeklyPaidMakeup">
                                                    <span class="badge bg-warning"><strong>Make Up</strong></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <small class="text-muted">Bye Week = No dues required | Make Up = Dues still owed</small>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="weeklyPaymentMethod" class="form-label">Payment Method</label>
                                    <select class="form-select" id="weeklyPaymentMethod">
                                        <option value="Cash">Cash</option>
                                        <option value="Check">Check</option>
                                        <option value="Venmo">Venmo</option>
                                        <option value="CashApp">CashApp</option>
                                        <option value="PayPal">PayPal</option>
                                        <option value="Zelle">Zelle</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="weeklyPaymentDate" class="form-label">Date Paid</label>
                                    <input type="date" class="form-control" id="weeklyPaymentDate">
                                    <small class="text-muted">Select the date the payment was received</small>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="weeklyPaymentAmount" class="form-label">Amount</label>
                                    <select class="form-select" id="weeklyPaymentAmount" onchange="updateWeeklyPaymentAmount()">
                                        <option value="">Select Amount</option>
                                        <!-- Options will be populated dynamically -->
                                    </select>
                                    <small class="text-muted">Select amount based on individual dues</small>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="weeklyPaymentNotes" class="form-label">Notes</label>
                                    <textarea class="form-control" id="weeklyPaymentNotes" rows="2"></textarea>
                                </div>
                            </div>
                            
                            <!-- Right Column: BCA Sanction Fees & Individual Payments -->
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label"><strong id="sanctionFeeLabel">Sanction Fees</strong></label>
                                    <div id="bcaSanctionPlayers" class="border rounded p-3" style="max-height: 150px; overflow-y: auto; background-color: #f8f9fa;">
                                        <!-- Player checkboxes will be populated here -->
                                    </div>
                                    <small class="text-muted" id="sanctionFeeHelpText">Select which players this payment includes sanction fees for</small>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <label class="form-label mb-0"><strong>Individual Player Payments</strong></label>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="toggleIndividualPayments()">
                                            <i class="fas fa-toggle-off" id="individualPaymentsToggleIcon"></i> <span id="individualPaymentsToggleText">Enable</span>
                                        </button>
                                    </div>
                                    <div id="individualPaymentsSection" class="border rounded p-3" style="display: none; max-height: 250px; overflow-y: auto; background-color: #f8f9fa;">
                                        <small class="text-muted d-block mb-2">Enter individual payments. Total will count toward team weekly dues.</small>
                                        <div id="individualPlayerPayments">
                                            <!-- Individual player payment inputs will be populated here -->
                                        </div>
                                        <div class="mt-2 pt-2 border-top">
                                            <strong>Individual Payments Total: $<span id="individualPaymentsTotal">0.00</span></strong>
                                            <br><small class="text-muted">Weekly Team Dues: $<span id="weeklyTeamDuesAmount">0.00</span></small>
                                            <br><small class="text-info">Remaining Balance: $<span id="remainingDuesBalance">0.00</span></small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveWeeklyPayment()">Save Payment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Division Management Modal -->
    <div class="modal fade" id="divisionManagementModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Division Management</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 250px); overflow-y: auto;">
                    <div class="row mb-3">
                        <div class="col-12">
                            <button class="btn btn-primary" onclick="showAddDivisionModal()">
                                <i class="fas fa-plus me-2"></i>Add New Division
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Division Name</th>
                                    <th>Dues Rate</th>
                                    <th>Type</th>
                                    <th>Number of Teams</th>
                                    <th>Total Weeks</th>
                                    <th>Current Teams</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="divisionsTable">
                                <!-- Divisions will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Division Modal -->
    <div class="modal fade" id="addDivisionModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="divisionModalTitle">Add New Division</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Navigation Tabs -->
                    <ul class="nav nav-tabs mb-3" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="division-details-tab" data-bs-toggle="tab" data-bs-target="#division-details-pane" type="button" role="tab">
                                <i class="fas fa-info-circle me-2"></i>Division Details
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="division-financial-tab" data-bs-toggle="tab" data-bs-target="#division-financial-pane" type="button" role="tab">
                                <i class="fas fa-calculator me-2"></i>Financial Breakdown
                            </button>
                        </li>
                    </ul>
                    
                    <!-- Tab Content -->
                    <div class="tab-content">
                        <!-- Division Details Tab -->
                        <div class="tab-pane fade show active" id="division-details-pane" role="tabpanel">
                    <form id="addDivisionForm">
                        <!-- Regular Division Fields (shown by default, hidden when double play is checked) -->
                        <div id="regularDivisionFields">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="mb-3">
                                        <label for="divisionName" class="form-label">Division Name *</label>
                                        <input type="text" class="form-control" id="divisionName" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="firstGameType" class="form-label">Game Type *</label>
                                        <select class="form-select" id="firstGameType" required onchange="updateGameTypeOptions()">
                                            <option value="">Select Game Type</option>
                                            <option value="8-ball">8-ball</option>
                                            <option value="9-ball">9-ball</option>
                                            <option value="10-ball">10-ball</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="isDoublePlay" onchange="toggleDoublePlayOptions()">
                                <label class="form-check-label" for="isDoublePlay">
                                    <strong>Double Play Division</strong> (Teams play 2 formats each week)
                                </label>
                            </div>
                            <small class="text-muted">Check this if teams play 2 formats each week. You can set matches/week per format below.</small>
                        </div>
                        
                        <!-- Double Play Options (hidden by default) -->
                        <div id="doublePlayOptions" style="display: none;">
                            <div class="row mb-3">
                                <div class="col-md-5">
                                    <label for="firstDivisionName" class="form-label">First Division Name *</label>
                                    <input type="text" class="form-control" id="firstDivisionName" placeholder="e.g., 13061">
                                    <small class="text-muted">Base name for the first division</small>
                                </div>
                                <div class="col-md-3">
                                    <label for="firstDivisionGameType" class="form-label">Game Type *</label>
                                    <select class="form-select" id="firstDivisionGameType" required onchange="updateGameTypeOptions()">
                                        <option value="">Select Game Type</option>
                                        <option value="8-ball">8-ball</option>
                                        <option value="9-ball">9-ball</option>
                                        <option value="10-ball">10-ball</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="firstMatchesPerWeek" class="form-label">Matches/Week *</label>
                                    <select class="form-select" id="firstMatchesPerWeek" required>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5" selected>5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                    </select>
                                    <small class="text-muted">Matches per team, per week (this format)</small>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-5">
                                    <label for="secondDivisionName" class="form-label">Second Division Name *</label>
                                    <input type="text" class="form-control" id="secondDivisionName" placeholder="e.g., 13061">
                                    <small class="text-muted">Base name for the second division</small>
                                </div>
                                <div class="col-md-3">
                                    <label for="secondDivisionGameType" class="form-label">Game Type *</label>
                                    <select class="form-select" id="secondDivisionGameType" required onchange="updateGameTypeOptions()">
                                        <option value="">Select Game Type</option>
                                        <option value="8-ball">8-ball</option>
                                        <option value="9-ball">9-ball</option>
                                        <option value="10-ball">10-ball</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="secondMatchesPerWeek" class="form-label">Matches/Week *</label>
                                    <select class="form-select" id="secondMatchesPerWeek" required>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5" selected>5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                    </select>
                                    <small class="text-muted">Matches per team, per week (this format)</small>
                                </div>
                            </div>
                            <div class="alert alert-info">
                                <small><i class="fas fa-info-circle me-1"></i><strong>Note:</strong> For double-play divisions, enter the name and select the game type for each division. These are tracked as one combined division in the app but each has its own name and game type.</small>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label for="duesPerPlayerPerMatch" class="form-label">Dues Per Player Per Match ($) *</label>
                                    <select class="form-select" id="duesPerPlayerPerMatch" required>
                                        <option value="">Select Dues</option>
                                        <option value="8">$8</option>
                                        <option value="10">$10</option>
                                        <option value="11">$11</option>
                                        <option value="12">$12</option>
                                        <option value="13">$13</option>
                                        <option value="14">$14</option>
                                        <option value="15">$15</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label for="playersPerWeek" class="form-label">Players Per Week *</label>
                                    <select class="form-select" id="playersPerWeek" required>
                                        <option value="">Select Players</option>
                                        <option value="3">3 Players</option>
                                        <option value="4">4 Players</option>
                                        <option value="5" selected>5 Players</option>
                                        <option value="6">6 Players</option>
                                        <option value="7">7 Players</option>
                                        <option value="8">8 Players</option>
                                    </select>
                                    <small class="text-muted">How many players actually play each week</small>
                                </div>
                            </div>
                            <div class="col-md-3" id="regularMatchesPerWeekWrapper">
                                <div class="mb-3">
                                    <label for="matchesPerWeek" class="form-label">Matches/Week *</label>
                                    <select class="form-select" id="matchesPerWeek" required>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5" selected>5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                    </select>
                                    <small class="text-muted">Matches per team, per week</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label for="numberOfTeams" class="form-label">Number of Teams *</label>
                                    <select class="form-select" id="numberOfTeams" required>
                                        <option value="">Select Teams</option>
                                        <option value="4">4 Teams</option>
                                        <option value="5">5 Teams</option>
                                        <option value="6">6 Teams</option>
                                        <option value="7">7 Teams</option>
                                        <option value="8">8 Teams</option>
                                        <option value="9">9 Teams</option>
                                        <option value="10">10 Teams</option>
                                        <option value="11">11 Teams</option>
                                        <option value="12">12 Teams</option>
                                        <option value="13">13 Teams</option>
                                        <option value="14">14 Teams</option>
                                        <option value="15">15 Teams</option>
                                        <option value="16">16 Teams</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label for="totalWeeks" class="form-label">Total Weeks *</label>
                                    <select class="form-select" id="totalWeeks" required onchange="calculateEndDate()">
                                        <option value="">Select Weeks</option>
                                        <option value="10">10 Weeks</option>
                                        <option value="11">11 Weeks</option>
                                        <option value="12">12 Weeks</option>
                                        <option value="13">13 Weeks</option>
                                        <option value="14">14 Weeks</option>
                                        <option value="15">15 Weeks</option>
                                        <option value="16">16 Weeks</option>
                                        <option value="17">17 Weeks</option>
                                        <option value="18">18 Weeks</option>
                                        <option value="19">19 Weeks</option>
                                        <option value="20">20 Weeks</option>
                                        <option value="21">21 Weeks</option>
                                        <option value="22">22 Weeks</option>
                                        <option value="23">23 Weeks</option>
                                        <option value="24">24 Weeks</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="startDate" class="form-label">Season Start Date *</label>
                                    <input type="date" class="form-control" id="startDate" required onchange="calculateEndDate()">
                                    <div id="startDateDay" class="mt-1" style="display: none;">
                                        <small class="text-primary"><i class="fas fa-calendar-day me-1"></i><strong>Day of Play:</strong> <span id="startDayName"></span></small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="endDate" class="form-label">Season End Date</label>
                                    <input type="date" class="form-control" id="endDate" readonly>
                                    <small class="text-muted">Calculated automatically based on start date and weeks</small>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="divisionDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="divisionDescription" rows="3"></textarea>
                        </div>
                        <div class="alert alert-info">
                            <small><i class="fas fa-info-circle me-1"></i><strong>Weekly Dues Calculation:</strong> Dues per player per match  Players per week  Matches per week = Weekly dues per team<br>
                            <strong>Regular Division:</strong> Uses Matches/Week setting<br>
                            <strong>Double Play Division:</strong> Uses Matches/Week per format (First + Second)<br>
                            <small class="text-muted">Example: $8  5 players = $40 per team per format/week (double play = $40 + $40 = $80/week per team)</small></small>
                        </div>
                    </form>
                        </div>
                        
                        <!-- Financial Breakdown Tab -->
                        <div class="tab-pane fade" id="division-financial-pane" role="tabpanel">
                            <div class="mb-3">
                                <h6 class="fw-bold mb-3">
                                    <i class="fas fa-calculator text-primary me-2"></i>
                                    Financial Breakdown (Optional)
                                </h6>
                                <p class="text-muted small mb-3">Configure how weekly dues are distributed for this division. If left blank, will use your default settings from Profile & Settings.</p>
                                
                                <div class="card bg-light p-3">
                                <div class="mb-3">
                                    <label for="divisionPrizeFundName" class="form-label fw-bold small">
                                        Prize Fund Category Name
                                        <i class="fas fa-info-circle text-info ms-1" data-bs-toggle="tooltip" 
                                           title="Leave blank to use default from Profile & Settings"></i>
                                    </label>
                                    <input type="text" class="form-control form-control-sm" id="divisionPrizeFundName" 
                                           placeholder="Leave blank for default">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="divisionPrizeFundPercentage" class="form-label fw-bold small">
                                        Prize Fund Percentage
                                        <i class="fas fa-info-circle text-info ms-1" data-bs-toggle="tooltip" 
                                           title="Percentage of weekly dues that goes to prize fund. Leave blank to use default."></i>
                                    </label>
                                    <div class="input-group input-group-sm">
                                        <input type="number" class="form-control" id="divisionPrizeFundPercentage" 
                                               step="0.1" min="0" max="100" placeholder="Default from settings">
                                        <span class="input-group-text">%</span>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="divisionFirstOrgName" class="form-label fw-bold small">
                                        Local League/Organization Name
                                        <i class="fas fa-info-circle text-info ms-1" data-bs-toggle="tooltip" 
                                           title="Leave blank to use default from Profile & Settings"></i>
                                    </label>
                                    <input type="text" class="form-control form-control-sm" id="divisionFirstOrgName" 
                                           placeholder="Leave blank for default">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="divisionFirstOrgPercentage" class="form-label fw-bold small">
                                        Local League Percentage (of remaining)
                                        <i class="fas fa-info-circle text-info ms-1" data-bs-toggle="tooltip" 
                                           title="Percentage of remaining (after prize fund). Leave blank to use default."></i>
                                    </label>
                                    <div class="input-group input-group-sm">
                                        <input type="number" class="form-control" id="divisionFirstOrgPercentage" 
                                               step="0.1" min="0" max="100" placeholder="Default from settings">
                                        <span class="input-group-text">%</span>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="divisionSecondOrgName" class="form-label fw-bold small">
                                        Parent/National Organization Name
                                        <i class="fas fa-info-circle text-info ms-1" data-bs-toggle="tooltip" 
                                           title="Leave blank to use default from Profile & Settings"></i>
                                    </label>
                                    <input type="text" class="form-control form-control-sm" id="divisionSecondOrgName" 
                                           placeholder="Leave blank for default">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="divisionSecondOrgPercentage" class="form-label fw-bold small">
                                        Parent/National Organization Percentage (of remaining)
                                        <i class="fas fa-info-circle text-info ms-1" data-bs-toggle="tooltip" 
                                           title="Percentage of remaining (after prize fund). Leave blank to use default."></i>
                                    </label>
                                    <div class="input-group input-group-sm">
                                        <input type="number" class="form-control" id="divisionSecondOrgPercentage" 
                                               step="0.1" min="0" max="100" placeholder="Default from settings">
                                        <span class="input-group-text">%</span>
                                    </div>
                                </div>
                                
                                <div class="alert alert-info mb-0 py-2">
                                    <small><i class="fas fa-info-circle me-1"></i>If you leave these fields blank, the division will use your default financial breakdown settings from Profile & Settings  Dues Distribution tab.</small>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="divisionSubmitBtn" onclick="addDivision()">Create Division</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment History Modal -->
    <div class="modal fade" id="paymentHistoryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Payment History - <span id="paymentHistoryTeamName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Team info header -->
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-users text-primary me-2"></i>
                                        <div>
                                            <small class="text-muted">Division</small><br>
                                            <span id="paymentHistoryDivision" class="fw-bold"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-dollar-sign text-success me-2"></i>
                                        <div>
                                            <small class="text-muted">Dues Rate</small><br>
                                            $<span id="paymentHistoryDuesRate" class="fw-bold"></span>/player
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="row">
                                <div class="col-6">
                                    <div class="text-center">
                                        <small class="text-muted">Total Weeks</small><br>
                                        <span id="paymentHistoryTotalWeeks" class="fw-bold fs-5"></span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="text-center">
                                        <small class="text-muted">Weekly Dues</small><br>
                                        $<span id="paymentHistoryWeeklyDues" class="fw-bold fs-5"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-3">
                    
                    <!-- Payment history table -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0"><i class="fas fa-history me-2"></i>Payment History</h6>
                        <div class="d-flex gap-3">
                            <small><strong>Total Paid:</strong> $<span id="paymentHistoryTotalPaid">0</span></small>
                            <small><strong>Weeks Paid:</strong> <span id="paymentHistoryWeeksPaid">0</span></small>
                            <div>
                                <strong>Status:</strong> <span id="paymentHistoryStatus" class="badge">Current</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-striped table-sm">
                            <thead class="table-dark">
                                <tr>
                                    <th style="width: 8%;">Week</th>
                                    <th style="width: 12%;">Date</th>
                                    <th style="width: 12%;">Status</th>
                                    <th style="width: 10%;">Amount</th>
                                    <th style="width: 10%;">Method</th>
                                    <th style="width: 12%;">Paid Date</th>
                                    <th style="width: 20%;">Notes</th>
                                    <th style="width: 16%;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="paymentHistoryTable">
                                <!-- Payment history will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Players View Modal -->
    <div class="modal fade" id="playersModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-users me-2"></i>All Players - BCA Sanction Status
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Summary Cards -->
                    <div class="row mb-4">
                        <div class="col-md-2">
                            <div class="card bg-primary text-white text-center p-3">
                                <h6>Total Players</h6>
                                <h3 id="totalPlayersCount">0</h3>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card bg-success text-white text-center p-3">
                                <h6>Sanction Paid</h6>
                                <h3 id="sanctionPaidCount">0</h3>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card bg-warning text-dark text-center p-3">
                                <h6>Sanction Pending</h6>
                                <h3 id="sanctionPendingCount">0</h3>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card bg-info text-white text-center p-3">
                                <h6>Previously Sanctioned</h6>
                                <h3 id="previouslySanctionedCount">0</h3>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card bg-secondary text-white text-center p-3">
                                <h6>Total Collected</h6>
                                <h3 id="sanctionFeesCollected">$0</h3>
                            </div>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="playersDivisionFilter" class="form-label">Filter by Division</label>
                            <select class="form-select" id="playersDivisionFilter" onchange="filterPlayersTable()">
                                <option value="all">All Divisions</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="playersStatusFilter" class="form-label">Filter by Status</label>
                            <select class="form-select" id="playersStatusFilter" onchange="filterPlayersTable()">
                                <option value="all">All Players</option>
                                <option value="paid">Sanction Paid</option>
                                <option value="pending">Sanction Pending</option>
                                <option value="previously">Previously Sanctioned</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="playersSearch" class="form-label">Search Players</label>
                            <input type="text" class="form-control" id="playersSearch" placeholder="Search by name..." onkeyup="filterPlayersTable()">
                        </div>
                    </div>

                    <!-- Players Table -->
                    <div class="table-responsive">
                        <table class="table table-striped table-hover" id="playersTable">
                            <thead class="table-dark">
                                <tr>
                                    <th>Player Name</th>
                                    <th>Team</th>
                                    <th>Division</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Sanction Status</th>
                                    <th>Previously Sanctioned</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="playersTableBody">
                                <!-- Players will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile & Settings Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-user-cog me-2"></i>Profile & Settings
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <!-- Tabs Navigation -->
                    <ul class="nav nav-tabs nav-fill border-bottom" id="settingsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-pane" type="button" role="tab">
                                <i class="fas fa-user me-2"></i>Profile
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="sanction-tab" data-bs-toggle="tab" data-bs-target="#sanction-pane" type="button" role="tab">
                                <i class="fas fa-certificate me-2"></i>Sanction Fees
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="financial-tab" data-bs-toggle="tab" data-bs-target="#financial-pane" type="button" role="tab">
                                <i class="fas fa-calculator me-2"></i>Dues Distribution
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="subscription-tab" data-bs-toggle="tab" data-bs-target="#subscription-pane" type="button" role="tab">
                                <i class="fas fa-credit-card me-2"></i>Subscription
                            </button>
                        </li>
                    </ul>
                    
                    <!-- Tabs Content -->
                    <div class="tab-content p-4" id="settingsTabContent">
                        <!-- Profile Tab -->
                        <div class="tab-pane fade show active" id="profile-pane" role="tabpanel">
                            <form id="profileForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="profileName" class="form-label fw-bold">Your Name</label>
                                        <input type="text" class="form-control" id="profileName" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="profileEmail" class="form-label fw-bold">Email</label>
                                        <input type="email" class="form-control bg-light" id="profileEmail" required readonly>
                                        <small class="text-muted"><i class="fas fa-info-circle me-1"></i>Email cannot be changed</small>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="profileOrganizationName" class="form-label fw-bold">
                                        Organization/League Name
                                        <i class="fas fa-info-circle text-info ms-1" data-bs-toggle="tooltip" 
                                           title="This name will appear in the app header and login screen"></i>
                                    </label>
                                    <input type="text" class="form-control" id="profileOrganizationName" 
                                           placeholder="e.g., Denver Pool League, Front Range BCA, etc.">
                                    <small class="text-muted">This is how your league will be displayed throughout the app</small>
                                </div>
                                <div class="mb-3">
                                    <label for="profilePhone" class="form-label fw-bold">Phone <span class="text-muted">(Optional)</span></label>
                                    <input type="tel" class="form-control" id="profilePhone" placeholder="(555) 123-4567">
                                </div>

                                <hr class="my-3" style="border-color: rgba(255,255,255,0.08);">
                                <div class="mb-2">
                                    <label class="form-label fw-bold">Appearance</label>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="themeToggle">
                                        <label class="form-check-label" for="themeToggle">
                                            Use Dark Mode
                                        </label>
                                    </div>
                                    <small class="text-muted">Switch between dark and light mode (saved to your account).</small>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Sanction Fees Tab -->
                        <div class="tab-pane fade" id="sanction-pane" role="tabpanel">
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <h6 class="card-title mb-3">
                                        <i class="fas fa-certificate text-warning me-2"></i>
                                        Sanction Fee Configuration
                                    </h6>
                                    <p class="text-muted small mb-4">Customize how sanction fees are named and priced throughout your league.</p>
                                    
                                    <form id="sanctionForm">
                                        <div class="mb-4">
                                            <label for="profileSanctionFeeName" class="form-label fw-bold">
                                                Sanction Fee Name
                                                <i class="fas fa-info-circle text-info ms-1" data-bs-toggle="tooltip" 
                                                   title="The name of your sanction fee (e.g., 'BCA Sanction Fee', 'League Registration Fee', etc.)"></i>
                                            </label>
                                            <input type="text" class="form-control form-control-lg" id="profileSanctionFeeName" 
                                                   placeholder="e.g., BCA Sanction Fee">
                                            <small class="text-muted">This name will appear throughout the app when referring to sanction fees</small>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="profileSanctionFeeAmount" class="form-label fw-bold">
                                                Collection Amount (per player)
                                            </label>
                                            <div class="input-group input-group-lg">
                                                <span class="input-group-text bg-white border-end-0"><i class="fas fa-dollar-sign"></i></span>
                                                <input type="number" class="form-control border-start-0" id="profileSanctionFeeAmount" 
                                                       step="0.01" min="0" placeholder="25.00">
                                            </div>
                                            <small class="text-muted">The amount you charge players for sanction fees</small>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="profileSanctionFeePayoutAmount" class="form-label fw-bold">
                                                Payout Amount (per player)
                                            </label>
                                            <div class="input-group input-group-lg">
                                                <span class="input-group-text bg-white border-end-0"><i class="fas fa-dollar-sign"></i></span>
                                                <input type="number" class="form-control border-start-0" id="profileSanctionFeePayoutAmount" 
                                                       step="0.01" min="0" placeholder="20.00">
                                            </div>
                                            <small class="text-muted">The amount you pay out for each sanction fee</small>
                                        </div>
                                        
                                        <div class="alert alert-info mb-0">
                                            <i class="fas fa-info-circle me-2"></i>
                                            <strong>Profit per player:</strong> $<span id="sanctionFeeProfitDisplay">0.00</span>
                                            <br><small class="text-muted">This is calculated automatically (Collection - Payout)</small>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Dues Distribution Tab -->
                        <div class="tab-pane fade" id="financial-pane" role="tabpanel">
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <h6 class="card-title mb-3">
                                        <i class="fas fa-calculator text-primary me-2"></i>
                                        Financial Breakdown Configuration
                                    </h6>
                                    <p class="text-muted small mb-4">Configure how weekly dues are distributed. First, set the prize fund percentage, then split the remaining amount between your local league/organization and the parent/national organization.</p>
                                    
                                    <form id="financialBreakdownForm">
                                        <div class="mb-4">
                                            <label for="profilePrizeFundName" class="form-label fw-bold">
                                                Prize Fund Category Name
                                                <i class="fas fa-info-circle text-info ms-1" data-bs-toggle="tooltip" 
                                                   title="The name for your prize fund category (e.g., 'Prize Fund', 'Tournament Fund', etc.)"></i>
                                            </label>
                                            <input type="text" class="form-control" id="profilePrizeFundName" 
                                                   placeholder="e.g., Prize Fund, Tournament Fund">
                                            <small class="text-muted">This name will appear in financial reports</small>
                                        </div>
                                        
                                        <div class="mb-4">
                                            <label class="form-label fw-bold">Calculation Method</label>
                                            <div class="btn-group w-100" role="group">
                                                <input type="radio" class="btn-check" name="calculationMethod" id="methodPercentage" value="percentage" checked onchange="toggleCalculationMethod()">
                                                <label class="btn btn-outline-primary" for="methodPercentage">
                                                    <i class="fas fa-percent me-1"></i>Percentage
                                                </label>
                                                
                                                <input type="radio" class="btn-check" name="calculationMethod" id="methodDollarAmount" value="dollar" onchange="toggleCalculationMethod()">
                                                <label class="btn btn-outline-primary" for="methodDollarAmount">
                                                    <i class="fas fa-dollar-sign me-1"></i>Dollar Amount
                                                </label>
                                            </div>
                                            <small class="text-muted">Choose whether to use percentages or fixed dollar amounts</small>
                                        </div>
                                        
                                        <!-- Percentage-Based Inputs -->
                                        <div id="percentageInputs">
                                            <div class="mb-3">
                                                <label for="profilePrizeFundPercentage" class="form-label fw-bold">
                                                    <span id="prizeFundLabel">Prize Fund</span> Percentage
                                                    <i class="fas fa-info-circle text-info ms-1" data-bs-toggle="tooltip" 
                                                       title="Percentage of weekly dues that goes to the prize fund (e.g., 50 = 50% of weekly dues)"></i>
                                                </label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="profilePrizeFundPercentage" 
                                                           step="0.1" min="0" max="100" placeholder="50.0">
                                                    <span class="input-group-text">%</span>
                                                </div>
                                                <small class="text-muted">Percentage of weekly dues allocated to prize fund</small>
                                            </div>
                                            
                                            <hr class="my-4">
                                            
                                            <div class="mb-4">
                                                <label for="profileFirstOrganizationName" class="form-label fw-bold">
                                                    Local League/Organization Name
                                                    <i class="fas fa-info-circle text-info ms-1" data-bs-toggle="tooltip" 
                                                       title="The name of YOUR local league or organization (e.g., 'League Manager', 'Local League', 'Your League Name', etc.)"></i>
                                                </label>
                                                <input type="text" class="form-control" id="profileFirstOrganizationName" 
                                                       placeholder="e.g., League Manager, Local League">
                                                <small class="text-muted">This is YOUR local league/organization that receives a portion of dues</small>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="profileFirstOrganizationPercentage" class="form-label fw-bold">
                                                    <span id="firstOrgLabel">Local League/Organization</span> Percentage (of remaining)
                                                    <i class="fas fa-info-circle text-info ms-1" data-bs-toggle="tooltip" 
                                                       title="Percentage of the remaining amount (after prize fund) that goes to YOUR local league/organization"></i>
                                                </label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="profileFirstOrganizationPercentage" 
                                                           step="0.1" min="0" max="100" placeholder="60.0">
                                                    <span class="input-group-text">%</span>
                                                </div>
                                                <small class="text-muted">Percentage of remaining dues (after prize fund) allocated to your local league/organization</small>
                                            </div>
                                            
                                            <div class="mb-4">
                                                <label for="profileSecondOrganizationName" class="form-label fw-bold">
                                                    Parent/National Organization Name
                                                    <i class="fas fa-info-circle text-info ms-1" data-bs-toggle="tooltip" 
                                                       title="The name of the PARENT or NATIONAL organization (e.g., 'USA Pool League', 'National Organization', 'Parent League', etc.)"></i>
                                                </label>
                                                <input type="text" class="form-control" id="profileSecondOrganizationName" 
                                                       placeholder="e.g., USA Pool League, National Organization">
                                                <small class="text-muted">This is the PARENT or NATIONAL organization (e.g., USA Pool League, CSI, etc.)</small>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="profileSecondOrganizationPercentage" class="form-label fw-bold">
                                                    <span id="secondOrgLabel">Parent/National Organization</span> Percentage (of remaining)
                                                    <i class="fas fa-info-circle text-info ms-1" data-bs-toggle="tooltip" 
                                                       title="Percentage of the remaining amount (after prize fund) that goes to the PARENT/NATIONAL organization"></i>
                                                </label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="profileSecondOrganizationPercentage" 
                                                           step="0.1" min="0" max="100" placeholder="40.0">
                                                    <span class="input-group-text">%</span>
                                                </div>
                                                <small class="text-muted">Percentage of remaining dues (after prize fund) allocated to parent/national organization</small>
                                            </div>
                                            
                                            <div class="alert alert-warning mb-0">
                                                <i class="fas fa-exclamation-triangle me-2"></i>
                                                <strong>Note:</strong> Local League and Parent/National Organization percentages should total 100% (e.g., 60% + 40% = 100%)
                                                <br><small class="text-muted">These percentages are applied to the remaining amount after the prize fund is deducted.</small>
                                            </div>
                                        </div>
                                        
                                        <!-- Dollar Amount-Based Inputs -->
                                        <div id="dollarAmountInputs" style="display: none;">
                                            <div class="mb-3">
                                                <label class="form-label fw-bold mb-2">Prize Fund Amount</label>
                                                <div class="btn-group w-100 mb-2" role="group">
                                                    <input type="radio" class="btn-check" name="prizeFundAmountType" id="prizeFundPerTeam" value="perTeam" checked>
                                                    <label class="btn btn-outline-secondary btn-sm" for="prizeFundPerTeam">Per Team Per Week</label>
                                                    
                                                    <input type="radio" class="btn-check" name="prizeFundAmountType" id="prizeFundPerPlayer" value="perPlayer">
                                                    <label class="btn btn-outline-secondary btn-sm" for="prizeFundPerPlayer">Per Player Per Match</label>
                                                </div>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" class="form-control" id="profilePrizeFundAmount" 
                                                           step="0.01" min="0" placeholder="20.00">
                                                </div>
                                                <small class="text-muted">Fixed dollar amount for prize fund</small>
                                            </div>
                                            
                                            <hr class="my-4">
                                            
                                            <div class="mb-4">
                                                <label for="profileFirstOrganizationName" class="form-label fw-bold">
                                                    Local League/Organization Name
                                                    <i class="fas fa-info-circle text-info ms-1" data-bs-toggle="tooltip" 
                                                       title="The name of YOUR local league or organization"></i>
                                                </label>
                                                <input type="text" class="form-control" id="profileFirstOrganizationNameDollar" 
                                                       placeholder="e.g., League Manager, Local League">
                                                <small class="text-muted">This is YOUR local league/organization that receives a portion of dues</small>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label class="form-label fw-bold mb-2">Local League/Organization Amount</label>
                                                <div class="btn-group w-100 mb-2" role="group">
                                                    <input type="radio" class="btn-check" name="firstOrgAmountType" id="firstOrgPerTeam" value="perTeam" checked>
                                                    <label class="btn btn-outline-secondary btn-sm" for="firstOrgPerTeam">Per Team Per Week</label>
                                                    
                                                    <input type="radio" class="btn-check" name="firstOrgAmountType" id="firstOrgPerPlayer" value="perPlayer">
                                                    <label class="btn btn-outline-secondary btn-sm" for="firstOrgPerPlayer">Per Player Per Match</label>
                                                </div>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" class="form-control" id="profileFirstOrganizationAmount" 
                                                           step="0.01" min="0" placeholder="12.00">
                                                </div>
                                                <small class="text-muted">Fixed dollar amount for local league/organization</small>
                                            </div>
                                            
                                            <div class="mb-4">
                                                <label for="profileSecondOrganizationName" class="form-label fw-bold">
                                                    Parent/National Organization Name
                                                    <i class="fas fa-info-circle text-info ms-1" data-bs-toggle="tooltip" 
                                                       title="The name of the PARENT or NATIONAL organization"></i>
                                                </label>
                                                <input type="text" class="form-control" id="profileSecondOrganizationNameDollar" 
                                                       placeholder="e.g., USA Pool League, National Organization">
                                                <small class="text-muted">This is the PARENT or NATIONAL organization</small>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label class="form-label fw-bold mb-2">Parent/National Organization Amount</label>
                                                <div class="btn-group w-100 mb-2" role="group">
                                                    <input type="radio" class="btn-check" name="secondOrgAmountType" id="secondOrgPerTeam" value="perTeam" checked>
                                                    <label class="btn btn-outline-secondary btn-sm" for="secondOrgPerTeam">Per Team Per Week</label>
                                                    
                                                    <input type="radio" class="btn-check" name="secondOrgAmountType" id="secondOrgPerPlayer" value="perPlayer">
                                                    <label class="btn btn-outline-secondary btn-sm" for="secondOrgPerPlayer">Per Player Per Match</label>
                                                </div>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" class="form-control" id="profileSecondOrganizationAmount" 
                                                           step="0.01" min="0" placeholder="8.00">
                                                </div>
                                                <small class="text-muted">Fixed dollar amount for parent/national organization</small>
                                            </div>
                                            
                                            <div class="alert alert-info mb-0">
                                                <i class="fas fa-info-circle me-2"></i>
                                                <strong>Note:</strong> 
                                                <ul class="mb-0 mt-2 small">
                                                    <li><strong>Per Team Per Week:</strong> Fixed amount per team each week (e.g., $20 per team per week)</li>
                                                    <li><strong>Per Player Per Match:</strong> Amount per player per match, multiplied by players per week and matches per week (e.g., $2 per player per match  5 players  5 matches = $50 per team per week)</li>
                                                    <li>For double play divisions, "Per Player Per Match" will be multiplied by 10 matches per week instead of 5</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Subscription Tab -->
                        <div class="tab-pane fade" id="subscription-pane" role="tabpanel">
                            <div id="subscriptionInfo">
                                <div class="text-center py-5">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="text-muted mt-3">Loading subscription information...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Error/Success Messages -->
                    <div class="px-4 pb-3">
                        <div id="profileError" class="alert alert-danger hidden" role="alert"></div>
                        <div id="profileSuccess" class="alert alert-success hidden" role="alert">
                            <i class="fas fa-check-circle me-2"></i>Profile updated successfully!
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Close
                    </button>
                    <button type="button" class="btn btn-primary" onclick="saveProfile()">
                        <i class="fas fa-save me-2"></i>Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
