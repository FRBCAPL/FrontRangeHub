<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dues Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <!-- Export libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <!-- Styles moved to styles.css for better memory management -->
</head>
<body>
    <!-- Login/Register Screen -->
    <div id="loginScreen" class="login-container d-flex align-items-center justify-content-center hidden">
        <div class="card p-4" style="width: 450px;">
            <div class="text-center mb-4">
                <a href="/" class="text-decoration-none text-muted mb-2 d-block" style="font-size: 0.9rem;">
                    <i class="fas fa-arrow-left me-1"></i>Back to Homepage
                </a>
                <i class="fas fa-pool fa-3x text-primary mb-3"></i>
                <h2 id="loginScreenTitle">Dues Tracker</h2>
                <p class="text-muted">For League Operators</p>
            </div>
            
            <!-- Toggle between Login and Register -->
            <ul class="nav nav-pills nav-justified mb-4" id="authTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="login-tab" data-bs-toggle="pill" data-bs-target="#loginPane" type="button" role="tab">Login</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="register-tab" data-bs-toggle="pill" data-bs-target="#registerPane" type="button" role="tab">Sign Up</button>
                </li>
            </ul>
            
            <div class="tab-content" id="authTabContent">
                <!-- Login Form -->
                <div class="tab-pane fade show active" id="loginPane" role="tabpanel">
                    <!-- Google Sign In Button -->
                    <button type="button" class="btn btn-outline-danger w-100 mb-3" onclick="signInWithGoogle()" style="border: 2px solid #db4437; color: #db4437;">
                        <i class="fab fa-google me-2"></i>Continue with Google
                    </button>
                    
                    <div class="text-center my-3">
                        <small class="text-muted">OR</small>
                    </div>
                    
                    <!-- Email/Password Login -->
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <div class="mb-3 text-end">
                            <a href="#" onclick="showForgotPasswordModal(); return false;" class="text-decoration-none" style="color: #cbd5e1;">
                                <small>Forgot Password?</small>
                            </a>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-sign-in-alt me-2"></i>Login
                        </button>
                    </form>
                    <div id="loginError" class="alert alert-danger mt-3 hidden" role="alert"></div>
                </div>
                
                <!-- Registration Form -->
                <div class="tab-pane fade" id="registerPane" role="tabpanel">
                    <!-- Google Sign Up Button -->
                    <button type="button" class="btn btn-outline-danger w-100 mb-3" onclick="signUpWithGoogle()" style="border: 2px solid #db4437; color: #db4437;">
                        <i class="fab fa-google me-2"></i>Sign Up with Google
                    </button>
                    
                    <div class="text-center my-3">
                        <small class="text-muted">OR</small>
                    </div>
                    
                    <!-- Email/Password Registration -->
                    <form id="registerForm">
                        <div class="mb-3">
                            <label for="regName" class="form-label">Your Name</label>
                            <input type="text" class="form-control" id="regName" required>
                        </div>
                        <div class="mb-3">
                            <label for="regEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="regEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="regPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="regPassword" required minlength="8" oninput="checkPasswordStrength(this.value)">
                            <div id="passwordRequirements" class="mt-2">
                                <small class="text-muted d-block">Password must contain:</small>
                                <small id="reqLength" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>At least 8 characters</small>
                                <small id="reqUpper" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>One uppercase letter</small>
                                <small id="reqLower" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>One lowercase letter</small>
                                <small id="reqNumber" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>One number</small>
                                <small id="reqSpecial" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>One special character (!@#$%^&*)</small>
                            </div>
                            <div id="passwordStrength" class="mt-2" style="display: none;">
                                <div class="progress" style="height: 5px;">
                                    <div id="passwordStrengthBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                                </div>
                                <small id="passwordStrengthText" class="text-muted"></small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="regOrgName" class="form-label">Organization/League Name (Optional)</label>
                            <input type="text" class="form-control" id="regOrgName">
                        </div>
                        <button type="submit" class="btn btn-success w-100">
                            <i class="fas fa-user-plus me-2"></i>Create Account
                        </button>
                    </form>
                    <div id="registerError" class="alert alert-danger mt-3 hidden" role="alert"></div>
                    <div id="registerSuccess" class="alert alert-success mt-3 hidden" role="alert">
                        Account created! You can now login.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal fade" id="forgotPasswordModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: #252936; border: 1px solid rgba(255, 255, 255, 0.1);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                    <h5 class="modal-title" style="color: #e2e8f0;">Reset Password</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="color: #e2e8f0;">
                    <p>Enter your email address and we'll send you a link to reset your password.</p>
                    <form id="forgotPasswordForm">
                        <div class="mb-3">
                            <label for="forgotPasswordEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="forgotPasswordEmail" required style="background: #2d3142; border: 1px solid rgba(255, 255, 255, 0.1); color: #e2e8f0;">
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-paper-plane me-2"></i>Send Reset Link
                        </button>
                    </form>
                    <div id="forgotPasswordError" class="alert alert-danger mt-3" style="display: none;"></div>
                    <div id="forgotPasswordSuccess" class="alert alert-success mt-3" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div class="modal fade" id="resetPasswordModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: #252936; border: 1px solid rgba(255, 255, 255, 0.1);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                    <h5 class="modal-title" style="color: #e2e8f0;">Set New Password</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="color: #e2e8f0;">
                    <p id="resetPasswordEmailDisplay" class="mb-3"></p>
                    <form id="resetPasswordForm">
                        <input type="hidden" id="resetPasswordToken">
                        <div class="mb-3">
                            <label for="resetPasswordNew" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="resetPasswordNew" required minlength="8" oninput="checkPasswordStrength(this.value, 'reset')" style="background: #2d3142; border: 1px solid rgba(255, 255, 255, 0.1); color: #e2e8f0;">
                            <div id="resetPasswordRequirements" class="mt-2">
                                <small class="text-muted d-block">Password must contain:</small>
                                <small id="resetReqLength" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>At least 8 characters</small>
                                <small id="resetReqUpper" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>One uppercase letter</small>
                                <small id="resetReqLower" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>One lowercase letter</small>
                                <small id="resetReqNumber" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>One number</small>
                                <small id="resetReqSpecial" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>One special character (!@#$%^&*)</small>
                            </div>
                            <div id="resetPasswordStrength" class="mt-2" style="display: none;">
                                <div class="progress" style="height: 5px;">
                                    <div id="resetPasswordStrengthBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                                </div>
                                <small id="resetPasswordStrengthText" class="text-muted"></small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="resetPasswordConfirm" class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="resetPasswordConfirm" required style="background: #2d3142; border: 1px solid rgba(255, 255, 255, 0.1); color: #e2e8f0;">
                            <small id="resetPasswordMatch" class="text-danger" style="display: none;">Passwords do not match</small>
                        </div>
                        <button type="submit" class="btn btn-success w-100">
                            <i class="fas fa-key me-2"></i>Reset Password
                        </button>
                    </form>
                    <div id="resetPasswordError" class="alert alert-danger mt-3" style="display: none;"></div>
                    <div id="resetPasswordSuccess" class="alert alert-success mt-3" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-container">
        <!-- Navigation -->
        <nav class="navbar navbar-dark bg-dark">
            <div class="container-fluid d-flex align-items-center">
                <div class="d-flex align-items-center gap-3" style="flex: 0 0 auto; margin-left: 15%;">
                    <!-- Local Clock -->
                    <div id="localClock" style="
                        background: rgba(255, 255, 255, 0.1);
                        border: 1px solid rgba(255, 255, 255, 0.2);
                        border-radius: 8px;
                        padding: 6px 12px;
                        font-family: 'Courier New', monospace;
                        font-size: 0.9rem;
                        min-width: 200px;
                        text-align: center;
                    ">
                        <div id="clockTime" style="font-weight: bold; color: #10b981; font-size: 0.95rem;"></div>
                        <div id="clockDate" style="font-size: 0.75rem; color: #ffffff; opacity: 0.9; margin-top: 2px;"></div>
                    </div>
                </div>
                <span class="navbar-brand mb-0 h1" id="navbarBrand" style="flex: 1; text-align: center;">
                    <i class="fas fa-pool me-2"></i>Dues Tracker
                </span>
                <div class="d-flex align-items-center gap-3" style="flex: 0 0 auto; margin-right: 15%;">
                    <button id="adminButton" class="btn btn-outline-warning btn-sm" onclick="window.location.href='/dues-tracker/admin.html'" title="Admin Panel" style="display: none;">
                        <i class="fas fa-shield-alt me-1"></i>Admin
                    </button>
                    <button class="btn btn-outline-light btn-sm" onclick="showProfileModal()" title="Profile & Settings">
                        <i class="fas fa-user-cog me-1"></i>Settings
                    </button>
                    <button class="btn btn-outline-light" onclick="logout()">
                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                    </button>
                </div>
            </div>
        </nav>

        <div class="container-fluid px-4 pt-2 pb-4">
            <!-- Overview Section -->
            <div class="row mb-3">
                <div class="col-12 mb-2 text-center">
                    <h5 class="text-muted mb-0"><i class="fas fa-chart-line me-2"></i>Overview</h5>
                </div>
                <div class="col-md-3 mb-2" id="divisionSpecificSummary" style="display: none;">
                    <div class="card border-0 shadow-sm h-100 bg-dark text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-layer-group fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75" id="divisionSpecificTitle">Division</h6>
                            <h3 class="mb-0 fw-bold" id="divisionSpecificCollected">$0</h3>
                            <small class="opacity-75" id="divisionSpecificSubtitle">Division total</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-2">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body text-center d-flex flex-column justify-content-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-users fa-2x text-primary me-2"></i>
                            </div>
                            <h6 class="text-muted mb-1 small text-uppercase">Total Teams</h6>
                            <h3 class="mb-0 fw-bold" id="totalTeams">0</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-2">
                    <div class="card border-0 shadow-sm h-100 bg-danger text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-exclamation-triangle fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75">
                                Teams Behind
                                <button class="btn btn-sm btn-link text-white p-0 ms-1" type="button" data-bs-toggle="collapse" data-bs-target="#teamsBehindDetails" aria-expanded="false" aria-controls="teamsBehindDetails" style="text-decoration: none; font-size: 0.7rem;">
                                    <i class="fas fa-chevron-down" id="teamsBehindChevron"></i>
                                </button>
                            </h6>
                            <h3 class="mb-0 fw-bold" id="unpaidTeams">0</h3>
                            <small class="opacity-75" id="unpaidTeamsAmount">$0.00 owed</small>
                            <div class="collapse" id="teamsBehindDetails">
                                <div class="text-start mt-2 pt-2 border-top border-white border-opacity-25" style="font-size: 0.75rem;">
                                    <div id="teamsBehindDetailsList">
                                        <small class="text-muted">No teams behind</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-2" id="sanctionFeesCard">
                    <div class="card border-0 shadow-sm h-100 bg-secondary text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-certificate fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75">
                                <span id="sanctionFeesCardTitle">Sanction Fees</span>
                                <button class="btn btn-sm btn-link text-white p-0 ms-1" type="button" data-bs-toggle="collapse" data-bs-target="#sanctionFeesDetails" aria-expanded="false" aria-controls="sanctionFeesDetails" style="text-decoration: none; font-size: 0.7rem;">
                                    <i class="fas fa-chevron-down" id="sanctionFeesChevron"></i>
                                </button>
                                <i class="fas fa-info-circle ms-1"
                                   style="font-size: 0.75rem; cursor: pointer;"
                                   data-bs-toggle="tooltip"
                                   title="Total = players needing sanction Ã— fee per player.&#10;Paid = players marked paid in weekly payments Ã— fee.&#10;Owed = Total âˆ’ Paid.&#10;To Payout = Paid Ã— payout per player.&#10;Profit = Paid âˆ’ To Payout.">
                                </i>
                            </h6>
                            <h4 class="mb-0 fw-bold" id="totalBCASanctionFees">$0</h4>
                            <div class="collapse" id="sanctionFeesDetails">
                                <div class="text-start mt-2 pt-2 border-top border-white border-opacity-25" style="font-size: 0.75rem;">
                                    <div class="mb-1"><strong>Total:</strong> $<span id="sanctionFeesTotal">0.00</span></div>
                                    <div class="mb-1" style="color: #90EE90;"><strong>Paid:</strong> $<span id="sanctionFeesPaid">0.00</span></div>
                                    <div class="mb-1 text-warning"><strong>Owed:</strong> $<span id="sanctionFeesOwed">0.00</span></div>
                                    <div class="mb-1"><strong>To Payout:</strong> $<span id="sanctionFeesToPayout">0.00</span></div>
                                    <div class="mb-0 fw-bold" style="color: #90EE90;"><strong>Profit:</strong> $<span id="sanctionFeesProfit">0.00</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Projection mode banner (shown when Projection toggle is on) -->
            <div id="projectionBannerContainer" class="mb-3" style="display: none;"></div>
            
            <!-- Financial Breakdown Section -->
            <div class="row mb-4">
                <div class="col-12 mb-3 text-center">
                    <h5 class="text-muted mb-0 fw-bold" style="font-size: 1.1rem; letter-spacing: 0.5px;">
                        <i class="fas fa-money-bill-wave me-2" style="color: #4f46e5;"></i>Financial Breakdown
                    </h5>
                </div>
                <!-- 1. Total Dues Collected -->
                <div class="col-md-3 mb-2">
                    <div class="card border-0 shadow-sm h-100 bg-primary text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-dollar-sign fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75">
                                Total Dues Collected
                                <button class="btn btn-sm btn-link text-white p-0 ms-1" type="button" data-bs-toggle="collapse" data-bs-target="#totalDuesDetails" aria-expanded="false" aria-controls="totalDuesDetails" style="text-decoration: none; font-size: 0.7rem;">
                                    <i class="fas fa-chevron-down" id="totalDuesChevron"></i>
                                </button>
                            </h6>
                            <h3 class="mb-0 fw-bold" id="totalCollected">$0</h3>
                            <div class="collapse" id="totalDuesDetails">
                                <div class="text-start mt-2 pt-2 border-top border-white border-opacity-25" style="font-size: 0.75rem;">
                                    <div id="totalDuesDetailsList">
                                        <small class="text-muted">No payments yet</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 2. Prize Fund -->
                <div class="col-md-3 mb-2">
                    <div class="card border-0 shadow-sm h-100 bg-warning text-dark">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-trophy fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75">
                                Prize Fund
                                <button class="btn btn-sm btn-link text-dark p-0 ms-1" type="button" data-bs-toggle="collapse" data-bs-target="#prizeFundDetails" aria-expanded="false" aria-controls="prizeFundDetails" style="text-decoration: none; font-size: 0.7rem;">
                                    <i class="fas fa-chevron-down" id="prizeFundChevron"></i>
                                </button>
                            </h6>
                            <h4 class="mb-0 fw-bold" id="totalPrizeFund">$0</h4>
                            <div class="collapse mt-2" id="prizeFundDetails">
                                <div class="text-start pt-2 border-top border-dark border-opacity-25" style="font-size: 0.75rem;">
                                    <div id="prizeFundDetailsList">
                                        <small class="text-muted">No prize funds yet</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 3. Parent / National Organization (Second Organization) -->
                <div class="col-md-3 mb-2">
                    <div class="card border-0 shadow-sm h-100 bg-info text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-flag fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75" id="secondOrgCardLabel">Parent/National Organization</h6>
                            <h4 class="mb-0 fw-bold" id="totalUSAPoolLeague">$0</h4>
                        </div>
                    </div>
                </div>
                <!-- 4. League Income (Local League) -->
                <div class="col-md-3 mb-2">
                    <div class="card border-0 shadow-sm h-100 bg-success text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-user-tie fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75">
                                League Income
                                <button class="btn btn-sm btn-link text-white p-0 ms-1" type="button" data-bs-toggle="collapse" data-bs-target="#leagueIncomeDetails" aria-expanded="false" aria-controls="leagueIncomeDetails" style="text-decoration: none; font-size: 0.7rem;">
                                    <i class="fas fa-chevron-down" id="leagueIncomeChevron"></i>
                                </button>
                            </h6>
                            <h4 class="mb-0 fw-bold" id="totalLeagueManager">$0</h4>
                            <div class="collapse mt-2" id="leagueIncomeDetails">
                                <div class="text-start pt-2 border-top border-white border-opacity-25" style="font-size: 0.75rem;">
                                    <div id="leagueIncomeDetailsList">
                                        <small class="text-muted">No league income yet</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Division Breakdown -->


            <!-- Horizontal Controls Bar -->
            <div class="row mb-3">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body py-3">
                            <div class="row align-items-center">
                                <div class="col-md-2 text-center">
                                    <label for="divisionFilter" class="form-label fw-bold mb-1" style="color: #cbd5e1;">
                                        <i class="fas fa-filter me-1"></i>Division
                                    </label>
                                    <select class="form-select form-select-sm text-center" id="divisionFilter" onchange="filterTeamsByDivision()" style="text-align: center; text-align-last: center;">
                                        <option value="all">All Teams</option>
                                    </select>
                                </div>
                                <div class="col-md-2 text-center">
                                    <label for="weekFilter" class="form-label fw-bold mb-1" style="color: #cbd5e1;">
                                        <i class="fas fa-calendar-week me-1"></i>Week
                                    </label>
                                    <select class="form-select form-select-sm text-center" id="weekFilter" onchange="updateWeekDisplay()" style="min-width: 8.5rem; text-align: center; text-align-last: center;">
                                        <option value="1">Week 1</option>
                                        <option value="2">Week 2</option>
                                        <option value="3">Week 3</option>
                                        <option value="4">Week 4</option>
                                        <option value="5">Week 5</option>
                                        <option value="6">Week 6</option>
                                        <option value="7">Week 7</option>
                                        <option value="8">Week 8</option>
                                        <option value="9">Week 9</option>
                                        <option value="10">Week 10</option>
                                        <option value="11">Week 11</option>
                                        <option value="12">Week 12</option>
                                        <option value="13">Week 13</option>
                                        <option value="14">Week 14</option>
                                        <option value="15">Week 15</option>
                                        <option value="16">Week 16</option>
                                        <option value="17">Week 17</option>
                                        <option value="18">Week 18</option>
                                        <option value="19">Week 19</option>
                                        <option value="20">Week 20</option>
                                        <option value="21">Week 21</option>
                                        <option value="22">Week 22</option>
                                        <option value="23">Week 23</option>
                                        <option value="24">Week 24</option>
                                    </select>
                                </div>
                                <div class="col-md-2 offset-md-1 text-center">
                                    <label class="form-label fw-bold mb-1" style="color: #cbd5e1;">
                                        <i class="fas fa-chart-line me-1"></i>View Mode
                                    </label>
                                    <div class="form-check form-switch d-flex justify-content-center">
                                        <input class="form-check-input" type="checkbox" id="projectionModeToggle" onchange="toggleProjectionMode()" style="cursor: pointer;" title="Amounts shown are estimated based on current data.">
                                        <label class="form-check-label" for="projectionModeToggle" style="color: #cbd5e1; cursor: pointer;">
                                            <small>Projection</small>
                                        </label>
                                    </div>
                                    <small class="text-muted" style="font-size: 0.7rem;">End of division Â· amounts estimated</small>
                                </div>
                                <div class="col-md-5 text-center">
                                    <label class="form-label fw-bold mb-1">
                                        <i class="fas fa-tools me-1"></i>Actions
                                    </label>
                                    <div class="d-flex gap-2 justify-content-center">
                                        <button class="btn btn-primary btn-sm" onclick="showAddTeamModal()">
                                            <i class="fas fa-plus me-1"></i>Add Team
                                        </button>
                                        <button class="btn btn-outline-secondary btn-sm" onclick="showArchivedTeamsModal()" title="View archived teams">
                                            <i class="fas fa-archive me-1"></i>Archived Teams
                                        </button>
                                        <button class="btn btn-info btn-sm" onclick="showDivisionManagement()">
                                            <i class="fas fa-cogs me-1"></i>Divisions
                                        </button>
                                        <button class="btn btn-warning btn-sm" onclick="showPlayersView()">
                                            <i class="fas fa-users me-1"></i>Players
                                        </button>
                                        <button class="btn btn-success btn-sm" onclick="refreshData()">
                                            <i class="fas fa-sync-alt me-1"></i>Refresh
                                        </button>
                                        <button class="btn btn-secondary btn-sm" onclick="showExportModal()" title="Export Data">
                                            <i class="fas fa-download me-1"></i>Export
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Teams List -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-center align-items-center">
                            <h5 class="mb-0 text-center">
                                <span class="d-inline-flex align-items-center gap-5">
                                    <i class="fas fa-users"></i>
                                    <span id="teamsSectionTitleText">League Teams</span>
                                    <span class="badge bg-primary fs-6" id="teamCount">0 Teams</span>
                                </span>
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th class="sortable-column" onclick="sortTable('teamName')" style="cursor: pointer;">
                                                Team Name
                                                <i class="fas fa-sort sort-icon" id="sort-icon-teamName"></i>
                                            </th>
                                            <th class="sortable-column" onclick="sortTable('division')" style="cursor: pointer;">
                                                Division
                                                <i class="fas fa-sort sort-icon" id="sort-icon-division"></i>
                                            </th>
                                            <th class="sortable-column" onclick="sortTable('dayOfPlay')" style="cursor: pointer;">
                                                <span class="d-inline-flex align-items-center gap-1">
                                                    Day of Play
                                                    <i class="fas fa-sort sort-icon" id="sort-icon-dayOfPlay"></i>
                                                </span>
                                            </th>
                                            <th class="sortable-column" onclick="sortTable('players')" style="cursor: pointer;">
                                                Players
                                                <i class="fas fa-sort sort-icon" id="sort-icon-players"></i>
                                            </th>
                                            <th id="sanctionFeesTableHeader" class="sortable-column" onclick="sortTable('sanctionStatus')" style="cursor: pointer;">
                                                <span class="d-inline-flex align-items-center gap-1">
                                                    Sanction Status
                                                    <i class="fas fa-sort sort-icon" id="sort-icon-sanctionStatus"></i>
                                                </span>
                                            </th>
                                            <th class="sortable-column" onclick="sortTable('duesStatus')" style="cursor: pointer;">
                                                Dues & Status
                                                <i class="fas fa-info-circle" data-bs-toggle="tooltip" data-bs-placement="top" 
                                                   title="Shows what each team currently owes and their status. Hover the info icon in each row to see how the amount is calculated (dues per player Ã— players per week Ã— matches per week Ã— unpaid weeks)."></i>
                                                <i class="fas fa-sort sort-icon" id="sort-icon-duesStatus"></i>
                                            </th>
                                            <th class="sortable-column" onclick="sortTable('paymentDate')" style="cursor: pointer;">
                                                Payment Date
                                                <i class="fas fa-sort sort-icon" id="sort-icon-paymentDate"></i>
                                            </th>
                                            <th id="weekPaymentColumnHeader" class="sortable-column" style="display: none; cursor: pointer;" onclick="sortTable('weekPayment')">
                                                Week <span id="currentWeekDisplay">1</span> Payment
                                                <i class="fas fa-sort sort-icon" id="sort-icon-weekPayment"></i>
                                            </th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="teamsTable">
                                        <!-- Teams will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                            <!-- Pagination Controls -->
                            <div class="d-flex justify-content-between align-items-center mt-3 px-3 pb-3" id="paginationControls" style="display: none !important;">
                                <div class="d-flex align-items-center gap-2">
                                    <label for="teamsPerPageSelect" class="mb-0 small text-muted">Teams per page:</label>
                                    <select id="teamsPerPageSelect" class="form-select form-select-sm" style="width: auto;" onchange="changeTeamsPerPage(this.value)">
                                        <option value="10">10</option>
                                        <option value="25" selected>25</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                </div>
                                <div class="d-flex align-items-center gap-2">
                                    <button class="btn btn-sm btn-outline-secondary" onclick="goToPage(1)" id="paginationFirst" disabled>
                                        <i class="fas fa-angle-double-left"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="goToPage(currentPage - 1)" id="paginationPrev" disabled>
                                        <i class="fas fa-angle-left"></i> Previous
                                    </button>
                                    <span class="mx-2 small text-muted">
                                        Page <span id="currentPageDisplay">1</span> of <span id="totalPagesDisplay">1</span>
                                        (<span id="totalTeamsDisplay">0</span> teams)
                                    </span>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="goToPage(currentPage + 1)" id="paginationNext" disabled>
                                        Next <i class="fas fa-angle-right"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="goToPage(totalPages)" id="paginationLast" disabled>
                                        <i class="fas fa-angle-double-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Team Modal -->
    <div class="modal fade" id="addTeamModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Team</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 180px); overflow-y: auto;">
                    <!-- Tabs for Edit Mode (hidden when adding new team) -->
                    <ul class="nav nav-tabs mb-3" id="teamModalTabs" style="display: none;">
                        <li class="nav-item">
                            <a class="nav-link active" id="teamDetailsTab" data-bs-toggle="tab" href="#teamDetailsPane" role="tab">
                                <i class="fas fa-edit me-1"></i>Team Details
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="teamActionsTab" data-bs-toggle="tab" href="#teamActionsPane" role="tab">
                                <i class="fas fa-cog me-1"></i>Team Actions
                            </a>
                        </li>
                    </ul>
                    
                    <!-- Tab Content -->
                    <div class="tab-content" id="teamModalTabContent">
                        <!-- Team Details Tab -->
                        <div class="tab-pane fade show active" id="teamDetailsPane" role="tabpanel">
                    <form id="addTeamForm">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="mb-2">
                                    <label for="teamName" class="form-label small">Team Name *
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Enter the name of the team. This will be used to identify the team throughout the system."></i>
                                    </label>
                                    <input type="text" class="form-control form-control-sm" id="teamName" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="mb-2">
                                    <label for="division" class="form-label small">Division *
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Select the division this team will compete in. Divisions are created in the Division Management section. Each division has its own settings for dues, schedule, and number of teams."></i>
                                    </label>
                                    <select class="form-select form-select-sm" id="division" required style="width: 100%;">
                                        <option value="">Select Division</option>
                                        <!-- Divisions will be loaded dynamically -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <h6 class="mt-2 mb-2 small fw-bold">Team Captain
                            <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                               title="The team captain is the primary contact for the team. The captain must be added as a team member first, then selected from the dropdown."></i>
                        </h6>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="captainName" class="form-label small">Captain Name *
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Select the team captain from the list of team members. Add team members first, then select one as captain. The captain can be changed later."></i>
                                    </label>
                                    <select class="form-select form-select-sm" id="captainName" required>
                                        <option value="">Select Captain</option>
                                        <!-- Team members will be populated dynamically -->
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="captainEmail" class="form-label small">Captain Email
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Email address for the team captain. Used for communication and notifications. Optional but recommended."></i>
                                    </label>
                                    <input type="email" class="form-control form-control-sm" id="captainEmail">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="captainPhone" class="form-label small">Captain Phone
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Phone number for the team captain. Used for urgent communications. Optional but recommended."></i>
                                    </label>
                                    <input type="tel" class="form-control form-control-sm" id="captainPhone">
                                </div>
                            </div>
                        </div>
                        
                        <h6 class="mt-3 mb-2 small fw-bold">Team Members
                            <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                               title="Add all players who will be on this team. Click 'Add Member' to add more players. You can remove members using the X button. The captain must be included in the team members list."></i>
                        </h6>
                        <div id="teamMembersContainer" class="border rounded p-2 mb-3" style="max-height: calc(100vh - 500px); min-height: 200px; overflow-y: auto;">
                            <table class="table table-sm table-striped mb-2" style="margin-bottom: 0.5rem !important;">
                                <thead class="table-light sticky-top">
                                    <tr>
                                        <th style="width: 30%;">Name *
                                            <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                               title="Enter the player's full name (Lastname, Firstname format is recommended for consistency)."></i>
                                        </th>
                                        <th style="width: 30%;">Email
                                            <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                               title="Player's email address (optional but recommended for communications)."></i>
                                        </th>
                                        <th id="sanctionStatusHeader" style="width: 25%;">Sanction Status
                                            <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                               title="Indicate if this player has paid their BCA sanction fee for the current season, or if they were previously sanctioned."></i>
                                        </th>
                                        <th style="width: 15%;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="teamMembersList">
                                    <!-- Team members will be added here -->
                                </tbody>
                            </table>
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="addTeamMember()">
                                <i class="fas fa-plus me-1"></i>Add Member
                            </button>
                        </div>
                        
                        <div id="teamJoinDateContainer" class="mb-3" style="display: none;">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="mb-2">
                                        <label for="teamJoinDate" class="form-label small">Join Date
                                            <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                               title="The date when this team was entered into the app/system. This is automatically set and cannot be changed."></i>
                                        </label>
                                        <input type="text" class="form-control form-control-sm" id="teamJoinDate" readonly style="background-color: #f8f9fa; cursor: not-allowed;">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-info mt-3">
                            <small><strong>Note:</strong> Dues per player per match and players per week are set in the division settings. The default dues per player per match can be set in Profile & Settings. Start date is set in division settings.</small>
                        </div>
                    </form>
                        </div>
                        
                        <!-- Team Actions Tab -->
                        <div class="tab-pane fade" id="teamActionsPane" role="tabpanel">
                            <div class="card border-danger">
                                <div class="card-header bg-danger text-white">
                                    <h6 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Team Actions</h6>
                                </div>
                                <div class="card-body">
                                    <p class="text-muted mb-4">Choose an action to perform on this team. All actions are permanent and cannot be undone.</p>
                                    
                                    <div class="d-grid gap-3">
                                        <!-- Remove from Division -->
                                        <div class="card border-warning">
                                            <div class="card-body">
                                                <h6 class="card-title">
                                                    <i class="fas fa-sign-out-alt text-warning me-2"></i>Remove from Division
                                                </h6>
                                                <p class="card-text small text-muted mb-2">
                                                    Removes this team from its current division. The team will remain in the system but will not be associated with any division. You can reassign it to a different division later.
                                                </p>
                                                <button type="button" class="btn btn-outline-warning btn-sm" id="removeFromDivisionBtn" onclick="removeTeamFromDivision()">
                                                    <i class="fas fa-sign-out-alt me-1"></i>Remove from Division
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- Soft Delete -->
                                        <div class="card border-info">
                                            <div class="card-body">
                                                <h6 class="card-title">
                                                    <i class="fas fa-archive text-info me-2"></i>Archive Team (Soft Delete)
                                                </h6>
                                                <p class="card-text small text-muted mb-2">
                                                    Archives the team. The team and all its data will be hidden from the main view but preserved in the system. You can restore it later if needed.
                                                </p>
                                                <button type="button" class="btn btn-outline-info btn-sm" id="archiveTeamBtn" onclick="archiveTeam()">
                                                    <i class="fas fa-archive me-1"></i>Archive Team
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- Permanent Delete -->
                                        <div class="card border-danger">
                                            <div class="card-body">
                                                <h6 class="card-title">
                                                    <i class="fas fa-trash-alt text-danger me-2"></i>Permanently Delete Team
                                                </h6>
                                                <p class="card-text small text-muted mb-2">
                                                    <strong class="text-danger">Warning:</strong> This will permanently delete the team and all associated data including payment history, team members, and all records. This action cannot be undone.
                                                </p>
                                                <button type="button" class="btn btn-danger btn-sm" id="permanentlyDeleteTeamBtn" onclick="permanentlyDeleteTeam()">
                                                    <i class="fas fa-trash-alt me-1"></i>Permanently Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addTeam()">
                        <i class="fas fa-plus me-2"></i>Add Team
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Archived Teams Modal -->
    <div class="modal fade" id="archivedTeamsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-archive me-2"></i>Archived Teams
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto;">
                    <p class="text-muted mb-3">
                        Teams that have been archived are hidden from the main view but preserved in the system. You can restore them here.
                    </p>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-light sticky-top">
                                <tr>
                                    <th style="cursor: pointer;" onclick="sortArchivedTeams('teamName')" title="Click to sort">
                                        Team Name <i class="fas fa-sort text-muted" id="sortIcon-teamName"></i>
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortArchivedTeams('division')" title="Click to sort">
                                        Division <i class="fas fa-sort text-muted" id="sortIcon-division"></i>
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortArchivedTeams('captain')" title="Click to sort">
                                        Captain <i class="fas fa-sort text-muted" id="sortIcon-captain"></i>
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortArchivedTeams('members')" title="Click to sort">
                                        Members <i class="fas fa-sort text-muted" id="sortIcon-members"></i>
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortArchivedTeams('archivedDate')" title="Click to sort">
                                        Archived Date <i class="fas fa-sort text-muted" id="sortIcon-archivedDate"></i>
                                    </th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="archivedTeamsTableBody">
                                <!-- Archived teams will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    <div id="noArchivedTeams" class="alert alert-info" style="display: none;">
                        <i class="fas fa-info-circle me-2"></i>No archived teams found.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Data Modal -->
    <div class="modal fade" id="exportModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-download me-2"></i>Export Data
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-4">
                        Choose what data to export and in which format. You can export teams, payments, financial summaries, and more.
                    </p>
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold">Export Format</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="exportFormat" id="formatCsv" value="csv" checked>
                            <label class="btn btn-outline-primary" for="formatCsv">
                                <i class="fas fa-file-csv me-1"></i>CSV
                            </label>
                            
                            <input type="radio" class="btn-check" name="exportFormat" id="formatExcel" value="excel">
                            <label class="btn btn-outline-success" for="formatExcel">
                                <i class="fas fa-file-excel me-1"></i>Excel
                            </label>
                            
                            <input type="radio" class="btn-check" name="exportFormat" id="formatPdf" value="pdf">
                            <label class="btn btn-outline-danger" for="formatPdf">
                                <i class="fas fa-file-pdf me-1"></i>PDF
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold">Data to Export</label>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="exportTeams" checked>
                            <label class="form-check-label" for="exportTeams">
                                <strong>Teams</strong> - All team information including members, payments, and status
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="exportPayments">
                            <label class="form-check-label" for="exportPayments">
                                <strong>Payment History</strong> - Detailed payment records for all teams
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="exportFinancial">
                            <label class="form-check-label" for="exportFinancial">
                                <strong>Financial Summary</strong> - Dues collected, owed, and breakdown by division
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="exportPlayers">
                            <label class="form-check-label" for="exportPlayers">
                                <strong>Players</strong> - All players with sanction status and contact information
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="exportDivisions">
                            <label class="form-check-label" for="exportDivisions">
                                <strong>Divisions</strong> - Division details and settings
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Filter Options</label>
                        <div class="mb-2">
                            <label for="exportDivisionFilter" class="form-label small">Division (optional)</label>
                            <select class="form-select form-select-sm" id="exportDivisionFilter">
                                <option value="">All Divisions</option>
                            </select>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="exportIncludeArchived">
                            <label class="form-check-label" for="exportIncludeArchived">
                                Include archived teams
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="executeExport()">
                        <i class="fas fa-download me-1"></i>Export
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal fade" id="paymentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Record Payment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="paymentForm">
                        <div class="mb-3">
                            <label for="paymentAmount" class="form-label">Payment Amount</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <select class="form-select" id="paymentAmount">
                                    <!-- Options will be populated dynamically -->
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="paymentDate" class="form-label">Payment Date</label>
                            <input type="date" class="form-control" id="paymentDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="paymentMethod" class="form-label">Payment Method</label>
                            <select class="form-select" id="paymentMethod">
                                <option value="cash">Cash</option>
                                <option value="check">Check</option>
                                <option value="venmo">Venmo</option>
                                <option value="paypal">PayPal</option>
                                <option value="zelle">Zelle</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="paymentNotes" class="form-label">Notes (Optional)</label>
                            <textarea class="form-control" id="paymentNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="recordPayment()">
                        <i class="fas fa-check me-2"></i>Record Payment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Weekly Payment Modal -->
    <div class="modal fade" id="weeklyPaymentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Record Weekly Payment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto;">
                    <form id="weeklyPaymentForm">
                        <div class="mb-3">
                            <label for="weeklyPaymentTeam" class="form-label">Team</label>
                            <div id="weeklyPaymentTeam" class="form-control bg-secondary bg-opacity-10" style="cursor: default; min-height: 38px; pointer-events: none;" aria-readonly="true"></div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="weeklyPaymentWeek" class="form-label">Week</label>
                                    <select class="form-select" id="weeklyPaymentWeek" onchange="populateWeeklyPaymentAmountDropdown()">
                                        <!-- Options will be populated dynamically -->
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="weeklyPaymentAmount" class="form-label">Payment Amount</label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <select class="form-select" id="weeklyPaymentAmount" onchange="updateWeeklyPaymentAmount()">
                                            <!-- Options will be populated dynamically -->
                                        </select>
                                    </div>
                                    <small class="text-muted" id="weeklyPaymentAmountHelp"></small>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Payment status</label>
                            <div class="d-flex flex-wrap gap-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidYes" value="true">
                                    <label class="form-check-label text-success fw-semibold" for="weeklyPaidYes">
                                        Paid
                                        <span class="badge bg-success ms-1"><i class="fas fa-check"></i></span>
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidBye" value="bye">
                                    <label class="form-check-label text-info fw-semibold" for="weeklyPaidBye">
                                        Bye week
                                        <span class="badge bg-info ms-1"><i class="fas fa-pause"></i></span>
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidMakeup" value="makeup">
                                    <label class="form-check-label text-warning fw-semibold" for="weeklyPaidMakeup">
                                        Make up
                                        <span class="badge bg-warning text-dark ms-1"><i class="fas fa-clock"></i></span>
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidNo" value="false" checked>
                                    <label class="form-check-label text-danger fw-semibold" for="weeklyPaidNo">
                                        Unpaid
                                        <span class="badge bg-danger ms-1"><i class="fas fa-times"></i></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div id="bcaSanctionPlayers" class="mb-3 p-3 border rounded">
                            <label class="form-label fw-bold">Include sanction fee in this payment</label>
                            <p class="text-muted small mb-2">Check each player whose sanction fee is included in this payment. Leave unchecked if not included.</p>
                            <div id="bcaSanctionPlayersList">
                                <!-- Players will be populated dynamically -->
                            </div>
                        </div>
                        
                        <div id="sanctionFeeLabel" class="mb-3">
                            <label class="form-label fw-bold">
                                <strong id="sanctionFeeLabelText">Sanction Fee</strong>
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="sanctionFeeAmount" step="0.01" min="0" value="0.00" readonly>
                            </div>
                            <small class="text-muted" id="sanctionFeeHelpText">This amount is automatically calculated based on players marked as needing sanction.</small>
                        </div>
                        
                        <div id="individualPaymentsSection" class="mb-3 p-3 border rounded">
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="enableIndividualPayments" role="switch" onchange="toggleIndividualPayments()">
                                <label class="form-check-label" for="enableIndividualPayments">
                                    <strong>Record individual player payments</strong>
                                    <small class="text-muted d-block">Toggle on to record per-player amounts for this week; they count toward this team's dues.</small>
                                </label>
                            </div>
                            <div id="individualPaymentsContainer" class="mt-2" style="display: none;">
                                <div id="individualPaymentsList">
                                    <!-- Individual payments will be populated dynamically -->
                                </div>
                                <div class="mt-2">
                                    <strong>Weekly team dues: $<span id="weeklyTeamDuesAmount">0.00</span></strong>
                                </div>
                                <div class="mt-2">
                                    <strong>Total Individual Payments: $<span id="individualPaymentsTotal">0.00</span></strong>
                                </div>
                                <div class="mt-2">
                                    <strong>Remaining balance: $<span id="remainingDuesBalance">0.00</span></strong>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="weeklyPaymentDate" class="form-label">Payment Date</label>
                            <input type="date" class="form-control" id="weeklyPaymentDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="weeklyPaymentMethod" class="form-label">Payment Method</label>
                            <select class="form-select" id="weeklyPaymentMethod">
                                <option value="cash">Cash</option>
                                <option value="check">Check</option>
                                <option value="venmo">Venmo</option>
                                <option value="paypal">PayPal</option>
                                <option value="zelle">Zelle</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="weeklyPaymentNotes" class="form-label">Notes (Optional)</label>
                            <textarea class="form-control" id="weeklyPaymentNotes" rows="3"></textarea>
                        </div>
                    </form>
                    <div id="weeklyPaymentSuccess" class="d-none text-center py-4">
                        <p id="weeklyPaymentSuccessMessage" class="text-success mb-0 fs-5"><i class="fas fa-check-circle me-2"></i>Weekly payment saved successfully!</p>
                        <button type="button" class="btn btn-primary mt-3" data-bs-dismiss="modal">OK</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="saveWeeklyPayment()">
                        <i class="fas fa-check me-2"></i>Save Payment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Division Management Modal -->
    <div class="modal fade" id="divisionManagementModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Division Management</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto;">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6>Existing Divisions</h6>
                        <button class="btn btn-primary btn-sm" onclick="showAddDivisionModal()">
                            <i class="fas fa-plus me-1"></i>Add Division
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Division Name</th>
                                    <th>Game Type</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>Total Weeks</th>
                                    <th>Matches per Week</th>
                                    <th>Weekly Dues</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="divisionsTable">
                                <!-- Divisions will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Division Modal -->
    <div class="modal fade" id="addDivisionModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addDivisionModalTitle">Add New Division</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto;">
                    <!-- Smart Builder Option -->
                    <div class="alert alert-info mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas fa-magic me-2"></i>
                                <strong>Quick Import:</strong> Use the Smart Builder to import teams from Fargo/LMS/CSI website
                            </div>
                            <button type="button" class="btn btn-info btn-sm" onclick="openSmartBuilderFromAddDivision()">
                                <i class="fas fa-download me-1"></i>Open Smart Builder
                            </button>
                        </div>
                    </div>
                    
                    <hr class="my-3">
                    
                    <form id="addDivisionForm">
                        <div class="mb-3">
                            <label for="divisionName" class="form-label">Division Name *</label>
                            <input type="text" class="form-control" id="divisionName" required>
                        </div>
                        <div class="mb-3">
                            <label for="gameType" class="form-label">Game Type *</label>
                            <select class="form-select" id="gameType" required onchange="updateGameTypeOptions()">
                                <option value="">Select Game Type</option>
                                <option value="8-ball">8-ball</option>
                                <option value="9-ball">9-ball</option>
                                <option value="10-ball">10-ball</option>
                                <option value="straight-pool">Straight Pool</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="startDate" class="form-label">Start Date *</label>
                                    <input type="date" class="form-control" id="divisionStartDate" required onchange="calculateEndDate()">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="totalWeeks" class="form-label">Total Weeks *</label>
                                    <input type="number" class="form-control" id="totalWeeks" min="1" required onchange="calculateEndDate()">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="endDate" class="form-label">End Date (Auto-calculated)</label>
                            <input type="date" class="form-control" id="divisionEndDate" readonly>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="isDoublePlay" onchange="toggleDoublePlayOptions()">
                                <label class="form-check-label" for="isDoublePlay">
                                    Double Play (plays multiple divisions)
                                </label>
                            </div>
                        </div>
                        <div id="doublePlayOptions" style="display: none;">
                            <div class="mb-3">
                                <label for="secondGameType" class="form-label">Second Game Type</label>
                                <select class="form-select" id="secondGameType" onchange="updateGameTypeOptions()">
                                    <option value="">Select Second Game Type</option>
                                    <option value="8-ball">8-ball</option>
                                    <option value="9-ball">9-ball</option>
                                    <option value="10-ball">10-ball</option>
                                    <option value="straight-pool">Straight Pool</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="matchesPerWeek" class="form-label">Matches per Week *</label>
                            <select class="form-select" id="matchesPerWeek" required>
                                <option value="1">1 match per week</option>
                                <option value="2">2 matches per week</option>
                                <option value="3">3 matches per week</option>
                                <option value="4">4 matches per week</option>
                                <option value="5">5 matches per week</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="weeklyDues" class="form-label">Dues per Player per Match *</label>
                            <select class="form-select" id="divisionWeeklyDues" required>
                                <option value="">Select Amount</option>
                                <option value="5">$5.00</option>
                                <option value="6">$6.00</option>
                                <option value="7">$7.00</option>
                                <option value="8">$8.00</option>
                                <option value="9">$9.00</option>
                                <option value="10">$10.00</option>
                                <option value="11">$11.00</option>
                                <option value="12">$12.00</option>
                                <option value="13">$13.00</option>
                                <option value="14">$14.00</option>
                                <option value="15">$15.00</option>
                                <option value="16">$16.00</option>
                                <option value="17">$17.00</option>
                                <option value="18">$18.00</option>
                                <option value="19">$19.00</option>
                                <option value="20">$20.00</option>
                                <option value="25">$25.00</option>
                                <option value="30">$30.00</option>
                                <option value="35">$35.00</option>
                                <option value="40">$40.00</option>
                                <option value="50">$50.00</option>
                            </select>
                            <small class="text-muted d-block mt-1">
                                <i class="fas fa-info-circle me-1"></i>Amount each player pays per match they play.
                            </small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveDivisionBtn" onclick="addDivision()">
                        <i class="fas fa-plus me-2"></i>Add Division
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Smart Builder Modal -->
    <div class="modal fade" id="smartBuilderModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Smart Team Builder - Import from Fargo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto;">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Smart Builder</strong> allows you to import teams from Fargo and automatically create divisions and teams in your dues tracker.
                    </div>
                    
                    <div class="mb-4">
                        <h6>Step 1: Enter Fargo Rate URL</h6>
                        <div class="mb-3">
                            <label for="fargoLeagueUrl" class="form-label">Fargo Rate League Reports URL *</label>
                            <input type="url" class="form-control" id="fargoLeagueUrl" placeholder="https://www.fargorate.com/leagues/reports?leagueId=...&divisionId=...">
                            <small class="text-muted">Enter the URL from the Fargo Rate League Reports page for your division</small>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="fetchFargoDivisions()">
                            <i class="fas fa-sync me-2"></i>Load Divisions from Fargo
                        </button>
                        <div id="fargoLoading" class="d-none mt-2">
                            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                            <span>Loading divisions from Fargo...</span>
                        </div>
                    </div>
                    
                    <div id="fargoConfig" style="display: none;" class="mb-4">
                        <h6>Step 2: Select Division</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <label for="fargoDivisionSelect" class="form-label">Fargo Division</label>
                                <select class="form-select" id="fargoDivisionSelect" onchange="onDivisionSelected()">
                                    <option value="">-- Select Division --</option>
                                    <!-- Options will be populated dynamically -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="fargoDivisionId" class="form-label">Or Enter Division ID</label>
                                <input type="text" class="form-control" id="fargoDivisionId" placeholder="Enter Fargo Division ID">
                                <button type="button" class="btn btn-sm btn-outline-primary mt-2" onclick="setupManualDivisionIdListener()">
                                    <i class="fas fa-search me-1"></i>Load Division
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="teamsSelectionSection" style="display: none;">
                        <h6>Step 2: Select Teams</h6>
                        <div class="mb-3">
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="toggleAllTeams()">
                                <i class="fas fa-check-square me-1"></i>Toggle All
                            </button>
                            <span class="ms-3"><strong id="selectedTeamsCount">0</strong> teams selected</span>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped" id="fargoTeamsPreview">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox" id="selectAllTeams" onchange="toggleAllTeams()"></th>
                                        <th>Team Name</th>
                                        <th>Captain</th>
                                        <th>Players</th>
                                        <th>Division</th>
                                        <th>Day</th>
                                    </tr>
                                </thead>
                                <tbody id="fargoTeamsPreviewBody">
                                    <!-- Teams will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div id="divisionSettingsSection" style="display: none;" class="mt-4 p-3 border rounded">
                        <h6>Step 4: Division Settings</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="smartBuilderDivisionName" class="form-label" id="divisionNameLabel">Division Name *</label>
                                    <input type="text" class="form-control" id="smartBuilderDivisionName" required>
                                    <small class="text-muted">This will be created in your dues tracker</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="smartBuilderGameType" class="form-label" id="gameTypeLabel">Game Type *</label>
                                    <select class="form-select" id="smartBuilderGameType" required onchange="updateSmartBuilderGameTypeOptions()">
                                        <option value="">Select Game Type</option>
                                        <option value="8-ball">8-ball</option>
                                        <option value="9-ball">9-ball</option>
                                        <option value="10-ball">10-ball</option>
                                        <option value="straight-pool">Straight Pool</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="smartBuilderIsDoublePlay" onchange="toggleSmartBuilderDoublePlayOptions(event)">
                                <label class="form-check-label" for="smartBuilderIsDoublePlay">
                                    Double Play (plays multiple divisions)
                                </label>
                            </div>
                        </div>
                        <div id="smartBuilderDoublePlayOptions" style="display: none;">
                            <div class="alert alert-info mb-3">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Double Play:</strong> This will create two divisions. The field above becomes "Division 1 Name". Enter Division 2 name and select both game types below.
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="smartBuilderDivision2Name" class="form-label">Division 2 Name *</label>
                                        <input type="text" class="form-control" id="smartBuilderDivision2Name" placeholder="e.g., Monday Night">
                                        <small class="text-muted">Name for the second division</small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="smartBuilderSecondGameType" class="form-label">Division 2 Game Type *</label>
                                        <select class="form-select" id="smartBuilderSecondGameType" required onchange="updateSmartBuilderGameTypeOptions()">
                                            <option value="">Select Division 2 Game Type</option>
                                            <option value="8-ball">8-ball</option>
                                            <option value="9-ball">9-ball</option>
                                            <option value="10-ball">10-ball</option>
                                            <option value="straight-pool">Straight Pool</option>
                                        </select>
                                        <small class="text-muted">Game type for Division 2</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="smartBuilderStartDate" class="form-label">First Date of Play *</label>
                                    <input type="date" class="form-control" id="smartBuilderStartDate" required onchange="calculateSmartBuilderEndDate()">
                                    <small id="smartBuilderDayOfWeekDisplay" class="text-muted d-block mt-1" style="display: none;">
                                        <i class="fas fa-calendar-day me-1"></i><span id="smartBuilderDayOfWeekText">-</span>
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="smartBuilderTotalWeeks" class="form-label">Total Weeks *</label>
                                    <select class="form-select" id="smartBuilderTotalWeeks" required onchange="calculateSmartBuilderEndDate()">
                                        <option value="">Select Weeks</option>
                                        <option value="8">8 weeks</option>
                                        <option value="10">10 weeks</option>
                                        <option value="12">12 weeks</option>
                                        <option value="14">14 weeks</option>
                                        <option value="16">16 weeks</option>
                                        <option value="18">18 weeks</option>
                                        <option value="20" selected>20 weeks</option>
                                        <option value="22">22 weeks</option>
                                        <option value="24">24 weeks</option>
                                        <option value="26">26 weeks</option>
                                        <option value="28">28 weeks</option>
                                        <option value="30">30 weeks</option>
                                        <option value="32">32 weeks</option>
                                        <option value="36">36 weeks</option>
                                        <option value="40">40 weeks</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="smartBuilderEndDate" class="form-label">End Date (Auto-calculated)</label>
                                    <input type="date" class="form-control" id="smartBuilderEndDate" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="smartBuilderMatchesPerWeek" class="form-label">Matches per Week (per Division) *</label>
                                    <select class="form-select" id="smartBuilderMatchesPerWeek" required>
                                        <option value="">Select Matches</option>
                                        <option value="1" selected>1 match per week</option>
                                        <option value="2">2 matches per week</option>
                                        <option value="3">3 matches per week</option>
                                        <option value="4">4 matches per week</option>
                                        <option value="5">5 matches per week</option>
                                    </select>
                                    <small class="text-muted d-block mt-1">
                                        <i class="fas fa-info-circle me-1"></i>This is per division. Double play counts as 2 divisions (the app combines them for display).
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="smartBuilderPlayersPerWeek" class="form-label">Players per Week *</label>
                                    <select class="form-select" id="smartBuilderPlayersPerWeek" required>
                                        <option value="">Select Players</option>
                                        <option value="3">3 players</option>
                                        <option value="4">4 players</option>
                                        <option value="5" selected>5 players</option>
                                        <option value="6">6 players</option>
                                        <option value="7">7 players</option>
                                        <option value="8">8 players</option>
                                        <option value="9">9 players</option>
                                        <option value="10">10 players</option>
                                    </select>
                                    <small class="text-muted d-block mt-1">
                                        <i class="fas fa-info-circle me-1"></i>Number of players that play each week (per division).
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="smartBuilderWeeklyDues" class="form-label">Dues per Player per Match *</label>
                                    <select class="form-select" id="smartBuilderWeeklyDues" required>
                                        <option value="">Select Amount</option>
                                        <option value="5">$5.00</option>
                                        <option value="6">$6.00</option>
                                        <option value="7">$7.00</option>
                                        <option value="8" selected>$8.00</option>
                                        <option value="9">$9.00</option>
                                        <option value="10">$10.00</option>
                                        <option value="11">$11.00</option>
                                        <option value="12">$12.00</option>
                                        <option value="13">$13.00</option>
                                        <option value="14">$14.00</option>
                                        <option value="15">$15.00</option>
                                        <option value="16">$16.00</option>
                                        <option value="17">$17.00</option>
                                        <option value="18">$18.00</option>
                                        <option value="19">$19.00</option>
                                        <option value="20">$20.00</option>
                                        <option value="25">$25.00</option>
                                        <option value="30">$30.00</option>
                                        <option value="35">$35.00</option>
                                        <option value="40">$40.00</option>
                                        <option value="50">$50.00</option>
                                    </select>
                                    <small class="text-muted d-block mt-1">
                                        <i class="fas fa-info-circle me-1"></i>Amount each player pays per match they play.
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="continueToPreviewContainer" style="display: none;" class="mt-3">
                        <!-- Continue to Preview button will be added here dynamically -->
                    </div>
                    
                    <div id="previewSection" style="display: none;" class="mt-4">
                        <h6>Step 3: Preview Teams</h6>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Review the teams below before creating.</strong> You can edit team names and captains before finalizing.
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped" id="teamsPreview">
                                <thead>
                                    <tr>
                                        <th>Team Name</th>
                                        <th>Captain</th>
                                        <th>Players</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="teamsPreviewBody">
                                    <!-- Teams preview will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="flex-grow-1 me-3">
                        <div id="divisionStatsFooter" class="d-flex flex-wrap gap-3 align-items-center" style="display: none;">
                            <div class="stat-item">
                                <span class="text-muted small">Division:</span>
                                <strong id="statsDivisionName">-</strong>
                            </div>
                            <div class="stat-item">
                                <span class="text-muted small">Day of Play:</span>
                                <strong id="statsDayOfPlay">-</strong>
                            </div>
                            <div class="stat-item">
                                <span class="text-muted small">Weeks:</span>
                                <strong id="statsTotalWeeks">-</strong>
                            </div>
                            <div class="stat-item">
                                <span class="text-muted small">Teams:</span>
                                <strong id="statsTeamCount">-</strong>
                            </div>
                            <div class="stat-item">
                                <span class="text-muted small">Players:</span>
                                <strong id="statsPlayerCount">-</strong>
                            </div>
                            <div class="stat-item">
                                <span class="text-muted small">Weekly Dues per Team:</span>
                                <strong id="statsWeeklyDuesPerTeam">-</strong>
                            </div>
                        </div>
                    </div>
                    <div>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="createTeamsBtn" onclick="createTeamsAndDivision()" style="display: none;">
                            <i class="fas fa-download me-2"></i>Import to App
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Players Modal -->
    <div class="modal fade" id="playersModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">All Players</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto;">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="playersSearchInput" placeholder="Search players..." oninput="filterPlayersTable()">
                        </div>
                        <div class="col-md-6 text-end">
                            <div id="playersSummaryCards" class="d-flex gap-2 justify-content-end">
                                <!-- Summary cards will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th class="sortable-column" onclick="sortPlayersTable('name')" style="cursor: pointer;">
                                        Player Name
                                        <i class="fas fa-sort sort-icon" id="players-sort-icon-name"></i>
                                    </th>
                                    <th class="sortable-column" onclick="sortPlayersTable('team')" style="cursor: pointer;">
                                        Team
                                        <i class="fas fa-sort sort-icon" id="players-sort-icon-team"></i>
                                    </th>
                                    <th class="sortable-column" onclick="sortPlayersTable('division')" style="cursor: pointer;">
                                        Division
                                        <i class="fas fa-sort sort-icon" id="players-sort-icon-division"></i>
                                    </th>
                                    <th class="sortable-column" onclick="sortPlayersTable('sanctionStatus')" style="cursor: pointer;">
                                        Sanction Status
                                        <i class="fas fa-sort sort-icon" id="players-sort-icon-sanctionStatus"></i>
                                    </th>
                                    <th class="sortable-column" onclick="sortPlayersTable('previouslySanctioned')" style="cursor: pointer;">
                                        Previously Sanctioned
                                        <i class="fas fa-sort sort-icon" id="players-sort-icon-previouslySanctioned"></i>
                                    </th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="playersTableBody">
                                <!-- Players will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Player Modal -->
    <div class="modal fade" id="editPlayerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Player</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto;">
                    <form id="editPlayerForm">
                        <div class="mb-3">
                            <label for="editPlayerName" class="form-label">Player Name</label>
                            <input type="text" class="form-control" id="editPlayerName" readonly style="background-color: #f8f9fa; cursor: not-allowed;">
                            <small class="text-muted">Player name cannot be changed. To rename a player, edit them in their team settings.</small>
                        </div>
                        <div class="mb-3">
                            <label for="editPlayerEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="editPlayerEmail" placeholder="player@example.com">
                        </div>
                        <div class="mb-3">
                            <label for="editPlayerPhone" class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="editPlayerPhone" placeholder="(555) 123-4567">
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Sanction Status</label>
                            <div class="card bg-light mb-2">
                                <div class="card-body p-3">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="editPlayerSanctionPaid">
                                        <label class="form-check-label fw-semibold" for="editPlayerSanctionPaid">
                                            <i class="fas fa-dollar-sign text-success me-1"></i>Sanction Fee Paid
                                        </label>
                                        <small class="d-block text-muted ms-4 mt-1">Player has paid the sanction fee through this system</small>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="editPlayerPreviouslySanctioned">
                                        <label class="form-check-label fw-semibold" for="editPlayerPreviouslySanctioned">
                                            <i class="fas fa-history text-info me-1"></i>Previously Sanctioned
                                        </label>
                                        <small class="d-block text-muted ms-4 mt-1">Player paid elsewhere/earlier for current year (not counted in app totals)</small>
                                    </div>
                                </div>
                            </div>
                            <div id="editPlayerSanctionDatesContainer" style="display: none;" class="mt-3">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-calendar me-1"></i>Sanction Period
                                    <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Set the start and end dates for this sanction. Defaults to calendar year (Jan 1 - Dec 31) if not set."></i>
                                </label>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="editPlayerSanctionStartDate" class="form-label small">Start Date</label>
                                        <input type="date" class="form-control" id="editPlayerSanctionStartDate">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="editPlayerSanctionEndDate" class="form-label small">End Date</label>
                                        <input type="date" class="form-control" id="editPlayerSanctionEndDate">
                                    </div>
                                </div>
                                <small class="text-muted">
                                    <span id="editPlayerSanctionExpired" class="text-danger" style="display: none;">
                                        <i class="fas fa-exclamation-triangle me-1"></i>This sanction has expired.
                                    </span>
                                </small>
                            </div>
                            <small class="text-muted"><i class="fas fa-info-circle me-1"></i>These settings apply to this player across all teams.</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="savePlayerButton" onclick="savePlayerChanges()">
                        <i class="fas fa-save me-2"></i>Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sanction Fee Confirmation Modal -->
    <div class="modal fade" id="sanctionFeeConfirmModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-dollar-sign me-2"></i>Sanction Fee Payment
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">
                        Add <strong id="confirmSanctionFeeAmount">$0.00</strong> sanction fee for 
                        <strong id="confirmSanctionPlayerName">this player</strong> to the total sanction fees collected?
                    </p>
                    <div class="alert alert-info mb-0">
                        <strong>Options:</strong><br>
                        • <strong>Yes</strong>: Add to totals (player paid through this system)<br>
                        • <strong>No</strong>: Mark as "Previously Sanctioned" (paid elsewhere, not counted in totals)<br>
                        • <strong>Cancel</strong>: Don't change status
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="sanctionConfirmCancelBtn" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-outline-info" id="sanctionConfirmPaidElsewhereBtn">
                        <i class="fas fa-history me-1"></i>Paid Elsewhere
                    </button>
                    <button type="button" class="btn btn-success" id="sanctionConfirmAddToTotalsBtn">
                        <i class="fas fa-check me-1"></i>Add to Totals
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment History Modal -->
    <div class="modal fade" id="paymentHistoryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Payment History</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto;">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Week</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Amount</th>
                                    <th>Method</th>
                                    <th>Payment Date</th>
                                    <th>Notes</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="paymentHistoryTableBody">
                                <!-- Payment history will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Profile & Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs mb-3" id="profileTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="profile-tab" role="tab">Profile</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="financial-tab" role="tab">Dues Distribution</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="sanction-tab" role="tab">Sanction Fees</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="subscription-tab" role="tab">Subscription</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="profileTabContent">
                        <div class="tab-pane fade show active" id="profile-pane" role="tabpanel">
                            <form id="profileForm">
                                <div class="mb-3">
                                    <label for="profileName" class="form-label">
                                        Your Name
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Your personal name as the league operator"></i>
                                    </label>
                                    <input type="text" class="form-control" id="profileName">
                                </div>
                                <div class="mb-3">
                                    <label for="profileEmail" class="form-label">
                                        Email
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Your email address (cannot be changed)"></i>
                                    </label>
                                    <input type="email" class="form-control" id="profileEmail" readonly>
                                </div>
                                <div class="mb-3">
                                    <label for="profileOrganizationName" class="form-label">
                                        Organization/League Name
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="The name of your pool league or organization"></i>
                                    </label>
                                    <input type="text" class="form-control" id="profileOrganizationName">
                                </div>
                                <div class="mb-3">
                                    <label for="profilePhone" class="form-label">
                                        Phone
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Your contact phone number (optional)"></i>
                                    </label>
                                    <input type="tel" class="form-control" id="profilePhone">
                                </div>
                                
                                <h6 class="mt-4">Theme</h6>
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="themeToggle" onchange="setTheme(this.checked ? 'dark' : 'light')">
                                        <label class="form-check-label" for="themeToggle">
                                            Dark Mode
                                        </label>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="financial-pane" role="tabpanel">
                            <h6>Financial Breakdown Settings</h6>
                            <div class="mb-3">
                                <label for="profileDefaultDues" class="form-label">
                                    Default Dues Per Player Per Match
                                    <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="The default dues amount charged per player per match. This is used when creating new divisions and can be overridden per division."></i>
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="profileDefaultDues" step="0.01" min="0">
                                </div>
                                <small class="text-muted">This is the default dues rate used when creating new divisions.</small>
                            </div>
                            <hr>
                            <div class="mb-3">
                                <label class="form-label">
                                    Calculation Method
                                    <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Choose how to calculate financial breakdown: Percentage splits the dues by percentage, Dollar Amount uses fixed dollar amounts per team or player."></i>
                                </label>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="calculationMethod" id="methodPercentage" value="percentage" checked onchange="toggleCalculationMethod()">
                                    <label class="form-check-label" for="methodPercentage">
                                        Percentage-based
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="calculationMethod" id="methodDollarAmount" value="dollar" onchange="toggleCalculationMethod()">
                                    <label class="form-check-label" for="methodDollarAmount">
                                        Dollar amount-based
                                    </label>
                                </div>
                                <small class="text-muted">Active format: <span id="activeFormatLabel">Percentage</span></small>
                                <div id="saveToChangeFormatMsg" class="alert alert-warning mt-2" style="display: none;">
                                    <small>Save your profile to change the calculation method.</small>
                                </div>
                            </div>
                            <div id="percentageInputs">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="profilePrizeFundPercentage" class="form-label">
                                                Prize Fund Percentage
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Percentage of dues that goes to the prize fund for tournaments and payouts"></i>
                                            </label>
                                            <div class="input-group">
                                                <input type="number" class="form-control" id="profilePrizeFundPercentage" step="0.1" min="0" max="100">
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="profilePrizeFundName" class="form-label">
                                                Prize Fund Name
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Custom name for your prize fund (e.g., 'Tournament Fund', 'Prize Pool')"></i>
                                            </label>
                                            <input type="text" class="form-control" id="profilePrizeFundName">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="profileFirstOrganizationPercentage" class="form-label">
                                                First Organization Percentage
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Percentage of dues allocated to the first organization (e.g., League Manager)"></i>
                                            </label>
                                            <div class="input-group">
                                                <input type="number" class="form-control" id="profileFirstOrganizationPercentage" step="0.1" min="0" max="100">
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="profileFirstOrganizationName" class="form-label">
                                                First Organization Name
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Name of the first organization that receives a portion of dues (e.g., 'League Manager', 'Local Office')"></i>
                                            </label>
                                            <input type="text" class="form-control" id="profileFirstOrganizationName">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="profileSecondOrganizationPercentage" class="form-label">
                                                Second Organization Percentage
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Percentage of dues allocated to the second organization (e.g., National Office, Parent Organization)"></i>
                                            </label>
                                            <div class="input-group">
                                                <input type="number" class="form-control" id="profileSecondOrganizationPercentage" step="0.1" min="0" max="100">
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="profileSecondOrganizationName" class="form-label">
                                                Second Organization Name
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Name of the second organization that receives a portion of dues (e.g., 'National Office', 'Parent Organization')"></i>
                                            </label>
                                            <input type="text" class="form-control" id="profileSecondOrganizationName">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="dollarAmountInputs" style="display: none;">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="profilePrizeFundAmount" class="form-label">
                                                Prize Fund Amount
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Fixed dollar amount allocated to the prize fund per team or per player (based on Amount Type)"></i>
                                            </label>
                                            <div class="input-group">
                                                <span class="input-group-text">$</span>
                                                <input type="number" class="form-control" id="profilePrizeFundAmount" step="0.01" min="0">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="prizeFundAmountType" class="form-label">
                                                Amount Type
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Whether the prize fund amount is calculated per team or per player"></i>
                                            </label>
                                            <div class="btn-group w-100" role="group">
                                                <input type="radio" class="btn-check" name="prizeFundAmountType" id="prizeFundPerTeam" value="perTeam" checked>
                                                <label class="btn btn-outline-secondary btn-sm" for="prizeFundPerTeam">Per Team</label>
                                                <input type="radio" class="btn-check" name="prizeFundAmountType" id="prizeFundPerPlayer" value="perPlayer">
                                                <label class="btn btn-outline-secondary btn-sm" for="prizeFundPerPlayer">Per Player</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-5">
                                        <div class="mb-3">
                                            <label for="profileFirstOrganizationNameDollar" class="form-label">
                                                First Organization Name
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Name of the first organization that receives a fixed dollar amount"></i>
                                            </label>
                                            <input type="text" class="form-control" id="profileFirstOrganizationNameDollar">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">
                                                Amount Type
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Whether the first organization amount is calculated per team or per player"></i>
                                            </label>
                                            <div class="btn-group w-100" role="group">
                                                <input type="radio" class="btn-check" name="firstOrganizationAmountType" id="firstOrgPerTeam" value="perTeam" checked>
                                                <label class="btn btn-outline-secondary btn-sm" for="firstOrgPerTeam">Per Team</label>
                                                <input type="radio" class="btn-check" name="firstOrganizationAmountType" id="firstOrgPerPlayer" value="perPlayer">
                                                <label class="btn btn-outline-secondary btn-sm" for="firstOrgPerPlayer">Per Player</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="profileFirstOrganizationAmount" class="form-label">
                                                Amount
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Fixed dollar amount allocated to the first organization per team or per player"></i>
                                            </label>
                                            <div class="input-group">
                                                <span class="input-group-text">$</span>
                                                <input type="number" class="form-control" id="profileFirstOrganizationAmount" step="0.01" min="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-5">
                                        <div class="mb-3">
                                            <label for="profileSecondOrganizationNameDollar" class="form-label">
                                                Second Organization Name
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Name of the second organization that receives a fixed dollar amount"></i>
                                            </label>
                                            <input type="text" class="form-control" id="profileSecondOrganizationNameDollar">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">
                                                Amount Type
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Whether the second organization amount is calculated per team or per player"></i>
                                            </label>
                                            <div class="btn-group w-100" role="group">
                                                <input type="radio" class="btn-check" name="secondOrganizationAmountType" id="secondOrgPerTeam" value="perTeam" checked>
                                                <label class="btn btn-outline-secondary btn-sm" for="secondOrgPerTeam">Per Team</label>
                                                <input type="radio" class="btn-check" name="secondOrganizationAmountType" id="secondOrgPerPlayer" value="perPlayer">
                                                <label class="btn btn-outline-secondary btn-sm" for="secondOrgPerPlayer">Per Player</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="profileSecondOrganizationAmount" class="form-label">
                                                Amount
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Fixed dollar amount allocated to the second organization per team or per player"></i>
                                            </label>
                                            <div class="input-group">
                                                <span class="input-group-text">$</span>
                                                <input type="number" class="form-control" id="profileSecondOrganizationAmount" step="0.01" min="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="sanction-pane" role="tabpanel">
                                    <h6>Sanction Fee Settings</h6>
                                    <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="profileSanctionFeesEnabled" onchange="updateSanctionFeeSettings()">
                                    <label class="form-check-label" for="profileSanctionFeesEnabled">
                                        Enable Sanction Fees
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Enable tracking and collection of sanction fees from players"></i>
                                    </label>
                                </div>
                                    </div>
                                    <div id="sanctionFeeSettingsContainer" style="display: none;">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="profileSanctionFeeName" class="form-label">
                                                        Sanction Fee Name
                                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Custom name for your sanction fee (e.g., 'Player Registration', 'Sanction Fee')"></i>
                                                    </label>
                                                    <input type="text" class="form-control" id="profileSanctionFeeName">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="profileSanctionFeeAmount" class="form-label">
                                                        Collection Amount (per player)
                                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="The amount you charge each player for sanction fees"></i>
                                                    </label>
                                                    <div class="input-group">
                                                        <span class="input-group-text">$</span>
                                                        <input type="number" class="form-control" id="profileSanctionFeeAmount" step="0.01" min="0">
                                                    </div>
                                                    <small class="text-muted">What you charge players</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="profileSanctionFeePayoutAmount" class="form-label">
                                                Payout Amount (per player)
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="The amount you pay out to the sanctioning organization for each player"></i>
                                            </label>
                                            <div class="input-group">
                                                <span class="input-group-text">$</span>
                                                <input type="number" class="form-control" id="profileSanctionFeePayoutAmount" step="0.01" min="0">
                                            </div>
                                            <small class="text-muted">What you pay out for each sanction</small>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label fw-bold">
                                                <i class="fas fa-calendar me-1"></i>Default Sanction Period
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Default start and end dates for sanctions. These will be used when marking players as sanctioned unless custom dates are set."></i>
                                            </label>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label for="profileSanctionStartDate" class="form-label small">Start Date</label>
                                                    <input type="date" class="form-control" id="profileSanctionStartDate">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="profileSanctionEndDate" class="form-label small">End Date</label>
                                                    <input type="date" class="form-control" id="profileSanctionEndDate">
                                                </div>
                                            </div>
                                            <small class="text-muted">These dates will be used as defaults when marking players as sanctioned. Individual player dates can be customized in the player editor.</small>
                                        </div>
                                    </div>
                                </div>
                        </div>
                        <div class="tab-pane fade" id="subscription-pane" role="tabpanel">
                            <div id="subscriptionInfo">
                                <div class="text-center py-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="text-muted mt-3">Loading subscription information...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Error/Success Messages -->
                    <div class="px-4 pb-3">
                        <div id="profileError" class="alert alert-danger hidden" role="alert"></div>
                        <div id="profileSuccess" class="alert alert-success hidden" role="alert">
                            <i class="fas fa-check-circle me-2"></i>Profile updated successfully!
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Close
                    </button>
                    <button type="button" id="saveProfileButton" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div class="modal fade" id="alertModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" id="alertModalHeader">
                    <h5 class="modal-title" id="alertModalTitle">Notice</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="alertModalMessage"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Division Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white" id="deleteConfirmModalHeader">
                    <h5 class="modal-title" id="deleteConfirmModalTitle">
                        <i class="fas fa-exclamation-triangle me-2"></i>Confirm Deletion
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="deleteConfirmMessage"></p>
                </div>
                <div class="modal-footer" id="deleteConfirmModalFooter">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                        <i class="fas fa-trash-alt me-2"></i>Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Restore Team Modal -->
    <div class="modal fade" id="restoreTeamModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="restoreTeamModalTitle">
                        <i class="fas fa-undo me-2"></i>Restore Team
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">Select a division to restore <strong id="restoreTeamName"></strong> to:</p>
                    <div id="restoreTeamNoDivisions" style="display: none;">
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>No divisions available.</strong> Please create a division first before restoring this team.
                        </div>
                    </div>
                    <div id="restoreTeamDivisionSelect">
                        <label for="restoreTeamDivision" class="form-label">Division:</label>
                        <select class="form-select" id="restoreTeamDivision">
                            <option value="">Select Division</option>
                        </select>
                        <small class="text-muted">The team will be restored to the selected division.</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="confirmRestoreTeamBtn" disabled>
                        <i class="fas fa-undo me-2"></i>Restore Team
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Permanent Delete Confirmation Modal -->
    <div class="modal fade" id="permanentDeleteConfirmModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="permanentDeleteModalTitle">
                        <i class="fas fa-exclamation-triangle me-2"></i>Permanently Delete Team
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="permanentDeleteStep1">
                        <p class="fw-bold mb-3">⚠️ WARNING: This will permanently delete the team and ALL associated data including:</p>
                        <ul class="mb-3">
                            <li>Payment history</li>
                            <li>Team members</li>
                            <li>All records</li>
                        </ul>
                        <p class="text-danger fw-bold mb-0">This action CANNOT be undone!</p>
                        <p class="mt-3 mb-0">Are you absolutely sure you want to permanently delete <strong id="permanentDeleteTeamName1"></strong>?</p>
                    </div>
                    <div id="permanentDeleteStep2" style="display: none;">
                        <p class="fw-bold text-danger mb-3">FINAL CONFIRMATION</p>
                        <p class="mb-3">You are about to <strong class="text-danger">PERMANENTLY DELETE</strong> <strong id="permanentDeleteTeamName2"></strong>.</p>
                        <p class="text-danger fw-bold mb-0">This is your last chance to cancel.</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="permanentDeleteCancelBtn" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="permanentDeleteConfirmBtn">
                        <i class="fas fa-trash-alt me-2"></i>Yes, Delete Permanently
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
