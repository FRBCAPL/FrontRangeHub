<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="copyright" content="Duezy is owned by Front Range Pool League. © 2026. All rights reserved.">
    <base href="/dues-tracker/">
    <title>Duezy – League Dues, Sorted</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <!-- Export libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <!-- Styles moved to styles.css for better memory management -->
    <script>
    function checkPasswordStrength(val, context) {
      var el = function(id) { return document.getElementById(id); };
      var setReq = function(id, ok) {
        var n = el(id); if (!n) return;
        var i = n.querySelector('i'); if (!i) return;
        i.className = ok ? 'fas fa-check text-success me-1' : 'fas fa-times text-danger me-1';
      };
      if (!val) {
        ['reqLength','reqUpper','reqLower','reqNumber','reqSpecial'].forEach(function(r){ setReq(r, false); });
        var b = el('passwordStrengthBar'); if (b) b.style.width = '0%';
        var t = el('passwordStrengthText'); if (t) t.textContent = '';
        return;
      }
      setReq('reqLength', val.length >= 8);
      setReq('reqUpper', /[A-Z]/.test(val));
      setReq('reqLower', /[a-z]/.test(val));
      setReq('reqNumber', /\d/.test(val));
      setReq('reqSpecial', /[!@#$%^&*]/.test(val));
      if (context === 'reset') {
        var b = el('passwordStrengthBar'); var t = el('passwordStrengthText');
        if (b && t) {
          var s = (val.length >= 8 ? 1 : 0) + (/[A-Z]/.test(val) ? 1 : 0) + (/[a-z]/.test(val) ? 1 : 0) + (/\d/.test(val) ? 1 : 0) + (/[!@#$%^&*]/.test(val) ? 1 : 0);
          b.style.width = (s * 20) + '%'; b.className = 'progress-bar' + (s < 3 ? ' bg-danger' : s < 5 ? ' bg-warning' : ' bg-success'); t.textContent = s < 3 ? 'Weak' : s < 5 ? 'Medium' : 'Strong';
        }
      }
    }
    window.showDivisionManagement = window.showDivisionManagement || function() {
      var m = document.getElementById('divisionManagementModal');
      if (m && window.bootstrap && window.bootstrap.Modal) window.bootstrap.Modal.getOrCreateInstance(m).show();
    };
    </script>
</head>
<body>
    <!-- Login/Register Screen -->
    <div id="loginScreen" class="login-container d-flex align-items-center justify-content-center hidden">
        <div class="card p-4" style="width: 450px;">
            <div class="text-center mb-4 login-brand">
                <a href="/" class="text-decoration-none text-muted mb-2 d-block" style="font-size: 0.9rem;">
                    <i class="fas fa-arrow-left me-1"></i>Back to Homepage
                </a>
                <i class="fas fa-pool fa-3x login-brand-icon mb-3"></i>
                <h1 id="loginScreenTitle" class="login-brand-title">Duezy</h1>
                <p class="login-brand-tagline">League dues, sorted. For League Operators.</p>
                <p class="login-brand-by small text-muted mt-1">by Front Range Pool League</p>
            </div>
            
            <!-- Toggle between Login and Register -->
            <ul class="nav nav-pills nav-justified mb-4" id="authTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="login-tab" data-bs-toggle="pill" data-bs-target="#loginPane" type="button" role="tab">Login</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="register-tab" data-bs-toggle="pill" data-bs-target="#registerPane" type="button" role="tab">Sign Up</button>
                </li>
            </ul>
            
            <div class="tab-content" id="authTabContent">
                <!-- Login Form -->
                <div class="tab-pane fade show active" id="loginPane" role="tabpanel">
                    <!-- Google Sign In Button -->
                    <button type="button" class="btn btn-google w-100 mb-3" onclick="signInWithGoogle()">
                        <i class="fab fa-google me-2"></i>Continue with Google
                    </button>
                    
                    <div class="text-center my-3">
                        <small class="text-muted">OR</small>
                    </div>
                    
                    <!-- Email/Password Login -->
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" required autocomplete="username">
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="password" required autocomplete="current-password">
                        </div>
                        <div class="mb-3 text-end">
                            <a href="#" onclick="showForgotPasswordModal(); return false;" class="text-decoration-none" style="color: #cbd5e1;">
                                <small>Forgot Password?</small>
                            </a>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-sign-in-alt me-2"></i>Login
                        </button>
                    </form>
                    <div id="loginError" class="alert alert-danger mt-3 hidden" role="alert"></div>
                </div>
                
                <!-- Registration Form -->
                <div class="tab-pane fade" id="registerPane" role="tabpanel">
                    <!-- Google Sign Up Button -->
                    <button type="button" class="btn btn-google w-100 mb-3" onclick="signUpWithGoogle()">
                        <i class="fab fa-google me-2"></i>Sign Up with Google
                    </button>
                    
                    <div class="text-center my-3">
                        <small class="text-muted">OR</small>
                    </div>
                    
                    <!-- Email/Password Registration -->
                    <form id="registerForm">
                        <div class="mb-3">
                            <label for="regName" class="form-label">Your Name</label>
                            <input type="text" class="form-control" id="regName" required autocomplete="name">
                        </div>
                        <div class="mb-3">
                            <label for="regEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="regEmail" required autocomplete="email">
                        </div>
                        <div class="mb-3">
                            <label for="regPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="regPassword" required minlength="8" autocomplete="new-password" oninput="checkPasswordStrength(this.value)">
                            <div id="passwordRequirements" class="mt-2">
                                <small class="text-muted d-block">Password must contain:</small>
                                <small id="reqLength" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>At least 8 characters</small>
                                <small id="reqUpper" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>One uppercase letter</small>
                                <small id="reqLower" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>One lowercase letter</small>
                                <small id="reqNumber" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>One number</small>
                                <small id="reqSpecial" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>One special character (!@#$%^&*)</small>
                            </div>
                            <div id="passwordStrength" class="mt-2" style="display: none;">
                                <div class="progress" style="height: 5px;">
                                    <div id="passwordStrengthBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                                </div>
                                <small id="passwordStrengthText" class="text-muted"></small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="regOrgName" class="form-label">Organization/League Name (Optional)</label>
                            <input type="text" class="form-control" id="regOrgName" autocomplete="organization">
                        </div>
                        <button type="submit" class="btn btn-success w-100">
                            <i class="fas fa-user-plus me-2"></i>Create Account
                        </button>
                    </form>
                    <div id="registerError" class="alert alert-danger mt-3 hidden" role="alert"></div>
                    <div id="registerSuccess" class="alert alert-success mt-3 hidden" role="alert">
                        Account created! You can now login.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal fade" id="forgotPasswordModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: #252936; border: 1px solid rgba(255, 255, 255, 0.1);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                    <h5 class="modal-title" style="color: #e2e8f0;">Reset Password</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="color: #e2e8f0;">
                    <p>Enter your email address and we'll send you a link to reset your password.</p>
                    <form id="forgotPasswordForm">
                        <div class="mb-3">
                            <label for="forgotPasswordEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="forgotPasswordEmail" required autocomplete="email" style="background: #2d3142; border: 1px solid rgba(255, 255, 255, 0.1); color: #e2e8f0;">
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-paper-plane me-2"></i>Send Reset Link
                        </button>
                    </form>
                    <div id="forgotPasswordError" class="alert alert-danger mt-3" style="display: none;"></div>
                    <div id="forgotPasswordSuccess" class="alert alert-success mt-3" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div class="modal fade" id="resetPasswordModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: #252936; border: 1px solid rgba(255, 255, 255, 0.1);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                    <h5 class="modal-title" style="color: #e2e8f0;">Set New Password</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="color: #e2e8f0;">
                    <p id="resetPasswordEmailDisplay" class="mb-3"></p>
                    <form id="resetPasswordForm">
                        <input type="hidden" id="resetPasswordToken">
                        <div class="mb-3">
                            <label for="resetPasswordNew" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="resetPasswordNew" required minlength="8" autocomplete="new-password" oninput="checkPasswordStrength(this.value, 'reset')" style="background: #2d3142; border: 1px solid rgba(255, 255, 255, 0.1); color: #e2e8f0;">
                            <div id="resetPasswordRequirements" class="mt-2">
                                <small class="text-muted d-block">Password must contain:</small>
                                <small id="resetReqLength" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>At least 8 characters</small>
                                <small id="resetReqUpper" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>One uppercase letter</small>
                                <small id="resetReqLower" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>One lowercase letter</small>
                                <small id="resetReqNumber" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>One number</small>
                                <small id="resetReqSpecial" class="text-muted d-block"><i class="fas fa-times text-danger me-1"></i>One special character (!@#$%^&*)</small>
                            </div>
                            <div id="resetPasswordStrength" class="mt-2" style="display: none;">
                                <div class="progress" style="height: 5px;">
                                    <div id="resetPasswordStrengthBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                                </div>
                                <small id="resetPasswordStrengthText" class="text-muted"></small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="resetPasswordConfirm" class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="resetPasswordConfirm" required autocomplete="new-password" style="background: #2d3142; border: 1px solid rgba(255, 255, 255, 0.1); color: #e2e8f0;">
                            <small id="resetPasswordMatch" class="text-danger" style="display: none;">Passwords do not match</small>
                        </div>
                        <button type="submit" class="btn btn-success w-100">
                            <i class="fas fa-key me-2"></i>Reset Password
                        </button>
                    </form>
                    <div id="resetPasswordError" class="alert alert-danger mt-3" style="display: none;"></div>
                    <div id="resetPasswordSuccess" class="alert alert-success mt-3" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Feedback Modal -->
    <div class="modal fade" id="feedbackModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: #252936; border: 1px solid rgba(255, 255, 255, 0.1);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                    <h5 class="modal-title" style="color: #e2e8f0;"><i class="fas fa-comment-dots me-2"></i>Send Feedback</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="color: #e2e8f0;">
                    <p class="text-muted small mb-3">Comments, suggestions, or bug reports go to the admin. We read every message.</p>
                    <form id="feedbackForm">
                        <div class="mb-3">
                            <label for="feedbackType" class="form-label">Type</label>
                            <select class="form-select" id="feedbackType" style="background: #2d3142; border: 1px solid rgba(255, 255, 255, 0.1); color: #e2e8f0;">
                                <option value="suggestion">Suggestion</option>
                                <option value="comment">Comment</option>
                                <option value="bug">Bug report</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="feedbackMessage" class="form-label">Message <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="feedbackMessage" rows="4" required maxlength="2000" placeholder="Your feedback..." style="background: #2d3142; border: 1px solid rgba(255, 255, 255, 0.1); color: #e2e8f0;"></textarea>
                            <small class="text-muted"><span id="feedbackCharCount">0</span>/2000</small>
                        </div>
                        <div id="feedbackFormError" class="alert alert-danger py-2" style="display: none;"></div>
                        <div id="feedbackFormSuccess" class="alert alert-success py-2" style="display: none;"></div>
                    </form>
                </div>
                <div class="modal-footer" style="border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="feedbackSubmitBtn" onclick="submitFeedback()">
                        <i class="fas fa-paper-plane me-1"></i>Send
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-container">
        <!-- Navigation -->
        <nav class="navbar navbar-dark bg-dark">
            <div class="container-fluid navbar-inner">
                <div class="navbar-left d-flex align-items-center">
                    <div id="localClock" class="navbar-clock" style="
                        background: rgba(255, 255, 255, 0.1);
                        border: 1px solid rgba(255, 255, 255, 0.2);
                        border-radius: 8px;
                        padding: 6px 12px;
                        font-family: 'Courier New', monospace;
                        font-size: 0.9rem;
                        min-width: 200px;
                        text-align: center;
                    ">
                        <div id="clockTime" style="font-weight: bold; color: #10b981; font-size: 0.95rem;"></div>
                        <div id="clockDate" style="font-size: 0.75rem; color: #ffffff; opacity: 0.9; margin-top: 2px;"></div>
                    </div>
                    <button id="localStorageSettingsBtn" class="btn btn-outline-success btn-sm ms-2" onclick="showLocalStorageSettingsModal()" title="Local storage settings and backup status">
                        <i class="fas fa-database me-1"></i>Local
                    </button>
                </div>
                <span class="navbar-brand mb-0 h1 d-flex align-items-center justify-content-center gap-2" id="navbarBrand">
                    <i class="fas fa-pool me-2"></i>Duezy
                    <span class="badge bg-warning text-dark fs-6 fw-normal px-2 py-1" title="This app is in beta. We're actively improving it.">Beta</span>
                </span>
                <div class="navbar-right d-flex align-items-center flex-nowrap gap-2 gap-md-3">
                    <button id="adminButton" class="btn btn-outline-warning btn-sm" onclick="window.location.href='admin.html'" title="Admin Panel" style="display: none;">
                        <i class="fas fa-shield-alt me-1"></i>Admin
                    </button>
                    <button id="donateNavBtn" class="btn btn-outline-success btn-sm" onclick="showDonateModal()" title="Donate (Cash App / Venmo)" style="display: none;">
                        <i class="fas fa-heart me-1"></i>Donate
                    </button>
                    <button class="btn btn-outline-info navbar-btn-help" onclick="showHelpModal()" title="Help & How-To Guide">
                        <i class="fas fa-question-circle me-1"></i>Help
                    </button>
                    <button class="btn btn-outline-light btn-sm" onclick="showProfileModal()" title="Profile & Settings">
                        <i class="fas fa-user-cog me-1"></i>Settings
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="showFeedbackModal()" title="Send feedback to admin">
                        <i class="fas fa-comment-dots me-1"></i>Feedback
                    </button>
                    <button class="btn btn-outline-light btn-sm" onclick="logout()">
                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                    </button>
                </div>
            </div>
        </nav>

        <div class="container-fluid px-4 pt-2 pb-4 position-relative">
            <!-- Loading overlay (shown during data load/refresh) -->
            <div id="mainContentLoadingOverlay" class="main-loading-overlay d-none" aria-hidden="true">
                <div class="main-loading-spinner">
                    <div class="spinner-border text-light" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="text-white mt-3 mb-0 small">Loading...</p>
                </div>
            </div>
            <!-- Admin: pending approvals alert (shown only to admins when count > 0) -->
            <div id="pendingApprovalsAlert" class="alert alert-warning mb-3 d-none" role="alert">
                <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                    <span><i class="fas fa-user-clock me-2"></i><strong>You have <span id="pendingApprovalsCount">0</span> new user(s) awaiting approval.</strong></span>
                    <a href="admin.html" class="btn btn-warning btn-sm"><i class="fas fa-user-check me-1"></i>Review &amp; Approve</a>
                </div>
            </div>
            <!-- Overview Section - 5 cards in one row, flex to fill space -->
            <div class="row mb-3 dashboard-cards-row justify-content-center">
                <div class="col-12 mb-2 text-center">
                    <h5 class="text-muted mb-0"><i class="fas fa-chart-line me-2"></i>Overview</h5>
                </div>
                <div class="col-6 col-md-4 col-lg mb-2 overview-card-col" id="divisionSpecificSummary">
                    <div class="card border-0 shadow-sm h-100 bg-dark text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-layer-group fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75" id="divisionSpecificTitle">Divisions</h6>
                            <h3 class="mb-0 fw-bold" id="divisionSpecificCollected">0</h3>
                            <small class="opacity-75" id="divisionSpecificSubtitle">Total active divisions</small>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-md-4 col-lg mb-2 overview-card-col">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body text-center d-flex flex-column justify-content-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-users fa-2x text-primary me-2"></i>
                            </div>
                            <h6 class="text-muted mb-1 small text-uppercase">
                                Total Teams
                                <button class="btn btn-link btn-sm p-0 ms-1 text-muted" type="button" data-bs-toggle="collapse" data-bs-target="#totalTeamsDetails" aria-expanded="false" aria-controls="totalTeamsDetails" title="Expand to see details" style="text-decoration: none;">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </h6>
                            <h3 class="mb-0 fw-bold" id="totalTeams">0</h3>
                            <div class="collapse mt-2 pt-2 border-top" id="totalTeamsDetails">
                                <div class="text-start" style="font-size: 0.75rem;">
                                    <div id="totalTeamsPreview"></div>
                                    <a href="#" class="card-show-more-link text-primary" onclick="openTotalTeamsModal(); return false;" id="totalTeamsShowMore" style="display: none;">Show more &rarr;</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-md-4 col-lg mb-2 overview-card-col" id="teamsBehindCard">
                    <div class="card border-0 shadow-sm h-100 bg-danger text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-exclamation-triangle fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75">Teams Behind</h6>
                            <h3 class="mb-0 fw-bold" id="unpaidTeams">0</h3>
                            <small class="opacity-75" id="unpaidTeamsAmount">$0.00 owed</small>
                            <a href="#" class="card-show-more-link d-block mt-1 small text-white-50" onclick="openTeamsBehindModal(); return false;" id="teamsBehindShowMore" style="display: none;">View details &rarr;</a>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-md-4 col-lg mb-2 overview-card-col" id="sanctionFeesCard">
                    <div class="card border-0 shadow-sm h-100 bg-secondary text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-certificate fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75">
                                <span id="sanctionFeesCardTitle">Sanction Fee Collected</span>
                                <i class="fas fa-info-circle ms-1"
                                   style="font-size: 0.75rem; cursor: pointer;"
                                   data-bs-toggle="tooltip"
                                   title="Total = players needing sanction Ã— fee per player.&#10;Paid = players marked paid in weekly payments Ã— fee.&#10;Owed = Total âˆ’ Paid.&#10;To Payout = Paid Ã— payout per player.&#10;Profit = Paid âˆ’ To Payout.">
                                </i>
                            </h6>
                            <h4 class="mb-0 fw-bold" id="totalBCASanctionFees">$0</h4>
                            <small class="d-block small mt-0 text-white opacity-85" id="sanctionFeesPeriodLabel" style="display: none;"></small>
                            <a href="#" class="card-show-more-link d-block mt-1 small text-white-50" onclick="openSanctionFeesModal(); return false;" id="sanctionFeesShowMore">View details &rarr;</a>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-md-4 col-lg mb-2 overview-card-col" id="greenFeesCard" style="display: none;">
                    <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #198754 0%, #20c997 100%); color: white;">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-leaf fa-2x opacity-75 me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75">
                                <span id="greenFeesCardTitle">Green Fee Collected</span>
                                <i class="fas fa-info-circle ms-1"
                                   style="font-size: 0.75rem; cursor: pointer;"
                                   data-bs-toggle="tooltip"
                                   data-bs-placement="top"
                                   title="Expected = teams × weeks × fee. Collected = from weekly payments where green fee included. Owed = Expected − Collected. To Payout = Collected × payout per team-week. Profit = Collected − To Payout.">
                                </i>
                            </h6>
                            <h4 class="mb-0 fw-bold" id="totalGreenFees">$0</h4>
                            <small class="d-block small mt-0 text-white opacity-85">Expected · Collected · Owed · Profit</small>
                            <a href="#" class="card-show-more-link d-block mt-1 small text-white-50" onclick="openGreenFeesModal(); return false;" id="greenFeesShowMore">View details &rarr;</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Financial Breakdown Section - Same responsive grid -->
            <div class="row mb-4 dashboard-cards-row justify-content-center">
                <div class="col-12 mb-3 text-center">
                    <h5 class="text-muted mb-0 fw-bold" style="font-size: 1.1rem; letter-spacing: 0.5px;">
                        <i class="fas fa-money-bill-wave me-2" style="color: #4f46e5;"></i>Financial Breakdown
                    </h5>
                </div>
                <!-- 1. Total Dues Collected -->
                <div class="col-6 col-md-4 col-lg-3 mb-2">
                    <div class="card border-0 shadow-sm h-100 bg-primary text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-dollar-sign fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75">Total Dues Collected</h6>
                            <h3 class="mb-0 fw-bold" id="totalCollected">$0</h3>
                            <small class="d-block text-muted small mt-0" id="totalDuesPeriodLabel" style="display: none;"></small>
                            <a href="#" class="card-show-more-link d-block mt-1 small" onclick="openTotalDuesModal(); return false;" id="totalDuesShowMore" style="display: none;">View details &rarr;</a>
                        </div>
                    </div>
                </div>
                <!-- 2. Prize Fund -->
                <div class="col-6 col-md-4 col-lg-3 mb-2">
                    <div class="card border-0 shadow-sm h-100 bg-warning text-dark">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-trophy fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75">Prize Fund</h6>
                            <h4 class="mb-0 fw-bold" id="totalPrizeFund">$0</h4>
                            <small class="d-block text-muted small mt-0" id="prizeFundPeriodLabel" style="display: none;"></small>
                            <a href="#" class="card-show-more-link d-block mt-1 small" onclick="openPrizeFundModal(); return false;" id="prizeFundShowMore" style="display: none;">View details &rarr;</a>
                        </div>
                    </div>
                </div>
                <!-- 3. Parent / National Organization (Second Organization) -->
                <div class="col-6 col-md-4 col-lg-3 mb-2">
                    <div class="card border-0 shadow-sm h-100 bg-info text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-flag fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75"><span id="secondOrgCardLabel">Parent/National Organization</span></h6>
                            <h4 class="mb-0 fw-bold" id="totalUSAPoolLeague">$0</h4>
                            <small class="d-block small mt-0 text-white opacity-85" id="nationalOrgPeriodLabel" style="display: none;"></small>
                            <a href="#" class="card-show-more-link d-block mt-1 small" onclick="openNationalOrgModal(); return false;" id="nationalOrgShowMore" style="display: none;">View details &rarr;</a>
                        </div>
                    </div>
                </div>
                <!-- 4. League Income (Local League) -->
                <div class="col-6 col-md-4 col-lg-3 mb-2">
                    <div class="card border-0 shadow-sm h-100 bg-success text-white">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <i class="fas fa-user-tie fa-2x me-2"></i>
                            </div>
                            <h6 class="mb-1 small text-uppercase opacity-75"><span id="firstOrgCardLabel">League Income</span></h6>
                            <h4 class="mb-0 fw-bold" id="totalLeagueManager">$0</h4>
                            <small class="d-block small mt-0 text-white opacity-85" id="leagueIncomePeriodLabel" style="display: none;"></small>
                            <a href="#" class="card-show-more-link d-block mt-1 small" onclick="openLeagueIncomeModal(); return false;" id="leagueIncomeShowMore" style="display: none;">View details &rarr;</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Division Breakdown -->

            <!-- Date Range Report banner (shown when Date Range Report toggle is on) -->
            <div id="dateRangeReportBannerContainer" class="mb-3" style="display: none;"></div>
            <!-- Projection mode banner (shown when Projection toggle is on) -->
            <div id="projectionBannerContainer" class="mb-3" style="display: none;"></div>

            <!-- Horizontal Controls Bar -->
            <div class="row mb-3" id="horizontalControlsRow">
                <div class="col-12">
                    <div class="card" id="horizontalControlsCard">
                        <div class="card-body py-3">
                            <div class="row align-items-center">
                                <div class="col-md-2 text-center">
                                    <label for="divisionFilter" class="form-label fw-bold mb-1 controls-label">
                                        <i class="fas fa-filter me-1"></i>Division
                                    </label>
                                    <select class="form-select form-select-sm text-center" id="divisionFilter" onchange="filterTeamsByDivision()" style="text-align: center; text-align-last: center;">
                                        <option value="all">All Teams</option>
                                    </select>
                                </div>
                                <div class="col-md-2 text-center">
                                    <label for="weekFilter" class="form-label fw-bold mb-1 controls-label">
                                        <i class="fas fa-calendar-week me-1"></i>Week
                                    </label>
                                    <select class="form-select form-select-sm text-center" id="weekFilter" onchange="updateWeekDisplay()" style="min-width: 8.5rem; text-align: center; text-align-last: center;">
                                        <option value="1">Week 1</option>
                                        <option value="2">Week 2</option>
                                        <option value="3">Week 3</option>
                                        <option value="4">Week 4</option>
                                        <option value="5">Week 5</option>
                                        <option value="6">Week 6</option>
                                        <option value="7">Week 7</option>
                                        <option value="8">Week 8</option>
                                        <option value="9">Week 9</option>
                                        <option value="10">Week 10</option>
                                        <option value="11">Week 11</option>
                                        <option value="12">Week 12</option>
                                        <option value="13">Week 13</option>
                                        <option value="14">Week 14</option>
                                        <option value="15">Week 15</option>
                                        <option value="16">Week 16</option>
                                        <option value="17">Week 17</option>
                                        <option value="18">Week 18</option>
                                        <option value="19">Week 19</option>
                                        <option value="20">Week 20</option>
                                        <option value="21">Week 21</option>
                                        <option value="22">Week 22</option>
                                        <option value="23">Week 23</option>
                                        <option value="24">Week 24</option>
                                    </select>
                                </div>
                                <div class="col-md-2 text-center">
                                    <label class="form-label fw-bold mb-1 controls-label">
                                        <i class="fas fa-calendar-alt me-1"></i>Date range view
                                    </label>
                                    <div class="form-check form-switch d-flex justify-content-center">
                                        <input class="form-check-input" type="checkbox" id="dateRangeReportToggle" onchange="toggleDateRangeReport()" style="cursor: pointer;" title="View expected, collected, and owed dues for a custom date range.">
                                        <label class="form-check-label controls-label" for="dateRangeReportToggle" style="cursor: pointer;">
                                            <small>On</small>
                                        </label>
                                    </div>
                                    <small class="text-muted" style="font-size: 0.7rem;">Expected, collected &amp; owed</small>
                                </div>
                                <div class="col-md-2 text-center">
                                    <label class="form-label fw-bold mb-1 controls-label">
                                        <i class="fas fa-chart-line me-1"></i>View Mode
                                    </label>
                                    <div class="form-check form-switch d-flex justify-content-center">
                                        <input class="form-check-input" type="checkbox" id="projectionModeToggle" onchange="toggleProjectionMode()" style="cursor: pointer;" title="Amounts shown are estimated based on current data.">
                                        <label class="form-check-label controls-label" for="projectionModeToggle" style="cursor: pointer;">
                                            <small>Projection</small>
                                        </label>
                                    </div>
                                    <small class="text-muted" style="font-size: 0.7rem;">End of division · amounts estimated</small>
                                </div>
                                <div class="col-md-4 text-center">
                                    <label class="form-label fw-bold mb-1">
                                        <i class="fas fa-tools me-1"></i>Actions
                                    </label>
                                    <div class="d-flex flex-wrap gap-2 justify-content-center">
                                        <button class="btn btn-primary btn-sm" onclick="showAddTeamModal()">
                                            <i class="fas fa-plus me-1"></i>Add Team
                                        </button>
                                        <button class="btn btn-info btn-sm" onclick="showDivisionManagement()">
                                            <i class="fas fa-cogs me-1"></i>Divisions
                                        </button>
                                        <button class="btn btn-warning btn-sm" onclick="showPlayersView()">
                                            <i class="fas fa-users me-1"></i>Players
                                        </button>
                                        <button id="refreshDataBtn" class="btn btn-outline-success btn-sm" onclick="refreshData()" title="Refresh data">
                                            <i class="fas fa-sync-alt me-1" id="refreshDataIcon"></i><span id="refreshDataText">Refresh</span>
                                        </button>
                                        <!-- Force line break so secondary actions move to a second row on wider screens -->
                                        <div class="w-100 d-none d-sm-block"></div>
                                        <button class="btn btn-outline-secondary btn-sm" onclick="showArchivedTeamsModal()" title="View archived teams">
                                            <i class="fas fa-archive me-1"></i>Archived
                                        </button>
                                        <button class="btn btn-outline-secondary btn-sm" onclick="showExportModal()" title="Export Data">
                                            <i class="fas fa-download me-1"></i>Export
                                        </button>
                                        <button class="btn btn-outline-secondary btn-sm" onclick="downloadBackup()" title="Download a complete backup of your database (JSON and SQL formats). Save these files to your device, external drive, or cloud storage for safekeeping.">
                                            <i class="fas fa-database me-1"></i>Backup
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Teams List -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex align-items-center position-relative">
                            <div class="d-flex align-items-center" style="min-width: 200px; flex-shrink: 0;">
                                <i class="fas fa-search text-muted me-2"></i>
                                <input type="text" class="form-control form-control-sm" id="teamSearchInput" placeholder="Search teams, division, captain..." oninput="filterTeamsBySearch()" onkeydown="if(event.key==='Escape'){this.value='';filterTeamsBySearch();}">
                            </div>
                            <h5 class="mb-0 position-absolute start-50 translate-middle-x text-center">
                                <span class="d-inline-flex align-items-center gap-2">
                                    <i class="fas fa-users"></i>
                                    <span id="teamsSectionTitleText">League Teams</span>
                                    <span class="badge bg-primary fs-6" id="teamCount">0 Teams</span>
                                </span>
                            </h5>
                            <div style="min-width: 200px; flex-shrink: 0;"></div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th class="sortable-column" onclick="sortTable('teamName')" style="cursor: pointer;">
                                                Team Name
                                                <i class="fas fa-sort sort-icon" id="sort-icon-teamName"></i>
                                            </th>
                                            <th class="sortable-column" onclick="sortTable('division')" style="cursor: pointer;">
                                                Division
                                                <i class="fas fa-sort sort-icon" id="sort-icon-division"></i>
                                            </th>
                                            <th class="sortable-column" onclick="sortTable('dayOfPlay')" style="cursor: pointer;">
                                                <span class="d-inline-flex align-items-center gap-1">
                                                    Day of Play
                                                    <i class="fas fa-sort sort-icon" id="sort-icon-dayOfPlay"></i>
                                                </span>
                                            </th>
                                            <th class="sortable-column" onclick="sortTable('players')" style="cursor: pointer;">
                                                Players
                                                <i class="fas fa-sort sort-icon" id="sort-icon-players"></i>
                                            </th>
                                            <th id="sanctionFeesTableHeader" class="sortable-column" onclick="sortTable('sanctionStatus')" style="cursor: pointer;">
                                                <span class="d-inline-flex align-items-center gap-1">
                                                    Sanction Status
                                                    <i class="fas fa-sort sort-icon" id="sort-icon-sanctionStatus"></i>
                                                </span>
                                            </th>
                                            <th class="sortable-column" onclick="sortTable('duesStatus')" style="cursor: pointer;">
                                                Dues & Status
                                                <i class="fas fa-info-circle" data-bs-toggle="tooltip" data-bs-placement="top" 
                                                   title="Shows what each team currently owes and their status. Hover the info icon in each row to see how the amount is calculated (dues per player Ã— players per week Ã— matches per week Ã— unpaid weeks)."></i>
                                                <i class="fas fa-sort sort-icon" id="sort-icon-duesStatus"></i>
                                            </th>
                                            <th class="sortable-column" onclick="sortTable('paymentDate')" style="cursor: pointer;">
                                                Payment Date
                                                <i class="fas fa-sort sort-icon" id="sort-icon-paymentDate"></i>
                                            </th>
                                            <th id="weekPaymentColumnHeader" class="sortable-column" style="display: none; cursor: pointer;" onclick="sortTable('weekPayment')">
                                                Week <span id="currentWeekDisplay">1</span> Payment
                                                <i class="fas fa-sort sort-icon" id="sort-icon-weekPayment"></i>
                                            </th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="teamsTable">
                                        <!-- Teams will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                            <!-- Pagination Controls -->
                            <div class="d-flex justify-content-between align-items-center mt-3 px-3 pb-3" id="paginationControls" style="display: none !important;">
                                <div class="d-flex align-items-center gap-2">
                                    <label for="teamsPerPageSelect" class="mb-0 small text-muted">Teams per page:</label>
                                    <select id="teamsPerPageSelect" class="form-select form-select-sm" style="width: auto;" onchange="changeTeamsPerPage(this.value)">
                                        <option value="10">10</option>
                                        <option value="25" selected>25</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                </div>
                                <div class="d-flex align-items-center gap-2">
                                    <button class="btn btn-sm btn-outline-secondary" onclick="goToPage(1)" id="paginationFirst" disabled>
                                        <i class="fas fa-angle-double-left"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="goToPage(currentPage - 1)" id="paginationPrev" disabled>
                                        <i class="fas fa-angle-left"></i> Previous
                                    </button>
                                    <span class="mx-2 small text-muted">
                                        Page <span id="currentPageDisplay">1</span> of <span id="totalPagesDisplay">1</span>
                                        (<span id="totalTeamsDisplay">0</span> teams)
                                    </span>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="goToPage(currentPage + 1)" id="paginationNext" disabled>
                                        Next <i class="fas fa-angle-right"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="goToPage(totalPages)" id="paginationLast" disabled>
                                        <i class="fas fa-angle-double-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- App footer: copyright -->
        <footer class="text-center text-muted small py-3 mt-4 border-top border-secondary" id="appFooter" role="contentinfo">
            Duezy is owned by Front Range Pool League. &copy; 2026. All rights reserved.
        </footer>
    </div>

    <!-- Add Team Modal -->
    <div class="modal fade" id="addTeamModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Team</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 180px); overflow-y: auto;">
                    <!-- Tabs for Edit Mode (hidden when adding new team) -->
                    <ul class="nav nav-tabs mb-3" id="teamModalTabs" style="display: none;">
                        <li class="nav-item">
                            <a class="nav-link active" id="teamDetailsTab" data-bs-toggle="tab" href="#teamDetailsPane" role="tab">
                                <i class="fas fa-edit me-1"></i>Team Details
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="teamActionsTab" data-bs-toggle="tab" href="#teamActionsPane" role="tab">
                                <i class="fas fa-cog me-1"></i>Team Actions
                            </a>
                        </li>
                    </ul>
                    
                    <!-- Tab Content -->
                    <div class="tab-content" id="teamModalTabContent">
                        <!-- Team Details Tab -->
                        <div class="tab-pane fade show active" id="teamDetailsPane" role="tabpanel">
                    <form id="addTeamForm">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="mb-2">
                                    <label for="teamName" class="form-label small">Team Name *
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Enter the name of the team. This will be used to identify the team throughout the system."></i>
                                    </label>
                                    <input type="text" class="form-control form-control-sm" id="teamName" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="mb-2">
                                    <label for="division" class="form-label small">Division *
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Select the division this team will compete in. Divisions are created in the Division Management section. Each division has its own settings for dues, schedule, and number of teams."></i>
                                    </label>
                                    <select class="form-select form-select-sm" id="division" required style="width: 100%;">
                                        <option value="">Select Division</option>
                                        <!-- Divisions will be loaded dynamically -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="mb-2">
                                    <label for="teamLocation" class="form-label small">Location
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Optional location information for the team (e.g., city, venue, or address). This will appear in the tooltip when hovering over the team name."></i>
                                    </label>
                                    <input type="text" class="form-control form-control-sm" id="teamLocation" placeholder="e.g., Denver, CO or Pool Hall Name">
                                </div>
                            </div>
                        </div>
                        
                        <h6 class="mt-2 mb-2 small fw-bold">Team Captain
                            <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                               title="The team captain is the primary contact for the team. The captain must be added as a team member first, then selected from the dropdown."></i>
                        </h6>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="captainName" class="form-label small">Captain Name *
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Select the team captain from the list of team members. Add team members first, then select one as captain. The captain can be changed later."></i>
                                    </label>
                                    <select class="form-select form-select-sm" id="captainName" required>
                                        <option value="">Select Captain</option>
                                        <!-- Team members will be populated dynamically -->
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="captainEmail" class="form-label small">Captain Email
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Email address for the team captain. Used for communication and notifications. Optional but recommended."></i>
                                    </label>
                                    <input type="email" class="form-control form-control-sm" id="captainEmail">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="captainPhone" class="form-label small">Captain Phone
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Phone number for the team captain. Used for urgent communications. Optional but recommended."></i>
                                    </label>
                                    <input type="tel" class="form-control form-control-sm" id="captainPhone">
                                </div>
                            </div>
                        </div>
                        
                        <h6 class="mt-3 mb-2 small fw-bold">Team Members
                            <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                               title="Add all players who will be on this team. Click 'Add Member' to add more players. You can remove members using the X button. The captain must be included in the team members list."></i>
                        </h6>
                        <div id="teamMembersContainer" class="border rounded p-2 mb-3" style="max-height: calc(100vh - 500px); min-height: 200px; overflow-y: auto;">
                            <table class="table table-sm table-striped mb-2" style="margin-bottom: 0.5rem !important;">
                                <thead class="table-light sticky-top">
                                    <tr>
                                        <th style="width: 30%;">Name *
                                            <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                               title="Enter the player's full name (Lastname, Firstname format is recommended for consistency)."></i>
                                        </th>
                                        <th style="width: 30%;">Email
                                            <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                               title="Player's email address (optional but recommended for communications)."></i>
                                        </th>
                                        <th id="sanctionStatusHeader" style="width: 25%;">Sanction Status
                                            <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                               title="Indicate if this player has paid their BCA sanction fee for the current season, or if they were previously sanctioned."></i>
                                        </th>
                                        <th style="width: 15%;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="teamMembersList">
                                    <!-- Team members will be added here -->
                                </tbody>
                            </table>
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="addTeamMember()">
                                <i class="fas fa-plus me-1"></i>Add Member
                            </button>
                        </div>
                        
                        <div id="teamJoinDateContainer" class="mb-3" style="display: none;">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="mb-2">
                                        <label for="teamJoinDate" class="form-label small">Join Date
                                            <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" 
                                               title="The date when this team was entered into the app/system. This is automatically set and cannot be changed."></i>
                                        </label>
                                        <input type="text" class="form-control form-control-sm" id="teamJoinDate" readonly style="background-color: #f8f9fa; cursor: not-allowed;">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-info mt-3">
                            <small><strong>Note:</strong> Dues per player per match and players per week are set in the division settings. The default dues per player per match can be set in Profile & Settings. Start date is set in division settings.</small>
                        </div>
                    </form>
                        </div>
                        
                        <!-- Team Actions Tab -->
                        <div class="tab-pane fade" id="teamActionsPane" role="tabpanel">
                            <div class="card border-danger">
                                <div class="card-header bg-danger text-white">
                                    <h6 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Team Actions</h6>
                                </div>
                                <div class="card-body">
                                    <p class="text-muted mb-4">Choose an action to perform on this team. All actions are permanent and cannot be undone.</p>
                                    
                                    <div class="d-grid gap-3">
                                        <!-- Remove from Division -->
                                        <div class="card border-warning">
                                            <div class="card-body">
                                                <h6 class="card-title">
                                                    <i class="fas fa-sign-out-alt text-warning me-2"></i>Remove from Division
                                                </h6>
                                                <p class="card-text small text-muted mb-2">
                                                    Removes this team from its current division. The team will remain in the system but will not be associated with any division. You can reassign it to a different division later.
                                                </p>
                                                <button type="button" class="btn btn-outline-warning btn-sm" id="removeFromDivisionBtn" onclick="removeTeamFromDivision()">
                                                    <i class="fas fa-sign-out-alt me-1"></i>Remove from Division
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- Soft Delete -->
                                        <div class="card border-info">
                                            <div class="card-body">
                                                <h6 class="card-title">
                                                    <i class="fas fa-archive text-info me-2"></i>Archive Team (Soft Delete)
                                                </h6>
                                                <p class="card-text small text-muted mb-2">
                                                    Archives the team. The team and all its data will be hidden from the main view but preserved in the system. You can restore it later if needed.
                                                </p>
                                                <button type="button" class="btn btn-outline-info btn-sm" id="archiveTeamBtn" onclick="archiveTeam()">
                                                    <i class="fas fa-archive me-1"></i>Archive Team
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- Permanent Delete -->
                                        <div class="card border-danger">
                                            <div class="card-body">
                                                <h6 class="card-title">
                                                    <i class="fas fa-trash-alt text-danger me-2"></i>Permanently Delete Team
                                                </h6>
                                                <p class="card-text small text-muted mb-2">
                                                    <strong class="text-danger">Warning:</strong> This will permanently delete the team and all associated data including payment history, team members, and all records. This action cannot be undone.
                                                </p>
                                                <button type="button" class="btn btn-danger btn-sm" id="permanentlyDeleteTeamBtn" onclick="permanentlyDeleteTeam()">
                                                    <i class="fas fa-trash-alt me-1"></i>Permanently Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addTeam()">
                        <i class="fas fa-plus me-2"></i>Add Team
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Archived Teams Modal -->
    <div class="modal fade" id="archivedTeamsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-archive me-2"></i>Archived Teams
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto;">
                    <p class="text-muted mb-3">
                        Teams that have been archived are hidden from the main view but preserved in the system. You can restore them here.
                    </p>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-light sticky-top">
                                <tr>
                                    <th style="cursor: pointer;" onclick="sortArchivedTeams('teamName')" title="Click to sort">
                                        Team Name <i class="fas fa-sort text-muted" id="sortIcon-teamName"></i>
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortArchivedTeams('division')" title="Click to sort">
                                        Division <i class="fas fa-sort text-muted" id="sortIcon-division"></i>
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortArchivedTeams('captain')" title="Click to sort">
                                        Captain <i class="fas fa-sort text-muted" id="sortIcon-captain"></i>
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortArchivedTeams('members')" title="Click to sort">
                                        Members <i class="fas fa-sort text-muted" id="sortIcon-members"></i>
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortArchivedTeams('archivedDate')" title="Click to sort">
                                        Archived Date <i class="fas fa-sort text-muted" id="sortIcon-archivedDate"></i>
                                    </th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="archivedTeamsTableBody">
                                <!-- Archived teams will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    <div id="noArchivedTeams" class="alert alert-info" style="display: none;">
                        <i class="fas fa-info-circle me-2"></i>No archived teams found.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Data Modal -->
    <div class="modal fade" id="exportModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-download me-2"></i>Export Data
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-4">
                        Choose what data to export and in which format. You can export teams, payments, financial summaries, and more.
                    </p>
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold">Export Format</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="exportFormat" id="formatCsv" value="csv" checked>
                            <label class="btn btn-outline-primary" for="formatCsv">
                                <i class="fas fa-file-csv me-1"></i>CSV
                            </label>
                            
                            <input type="radio" class="btn-check" name="exportFormat" id="formatExcel" value="excel">
                            <label class="btn btn-outline-success" for="formatExcel">
                                <i class="fas fa-file-excel me-1"></i>Excel
                            </label>
                            
                            <input type="radio" class="btn-check" name="exportFormat" id="formatPdf" value="pdf">
                            <label class="btn btn-outline-danger" for="formatPdf">
                                <i class="fas fa-file-pdf me-1"></i>PDF
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold">Data to Export</label>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="exportTeams" checked>
                            <label class="form-check-label" for="exportTeams">
                                <strong>Teams</strong> - All team information including members, payments, and status
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="exportPayments">
                            <label class="form-check-label" for="exportPayments">
                                <strong>Payment History</strong> - Detailed payment records for all teams
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="exportFinancial">
                            <label class="form-check-label" for="exportFinancial">
                                <strong>Financial Summary</strong> - Dues collected, owed, and breakdown by division
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="exportPlayers">
                            <label class="form-check-label" for="exportPlayers">
                                <strong>Players</strong> - All players with sanction status and contact information
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="exportDivisions">
                            <label class="form-check-label" for="exportDivisions">
                                <strong>Divisions</strong> - Division details and settings
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Filter Options</label>
                        <div class="mb-2">
                            <label for="exportDivisionFilter" class="form-label small">Division (optional)</label>
                            <select class="form-select form-select-sm" id="exportDivisionFilter" onchange="updateExportTeamFilterOptions()">
                                <option value="">All Divisions</option>
                            </select>
                        </div>
                        <div class="mb-2">
                            <label for="exportTeamFilter" class="form-label small">Team (optional)</label>
                            <select class="form-select form-select-sm" id="exportTeamFilter">
                                <option value="">All Teams</option>
                            </select>
                            <small class="text-muted">Pick a team to export only that team's dues paid, paid by, sanction status, etc.</small>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="exportIncludeArchived" onchange="updateExportTeamFilterOptions()">
                            <label class="form-check-label" for="exportIncludeArchived">
                                Include archived teams
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="executeExport()">
                        <i class="fas fa-download me-1"></i>Export
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help & How-To Guide Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-question-circle me-2"></i>Help & How-To Guide
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto; color: #212529;">
                    <div class="accordion" id="helpAccordion">
                        <!-- Getting Started -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingGettingStarted">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGettingStarted" aria-expanded="true" aria-controls="collapseGettingStarted">
                                    <i class="fas fa-rocket me-2"></i><strong>Getting Started</strong>
                                </button>
                            </h2>
                            <div id="collapseGettingStarted" class="accordion-collapse collapse show" aria-labelledby="headingGettingStarted" data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    <h6><i class="fas fa-info-circle me-2 text-primary"></i>What is Duezy?</h6>
                                    <p>Duezy is a dues-tracking app for league operators. You can track who's paid, who's behind, record payments (cash, Venmo, Cash App, check, etc.), see where the money goes (prize fund, sanction fees, league income), import divisions and teams from FargoRate LMS, and export or backup your data. Sign in with Google or email to get started.</p>
                                    
                                    <h6 class="mt-3"><i class="fas fa-user-plus me-2 text-primary"></i>Creating Your Account</h6>
                                    <p>Sign up using <strong>Google</strong> or <strong>email/password</strong>. Once logged in, you'll see the main dashboard with Overview cards at the top and the teams table below.</p>
                                    
                                    <h6 class="mt-3"><i class="fas fa-th-large me-2 text-primary"></i>Main Screen at a Glance (First-Time Users)</h6>
                                    <p>The top of the page has <strong>Overview</strong> cards (Divisions, Total Teams, Teams Behind, Dues Collected, Prize Fund, League Income, Sanction Fee). Below that is the <strong>Financial Breakdown</strong> section (when applicable). Then comes the <strong>controls bar</strong>:</p>
                                    <ul>
                                        <li><strong>Division</strong> — Filter teams by division or "All Teams"</li>
                                        <li><strong>Week</strong> — Filter by week (shown when a division is selected)</li>
                                        <li><strong>Date range view</strong> — Turn <strong>On</strong> to see expected, collected, and owed dues for any date range</li>
                                        <li><strong>View Mode: Projection</strong> — Turn on to see estimated amounts (Pro &amp; Enterprise)</li>
                                        <li><strong>Actions</strong> — <strong>Add Team</strong>, <strong>Divisions</strong>, <strong>Players</strong>, <strong>Refresh</strong>, <strong>Archived</strong>, <strong>Export</strong>, <strong>Backup</strong></li>
                                    </ul>
                                    <p class="mb-2"><strong>Top bar (left to right):</strong> The <strong>clock</strong> and <strong>Local</strong> button are on the left. <strong>Local</strong> opens local storage settings for this device (enable/disable local cache, clear cache, and view last local snapshot). The app <strong>title</strong> is centered; on the right you have <strong>Donate</strong> (if shown), <strong>Help</strong> (opens this guide), <strong>Settings</strong> (Profile &amp; Settings), <strong>Feedback</strong> (send comments or suggestions to the admin), and <strong>Logout</strong>. If you're an admin, <strong>Admin</strong> appears first for the admin panel.</p>
                                    
                                    <h6 class="mt-3"><i class="fas fa-comment-dots me-2 text-primary"></i>Feedback modal</h6>
                                    <p>Click <strong>Feedback</strong> (between Settings and Logout) to open the feedback form. Choose a <strong>Type</strong> (Suggestion, Comment, Bug report, or Other), enter your <strong>Message</strong>, and click <strong>Send</strong>. Your feedback is sent to the admin for review.</p>
                                    
                                    <h6 class="mt-3"><i class="fas fa-cog me-2 text-primary"></i>Initial Setup (Recommended Order)</h6>
                                    <ol>
                                        <li><strong>Profile &amp; Settings</strong> — Click <strong>Settings</strong> (top right) to configure your league name, contact info, sanction fees (if you use them), and financial breakdown (Prize Fund %, organization names, etc.). You can also view your subscription plan and upgrade.</li>
                                        <li><strong>Create Your First Division</strong> — Click <strong>Divisions</strong> in the Actions row, then either <strong>Import from FargoRate</strong> (Smart Team Builder) or <strong>Add Division</strong> to create a division manually.</li>
                                        <li><strong>Add Teams</strong> — Click <strong>Add Team</strong> to add teams to a division. You can add team name, location, captain, and team members (with sanction status).</li>
                                    </ol>
                                </div>
                            </div>
                        </div>

                        <!-- Settings & Profile -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingSettings">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSettings" aria-expanded="false" aria-controls="collapseSettings">
                                    <i class="fas fa-cog me-2"></i><strong>Settings & Profile</strong>
                                </button>
                            </h2>
                            <div id="collapseSettings" class="accordion-collapse collapse" aria-labelledby="headingSettings" data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    <h6><i class="fas fa-user-cog me-2 text-primary"></i>Profile &amp; Settings</h6>
                                    <p>Click the <strong>Settings</strong> button in the top bar (between Help and Feedback) to configure:</p>
                                    
                                    <h6 class="mt-3"><strong>Profile Tab</strong></h6>
                                    <ul>
                                        <li>League/Organization name</li>
                                        <li>Contact information (email, phone, address)</li>
                                        <li>Password management</li>
                                    </ul>
                                    
                                    <h6 class="mt-3"><strong>Sanction Fees Tab</strong></h6>
                                    <ul>
                                        <li>Enable/disable sanction fee tracking</li>
                                        <li>Set sanction fee name (e.g., "Sanction Fee")</li>
                                        <li>Configure collection amount (what you charge)</li>
                                        <li>Configure payout amount (what you pay out)</li>
                                        <li>Set sanction start/end dates (e.g. typically Jan. 1 – Dec. 1)</li>
                                    </ul>
                                    
                                    <h6 class="mt-3"><strong>Financial Breakdown Tab</strong></h6>
                                    <ul>
                                        <li><strong>Default Players per Week</strong> — The default number of players per team per week. Used when creating new divisions; each division can override this.</li>
                                        <li>Configure how weekly dues are split:
                                            <ul>
                                                <li>Prize Fund percentage</li>
                                                <li>First Organization percentage</li>
                                                <li>Second Organization percentage (if applicable)</li>
                                            </ul>
                                        </li>
                                        <li>Set organization names</li>
                                        <li>Configure prize fund amount (per team or per player)</li>
                                    </ul>
                                    
                                    <h6 class="mt-3"><strong>Subscription/Donate Tab</strong></h6>
                                    <ul>
                                        <li>View your current plan</li>
                                        <li>See plan limits (divisions, teams, players)</li>
                                        <li>Upgrade options (if available)</li>
                                        <li>Donate via Cash App or Venmo (during early access)</li>
                                        <li>Billing information</li>
                                    </ul>
                                    <h6 class="mt-3"><strong>Local Storage (Top-left Local button)</strong></h6>
                                    <ul>
                                        <li><strong>Enable Local Storage</strong> — Stores data on this device for faster loading and offline fallback.</li>
                                        <li><strong>Disable Local Storage</strong> — Stops device caching and relies on live cloud database fetches.</li>
                                        <li><strong>Clear Local Cache</strong> — Deletes only Duezy cache/snapshots on this device (does not delete cloud data or account data).</li>
                                    </ul>
                                    <p class="mt-2 mb-0 small text-muted">The free <strong>Basic</strong> plan includes 2 divisions, up to 32 teams (16 per division), and 8 players per team. <strong>Pro</strong> and <strong>Enterprise</strong> plans add higher limits, Export, and <strong>Projection Mode</strong> for financial forecasting.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Creating Divisions -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingDivisions">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDivisions" aria-expanded="false" aria-controls="collapseDivisions">
                                    <i class="fas fa-layer-group me-2"></i><strong>Creating & Managing Divisions</strong>
                                </button>
                            </h2>
                            <div id="collapseDivisions" class="accordion-collapse collapse" aria-labelledby="headingDivisions" data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    <h6><i class="fas fa-plus-circle me-2 text-success"></i>Creating a Division</h6>
                                    <p>Click the <strong>Divisions</strong> button (in the Actions row above the teams table) to open Division Management. You have two options:</p>
                                    
                                    <h6 class="mt-3"><strong>Option 1: Import from FargoRate</strong></h6>
                                    <p>Click <strong>"Import from FargoRate"</strong> to use the Smart Team Builder. First, get the League Reports URL from FargoRate:</p>
                                    <ol>
                                        <li>Log into your <strong>League Operator (LO) account</strong> in FargoRate LMS.</li>
                                        <li>Select your <strong>league</strong>, then the <strong>division</strong> you want to import. The app only uses the division you choose here.</li>
                                        <li>Click <strong>Reports</strong>. Copy the URL from your browser. Example: <code class="small">https://www.fargorate.com/leagues/reports?leagueId=12345&amp;divisionId=67890</code></li>
                                    </ol>
                                    <p class="alert py-2 px-3 mb-2 small help-fargo-important-banner"><strong>Important:</strong> You must have a <strong>League Operator (LO) account</strong> in FargoRate LMS to import from LMS/Fargo. Do <strong>not</strong> use the dropdown on the Reports page to change division—the app cannot see that; it only finds teams for the division you selected in LMS before clicking Reports. To import a different division, go back to LMS, select that division, then open Reports again and copy the new URL.</p>
                                    <p class="mt-2 mb-2">Then in the Smart Team Builder:</p>
                                    <ol start="4">
                                        <li>Paste the URL, then click <strong>"Load Divisions from FargoRate"</strong>. Teams for that division will load.</li>
                                        <li>Select which teams to include (checkboxes).</li>
                                        <li>Configure division settings (dues, weeks, start date, single/double play).</li>
                                        <li>In the preview, set <strong>Location</strong> for each team, or use the <strong>In-House</strong> checkbox to apply the same location to all teams.</li>
                                        <li>Review the preview, then click <strong>"Create Division"</strong>.</li>
                                    </ol>
                                    <p class="mt-2 mb-0 small text-muted">If your URL doesn’t include a division, you’ll be asked to select a division or enter a Division ID before teams load.</p>
                                    
                                    <h6 class="mt-3"><strong>Option 2: Add Division (manual)</strong></h6>
                                    <p>Create a division first, then add teams via <strong>"Add Team"</strong>:</p>
                                    <ol>
                                        <li>Click <strong>"Add Division"</strong>.</li>
                                        <li>Fill in division name, dues per player, total weeks, start date.</li>
                                        <li>Choose single or double play.</li>
                                        <li><strong>In-House</strong> (optional) — Check "In-House" and enter a default location; new teams added to this division will get that location pre-filled.</li>
                                        <li>Click <strong>"Create Division"</strong> to save.</li>
                                    </ol>
                                    <p class="mb-2 small text-muted">The Smart Builder also has an In-House option in the preview: check it and enter a location to apply the same location to all teams in that import.</p>
                                    
                                    <h6 class="mt-3"><i class="fas fa-edit me-2 text-warning"></i>Editing Divisions</h6>
                                    <p>Click the edit icon (pencil) next to any division to modify its settings. You can update dues rates, weeks, dates, financial breakdown, and division color (color picker). Each new division gets a unique default color; edit to change it.</p>
                                    
                                    <h6 class="mt-3"><i class="fas fa-archive me-2 text-secondary"></i>Archiving Divisions</h6>
                                    <p>Click the archive icon next to a division to choose:</p>
                                    <ul>
                                        <li><strong>Archive division settings only</strong> — Hides the division; teams stay active and appear under "All Teams" until reassigned.</li>
                                        <li><strong>Archive division and all teams</strong> — Archives the division and all its teams. You can restore teams later from the Archived view.</li>
                                    </ul>
                                    <p class="mb-1">Use the <strong>Active</strong> / <strong>Archived</strong> tabs in Division Management to switch views. Restore archived divisions with the restore icon.</p>
                                    
                                    <h6 class="mt-3"><i class="fas fa-copy me-2 text-info"></i>Copying Divisions</h6>
                                    <p>Click the copy icon to duplicate a division's settings into the Add Division form. Great for creating a new session with the same structure—fill in the new name and adjust dates as needed.</p>
                                    
                                    <h6 class="mt-3"><i class="fas fa-sort me-2 text-muted"></i>Division Table</h6>
                                    <p>The Division Management table columns (Division Name, Teams, Game Type, Start Date, End Date, etc.) are <strong>sortable</strong>—click a column header to sort. The <strong>Teams</strong> column shows how many teams are in each division. The <strong>Status</strong> column shows Active or Archived.</p>
                                    
                                    <h6 class="mt-3"><i class="fas fa-trash me-2 text-danger"></i>Deleting Divisions</h6>
                                    <p>Click the delete icon (trash) to permanently remove a division. <strong>Note:</strong> You must remove or reassign all teams from a division before deleting it. Prefer archiving over deleting to keep history.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Adding Teams -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTeams">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTeams" aria-expanded="false" aria-controls="collapseTeams">
                                    <i class="fas fa-users me-2"></i><strong>Adding & Managing Teams</strong>
                                </button>
                            </h2>
                            <div id="collapseTeams" class="accordion-collapse collapse" aria-labelledby="headingTeams" data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    <h6><i class="fas fa-plus-circle me-2 text-success"></i>Adding a Team</h6>
                                    <p>Click the <strong>Add Team</strong> button (in the Actions row above the teams table). Then:</p>
                                    <ol>
                                        <li>Enter <strong>team name</strong> and select a <strong>division</strong></li>
                                        <li>Add <strong>team location</strong> (optional). If the division was created with In-House, the location may be pre-filled.</li>
                                        <li>Add <strong>captain</strong> information (name, email, phone)</li>
                                        <li>Add <strong>team members</strong>: click "Add Member" for each player, and set sanction status (Pending/Paid/Previously Sanctioned) for each</li>
                                        <li>Click <strong>Add Team</strong> to save</li>
                                    </ol>
                                    
                                    <h6 class="mt-3"><i class="fas fa-edit me-2 text-warning"></i>Editing Teams</h6>
                                    <p>Click the edit icon (pencil) next to any team in the main table to:</p>
                                    <ul>
                                        <li>Update team name, division, or location</li>
                                        <li>Add or remove team members</li>
                                        <li>Update player sanction status</li>
                                    </ul>
                                    
                                    <h6 class="mt-3"><i class="fas fa-dollar-sign me-2 text-info"></i>Team Payment History</h6>
                                    <p>Click the "Payment History" button next to a team in the main table (Actions column) to view all payments for that team, including:</p>
                                    <ul>
                                        <li>Week number and date</li>
                                        <li>Payment amount and status</li>
                                        <li>Payment method and who paid</li>
                                        <li>Sanction fees included</li>
                                    </ul>
                                    
                                    <h6 class="mt-3"><i class="fas fa-archive me-2 text-secondary"></i>Archiving Teams</h6>
                                    <p>Archive teams that are no longer active (via the team edit modal → Team Actions tab → Archive Team). Archived teams are hidden from the main view but can be restored later. Click the <strong>Archived</strong> button (in the Actions row) to view and restore archived teams.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Recording Payments -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingPayments">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePayments" aria-expanded="false" aria-controls="collapsePayments">
                                    <i class="fas fa-calendar-week me-2"></i><strong>Recording Weekly Payments</strong>
                                </button>
                            </h2>
                            <div id="collapsePayments" class="accordion-collapse collapse" aria-labelledby="headingPayments" data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    <h6><i class="fas fa-money-bill-wave me-2 text-success"></i>Recording a Payment</h6>
                                    <p><strong>Opening the weekly payment modal:</strong></p>
                                    <ul>
                                        <li><strong>From the main table via Payment History:</strong> Click <strong>"Payment History"</strong> next to the team (Actions column). In the Payment History modal, you can <strong>record</strong> a new weekly payment or <strong>edit</strong> an existing one—click the Edit button (pencil icon) on the row for the week you want. No need to filter by division or week first.</li>
                                        <li><strong>From the main table via Week column:</strong> Select a <strong>specific division</strong> (not "All Teams") and a <strong>week</strong> using the filters. The "Week N Payment" column appears. Click the calendar icon (<i class="fas fa-calendar-week"></i>) next to the team for that week to record or edit that week's payment.</li>
                                    </ul>
                                    <p class="mb-2"><strong>In the Record Weekly Payment modal, follow the flow top to bottom:</strong></p>
                                    <ol>
                                        <li><strong>Team</strong> — Shown at top (read-only). Confirm it's the correct team.</li>
                                        <li><strong>Week</strong> — Select the week this payment applies to (or confirm if pre-filled).</li>
                                        <li><strong>Amount</strong> — Choose from the dropdown. Options include dues-only and dues + sanction fees when applicable.</li>
                                        <li><strong>Date</strong> — Enter the date the payment was received (required).</li>
                                        <li><strong>Method</strong> — Select Cash, Check, Venmo, PayPal, Zelle, CashApp, any custom methods you've added (e.g. Apple Pay), or <strong>Other</strong>. If you choose Other, enter a name for the payment method; it will be saved to your dropdown for future use.</li>
                                        <li><strong>Paid By</strong> — If Method is not Cash, this field appears. Select which team player made the payment (required for non-cash).</li>
                                        <li><strong>Payment status</strong> — Choose one:
                                            <ul>
                                                <li><span class="text-success"><strong>Paid</strong></span> — Dues were paid</li>
                                                <li><span class="text-info"><strong>Bye</strong></span> — Team had a bye; no match or dues this week</li>
                                                <li><span class="text-warning"><strong>Make up</strong></span> — Make-up match scheduled; dues in limbo until played</li>
                                                <li><span class="text-danger"><strong>Unpaid</strong></span> — Dues not yet paid</li>
                                            </ul>
                                        </li>
                                        <li><strong>Include sanction fee</strong> (optional) — Click to expand. Check each player whose sanction fee is included in this payment. The fee amount comes from Settings.</li>
                                        <li><strong>Record per-player payments</strong> (optional) — Toggle on to enter how much each player paid. Useful for tracking who paid what.</li>
                                        <li><strong>Notes</strong> — Add any optional notes (e.g. check number, reference).</li>
                                        <li>Click <strong>"Save Payment"</strong>.</li>
                                    </ol>
                                    
                                    <h6 class="mt-3"><i class="fas fa-edit me-2 text-warning"></i>Editing Payments</h6>
                                    <p>Open <strong>Payment History</strong> next to the team (Actions column), then click the Edit button (pencil icon) on the row for the week you want to change. The Record Weekly Payment modal opens; make your changes and click <strong>"Save Payment"</strong>.</p>
                                    <p class="mb-1"><strong>What causes recalculations (affects totals &amp; financial reports):</strong></p>
                                    <ul class="mb-2">
                                        <li>Changing the <strong>payment amount</strong></li>
                                        <li>Changing <strong>payment status</strong> (Paid / Bye / Make up / Unpaid):
                                            <ul>
                                                <li><strong>Unpaid / Bye / Make up → Paid</strong> adds that amount to collected dues</li>
                                                <li><strong>Paid → Unpaid / Bye / Make up</strong> subtracts that amount from collected dues</li>
                                            </ul>
                                        </li>
                                        <li>Changing <strong>which players have sanction included</strong> in the payment</li>
                                        <li>Changing <strong>per‑player payment</strong> breakdown (when that toggle is on)</li>
                                    </ul>
                                    <p class="mb-1"><strong>What does not cause recalculations:</strong></p>
                                    <ul class="mb-0">
                                        <li>Changing <strong>notes</strong>, <strong>date received</strong>, <strong>payment method</strong>, or <strong>Paid by</strong> (when amount and status stay the same). Those updates are saved but totals stay unchanged.</li>
                                    </ul>
                                    
                                    <h6 class="mt-3"><i class="fas fa-info-circle me-2 text-info"></i>Payment Status Explained</h6>
                                    <ul>
                                        <li><strong>Paid</strong> — Counts toward dues collected and financial totals</li>
                                        <li><strong>Bye</strong> — No match or dues required this week</li>
                                        <li><strong>Make up</strong> — Match rescheduled; dues in limbo until played</li>
                                        <li><strong>Unpaid</strong> — Dues are due but not yet received</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Managing Players -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingPlayers">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePlayers" aria-expanded="false" aria-controls="collapsePlayers">
                                    <i class="fas fa-user-friends me-2"></i><strong>Managing Players</strong>
                                </button>
                            </h2>
                            <div id="collapsePlayers" class="accordion-collapse collapse" aria-labelledby="headingPlayers" data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    <h6><i class="fas fa-users me-2 text-primary"></i>Players View</h6>
                                    <p>Click the <strong>Players</strong> button (in the Actions row) to see all players across all teams. The stats badges at the top (Dues, Sanctioning Stats, Fees) summarize totals. The table includes:</p>
                                    <ul>
                                        <li>Player name and contact information</li>
                                        <li>Which teams they play on</li>
                                        <li>Sanction fee status (Pending/Paid/Previously Sanctioned)</li>
                                        <li>Global player status (updated across all teams)</li>
                                    </ul>
                                    
                                    <h6 class="mt-3"><i class="fas fa-edit me-2 text-warning"></i>Editing Player Information</h6>
                                    <p>From the Players view or team edit modal:</p>
                                    <ol>
                                        <li>Click the edit icon next to a player</li>
                                        <li>Update name, email, or phone</li>
                                        <li>Change sanction status:
                                            <ul>
                                                <li><strong>Pending</strong> - Needs to pay sanction fee</li>
                                                <li><strong>Paid</strong> - Sanction fee paid (you'll be asked if it should be calculated in totals)</li>
                                                <li><strong>Previously Sanctioned</strong> - Already sanctioned elsewhere</li>
                                            </ul>
                                        </li>
                                        <li>Set sanction start/end dates if applicable</li>
                                        <li>Save changes</li>
                                    </ol>
                                    
                                    <h6 class="mt-3"><i class="fas fa-sync me-2 text-info"></i>Global Player Status</h6>
                                    <p>When you update a player's sanction status, it updates across <strong>all teams</strong> that player is on. This ensures consistency throughout your league.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Understanding Dashboard -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingDashboard">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDashboard" aria-expanded="false" aria-controls="collapseDashboard">
                                    <i class="fas fa-chart-line me-2"></i><strong>Understanding the Dashboard</strong>
                                </button>
                            </h2>
                            <div id="collapseDashboard" class="accordion-collapse collapse" aria-labelledby="headingDashboard" data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    <h6><i class="fas fa-chart-bar me-2 text-primary"></i>Overview &amp; Financial Breakdown Cards</h6>
                                    <p>The top of the dashboard has two rows: <strong>Overview</strong> (Divisions, Total Teams, Teams Behind, Sanction Fee) and <strong>Financial Breakdown</strong> (Total Dues Collected, Prize Fund, National Org, League Income).</p>
                                    <p><strong>Expand in place:</strong> Some cards have a chevron (▼) you can click to expand a short preview without leaving the page (e.g., Total Teams shows a quick list).</p>
                                    <p><strong>View details in modals:</strong> Many cards show a <strong>"View details →"</strong> or <strong>"Show more →"</strong> link. Click it to open a <strong>modal</strong> (pop-up) with the full breakdown. Close the modal with the X or by clicking outside. Details by card:</p>
                                    <ul>
                                        <li><strong>Total Teams</strong> — Modal lists teams by division (and "Show more" when there are many).</li>
                                        <li><strong>Teams Behind</strong> — Modal lists teams that owe dues and amounts.</li>
                                        <li><strong>[Sanction Fee Name] Collected</strong> — Modal shows player summary (e.g., "47 players needing × $25 fee, 12 paid"), Total / Owed / Paid / To Payout / Profit, and per-division breakdown when viewing All Teams.</li>
                                        <li><strong>Total Dues Collected</strong> — Modal shows breakdown by division.</li>
                                        <li><strong>Prize Fund</strong> — Modal shows prize fund collected (based on your percentage settings).</li>
                                        <li><strong>National Org</strong> (e.g. CSI) — Modal shows that organization's portion of dues.</li>
                                        <li><strong>League Income</strong> — Modal shows your organization's portion of dues.</li>
                                    </ul>
                                    
                                    <h6 class="mt-3"><i class="fas fa-table me-2 text-info"></i>Teams Table</h6>
                                    <p>The main table shows all teams with:</p>
                                    <ul>
                                        <li><strong>Team Name</strong> - Hover to see captain and location</li>
                                        <li><strong>Division</strong> - Color-coded by division</li>
                                        <li><strong>Dues & Status</strong>:
                                            <ul>
                                                <li>Amount owed/collected</li>
                                                <li>Info icon (hover for detailed breakdown)</li>
                                                <li>Status indicators (Current, Overdue, Makeup)</li>
                                                <li>Red "Owes" text appears 24 hours after play date</li>
                                                <li>Yellow "Owes" for makeup matches</li>
                                            </ul>
                                        </li>
                                        <li><strong>Actions</strong> - Edit, Payment History, Archive</li>
                                    </ul>
                                    
                                    <h6 class="mt-3"><i class="fas fa-filter me-2 text-warning"></i>Filters &amp; Controls</h6>
                                    <p>The controls bar (above the teams table) includes:</p>
                                    <ul>
                                        <li><strong>Division</strong> — View teams from a specific division or "All Teams"</li>
                                        <li><strong>Week</strong> — Appears when a division is selected; filter by week. The "Week N Payment" column appears so you can record or edit that week's payment for each team.</li>
                                        <li><strong>Date range view</strong> — Turn <strong>On</strong> to see expected, collected, and owed dues for any date range. Pick start/end dates and optionally a division. Great for board meetings and reporting.</li>
                                        <li><strong>View Mode: Projection</strong> — Turn on to see estimated amounts through the end of the division or a selected period (Pro &amp; Enterprise).</li>
                                        <li><strong>Search</strong> — Use the search box above the table to search teams by name, division, or captain.</li>
                                    </ul>
                                    <p class="mb-0"><strong>Actions row:</strong> Add Team, Divisions, Players, Refresh, Archived, Export, Backup. Use <strong>Players</strong> to see all players across teams with sanction status; use <strong>Archived</strong> to view and restore archived teams; use <strong>Export</strong> (Pro/Enterprise) or <strong>Backup</strong> (all users) to download your data.</p>
                                    
                                    <h6 class="mt-3"><i class="fas fa-chart-line me-2 text-info"></i>Projection Mode (Pro &amp; Enterprise)</h6>
                                    <p>Turn on the <strong>Projection</strong> toggle to see estimated amounts through the end of each division (or a selected period). A banner appears above the toggle with filters:</p>
                                    <ul>
                                        <li><strong>Period</strong> — End of division, 1 Week, 1 Month, 2 Months, 6 Months, or Custom range (pick start and end dates)</li>
                                        <li><strong>Division</strong> — Project for a single division or All Teams</li>
                                    </ul>
                                    <p class="mb-2 small text-muted">When you select a capped period (e.g., 1 Week), the cards show <em>only</em> projected amounts for that period, not actual + projected. Great for budgeting and forecasting.</p>
                                    
                                    <h6 class="mt-3"><i class="fas fa-info-circle me-2 text-success"></i>Dues Status Indicators</h6>
                                    <ul>
                                        <li><strong>Green</strong> - All dues paid and current</li>
                                        <li><strong>Red</strong> - Dues overdue (24+ hours after play date)</li>
                                        <li><strong>Yellow</strong> - Makeup match (dues in limbo)</li>
                                        <li><strong>Info Icon</strong> - Hover to see detailed dues calculation breakdown</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Exporting Data -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingExport">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExport" aria-expanded="false" aria-controls="collapseExport">
                                    <i class="fas fa-download me-2"></i><strong>Exporting Data</strong>
                                </button>
                            </h2>
                            <div id="collapseExport" class="accordion-collapse collapse" aria-labelledby="headingExport" data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    <h6><i class="fas fa-file-export me-2 text-primary"></i>Export Options</h6>
                                    <p>Click the <strong>Export</strong> button (in the Actions row) to export your data. <strong>Export is available on Pro and Enterprise plans.</strong> Formats:</p>
                                    <ul>
                                        <li><strong>CSV</strong> - Multiple CSV files (one per data type)</li>
                                        <li><strong>Excel</strong> - Single Excel workbook with multiple sheets</li>
                                        <li><strong>PDF</strong> - Formatted PDF report</li>
                                    </ul>
                                    
                                    <h6 class="mt-3"><i class="fas fa-check-square me-2 text-success"></i>What You Can Export</h6>
                                    <ul>
                                        <li><strong>Teams</strong> - All team information, members, payments, status</li>
                                        <li><strong>Payment History</strong> - Detailed payment records with paid-by, sanction players, status</li>
                                        <li><strong>Financial Summary</strong> - Dues collected, owed, breakdown by division</li>
                                        <li><strong>Players</strong> - All players with sanction status and contact info</li>
                                        <li><strong>Divisions</strong> - Division details and settings</li>
                                    </ul>
                                    
                                    <h6 class="mt-3"><i class="fas fa-filter me-2 text-info"></i>Filtering Exports</h6>
                                    <ul>
                                        <li><strong>Division Filter</strong> - Export only teams from a specific division</li>
                                        <li><strong>Team Filter</strong> - Export only a specific team's data (great for detailed team reports)</li>
                                        <li><strong>Include Archived</strong> - Include archived teams in the export</li>
                                    </ul>
                                    
                                    <p class="mt-3"><strong>Tip:</strong> When exporting a specific team, you'll get all their dues paid, who paid, sanction status, and payment history - perfect for team-specific reports!</p>
                                    
                                    <h6 class="mt-4"><i class="fas fa-database me-2 text-info"></i>Backup to Your Device</h6>
                                    <p>Click the <strong>Backup</strong> button (in the Actions row, next to Export) to download a complete backup of your database to your own device. <strong>Backup is free for all users</strong> (Export is Pro/Enterprise).</p>
                                    <ul>
                                        <li><strong>JSON</strong> — Full backup in JSON format (machine-readable)</li>
                                        <li><strong>SQL</strong> — SQL backup (human-readable, can be used for restore)</li>
                                        <li>Both files are saved with a timestamp (e.g. <code>dues-tracker-backup-2026-01-27-143000</code>)</li>
                                        <li>Store backups on your computer, external drive, or cloud storage (Google Drive, Dropbox, etc.)</li>
                                        <li>Run a backup regularly (e.g. weekly) or before major changes</li>
                                    </ul>
                                    <p class="mb-0"><strong>Tip:</strong> Backup is free and available to all users. Save your backups in a safe place!</p>
                                </div>
                            </div>
                        </div>

                        <!-- Tips & Best Practices -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTips">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTips" aria-expanded="false" aria-controls="collapseTips">
                                    <i class="fas fa-lightbulb me-2"></i><strong>Tips & Best Practices</strong>
                                </button>
                            </h2>
                            <div id="collapseTips" class="accordion-collapse collapse" aria-labelledby="headingTips" data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    <h6><i class="fas fa-star me-2 text-warning"></i>Getting the Most Out of Dues Tracker</h6>
                                    
                                    <h6 class="mt-3"><strong>1. Set Up Your Profile First</strong></h6>
                                    <p>Before adding teams, configure your sanction fees and financial breakdown in Settings. These settings apply to all divisions unless overridden.</p>
                                    
                                    <h6 class="mt-3"><strong>2. Use Consistent Naming</strong></h6>
                                    <p>Use consistent team and player names. Player names are matched across teams, so "John Smith" and "John A. Smith" will be treated as different players.</p>
                                    
                                    <h6 class="mt-3"><strong>3. Record Payments Weekly</strong></h6>
                                    <p>Record payments as soon as you receive them. The system tracks which week each payment applies to, so you can see payment history and outstanding balances.</p>
                                    
                                    <h6 class="mt-3"><strong>4. Use the "Paid By" Field</strong></h6>
                                    <p>For non-cash payments, always record who made the payment. This helps with tracking and reconciliation.</p>
                                    
                                    <h6 class="mt-3"><strong>4b. Add Custom Payment Methods</strong></h6>
                                    <p>When recording a payment, if you choose <strong>Other</strong> as the method, you can enter a name (e.g. Apple Pay, Venmo Business). That name is saved to your account and will appear in the Method dropdown next time—no need to re-enter it.</p>
                                    
                                    <h6 class="mt-3"><strong>5. Mark Make-up Matches</strong></h6>
                                    <p>When a match is rescheduled, mark it as "Make up" in the payment status. This keeps the dues in limbo until the match is actually played.</p>
                                    
                                    <h6 class="mt-3"><strong>6. Backup & Export Regularly</strong></h6>
                                    <p>Use the <strong>Backup</strong> button to download a full database backup to your device (JSON + SQL). Store it on your computer, external drive, or cloud storage. Export (CSV/Excel/PDF) is great for reports. Backup is free for all users.</p>
                                    
                                    <h6 class="mt-3"><strong>7. Use Division Colors</strong></h6>
                                    <p>Each division has a color (editable in the Edit Division modal). New divisions get a unique default color. Use colors to quickly identify teams in the main table.</p>
                                    
                                    <h6 class="mt-3"><strong>8. Archive Instead of Delete</strong></h6>
                                    <p>Archive teams and divisions instead of deleting. Teams: archive preserves payment history and allows restore. Divisions: choose to archive settings only (teams stay active) or archive with all teams.</p>
                                    
                                    <h6 class="mt-3"><strong>9. Copy Divisions for New Sessions</strong></h6>
                                    <p>Use the copy icon in Division Management to duplicate a division's settings. Great for creating a new season or session with the same structure.</p>
                                    
                                    <h6 class="mt-3"><strong>10. Use Projection Mode (Pro+)</strong></h6>
                                    <p>Turn on Projection to forecast dues and sanction fees. Use <strong>Date range view</strong> to see expected, collected, and owed dues for any date range. Filter by division for budgeting and planning.</p>
                                    
                                    <h6 class="mt-3"><strong>11. Check Payment History</strong></h6>
                                    <p>Click the "Payment History" button next to a team in the main table to see a complete record of all payments for that team, including who paid, when, and what method was used.</p>
                                    
                                    <h6 class="mt-3"><strong>12. Use Tooltips</strong></h6>
                                    <p>Hover over info icons and labels throughout the app to see helpful tooltips explaining what each field does.</p>
                                    
                                    <h6 class="mt-3"><strong>13. Reopen This Guide &amp; Send Feedback</strong></h6>
                                    <p>Click the <strong>Help</strong> button (top right) to open this guide whenever you need it. Use the <strong>Feedback</strong> button (between Settings and Logout) to send comments, suggestions, or bug reports to the admin—we read every message. You can also choose "Don't show this again when I sign in" in this modal's footer if you prefer not to see the guide automatically on login.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Troubleshooting -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTroubleshooting">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTroubleshooting" aria-expanded="false" aria-controls="collapseTroubleshooting">
                                    <i class="fas fa-tools me-2"></i><strong>Troubleshooting</strong>
                                </button>
                            </h2>
                            <div id="collapseTroubleshooting" class="accordion-collapse collapse" aria-labelledby="headingTroubleshooting" data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    <h6><i class="fas fa-question-circle me-2 text-danger"></i>Common Issues</h6>
                                    
                                    <h6 class="mt-3"><strong>Can't add a team to a division</strong></h6>
                                    <p>If you get a "Division is full" error, check the division's <strong>Team Capacity</strong> (max teams allowed, from your plan). Capacity is set in the division editor—it's the limit from your plan, not the current team count. If the capacity is 0, the division has unlimited capacity. If you've reached the capacity, increase it (up to your plan's limit) or remove teams from the division.</p>
                                    
                                    <h6 class="mt-3"><strong>Payment not showing in totals</strong></h6>
                                    <p>Make sure the payment status is set to "Paid" (not "Unpaid" or "Make up"). Only "Paid" payments count toward financial totals.</p>
                                    
                                    <h6 class="mt-3"><strong>Can't see a team</strong></h6>
                                    <ul>
                                        <li>Check if it's archived (click "Archived" button)</li>
                                        <li>Check the Division filter (make sure "All Teams" is selected if you expect to see every team)</li>
                                        <li>Try refreshing the page</li>
                                    </ul>
                                    
                                    <h6 class="mt-3"><strong>Can't see a division</strong></h6>
                                    <p>If a division is missing, open Division Management and switch to the <strong>Archived</strong> tab. Archived divisions and their teams can be restored with the restore icon.</p>
                                    
                                    <h6 class="mt-3"><strong>Sanction fees not calculating</strong></h6>
                                    <p>Make sure:
                                        <ul>
                                            <li>Sanction fees are enabled in Settings</li>
                                            <li>Players are marked as needing sanction (Pending or Paid status)</li>
                                            <li>When recording payments, you check the players whose sanction fees are included</li>
                                        </ul>
                                    </p>
                                    
                                    <h6 class="mt-3"><strong>Export not working</strong></h6>
                                    <p>Export is available for Pro and Enterprise plans only. The free Basic plan does not include Export. Check your subscription status in Settings. If you have the right plan and it's still not working, try refreshing the page.</p>
                                    
                                    <h6 class="mt-3"><strong>Projection toggle not visible or disabled</strong></h6>
                                    <p>Projection Mode is a Pro and Enterprise feature. On Basic or Free plans, the toggle is hidden or disabled. Upgrade your plan to enable financial projections.</p>
                                    
                                    <h6 class="mt-3"><strong>Need More Help?</strong></h6>
                                    <p>If you're still having issues, try:</p>
                                    <ul>
                                        <li>Refreshing the page</li>
                                        <li>Clearing your browser cache</li>
                                        <li>Checking your internet connection</li>
                                        <li>Using the <strong>Feedback</strong> button (top bar, between Settings and Logout) to send comments, suggestions, or bug reports to the admin</li>
                                        <li>Contacting support with specific error messages</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer d-flex flex-wrap align-items-center justify-content-between gap-2">
                    <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox" id="helpDontShowOnSignIn">
                        <label class="form-check-label" for="helpDontShowOnSignIn">Don't show this again when I sign in</label>
                    </div>
                    <button type="button" class="btn btn-primary" id="helpGotItBtn" onclick="dismissHelpModal()">
                        <i class="fas fa-check me-1"></i>Got it
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Card detail modals (full breakdown when "Show more" clicked) -->
    <div class="modal fade" id="totalTeamsDetailModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-users text-primary me-2"></i>Total Teams</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="teamsBehindDetailModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-exclamation-triangle text-danger me-2"></i>Teams Behind</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="totalDuesDetailModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-dollar-sign text-primary me-2"></i>Total Dues Collected</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="totalDuesByDivisionModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-list text-primary me-2"></i>Total Dues — By division</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="totalDuesByDivisionModalBody">
                    <p class="text-muted mb-0">No division data.</p>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="sanctionFeesDetailModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-certificate text-secondary me-2"></i>Sanction Fee Collected</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="greenFeesDetailModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-leaf text-success me-2"></i>Green Fee Collected</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="prizeFundDetailModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-trophy text-warning me-2"></i>Prize Fund</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="prizeFundByDivisionModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-list text-warning me-2"></i>Prize Fund — By division</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="prizeFundByDivisionModalBody">
                    <p class="text-muted mb-0">No division data.</p>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="nationalOrgDetailModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-flag text-info me-2"></i>Parent / National Organization</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="nationalOrgByDivisionModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-list text-info me-2"></i>Parent / National — By division</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="nationalOrgByDivisionModalBody">
                    <p class="text-muted mb-0">No division data.</p>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="nationalOrgHistoryModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="nationalOrgHistoryModalTitle"><i class="fas fa-history text-info me-2"></i>Payment history</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="nationalOrgHistoryModalBody">
                    <p class="text-muted mb-0">No history data. Open Parent / National Organization and click &quot;View payment history&quot;.</p>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="nationalOrgPastYearsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-calendar-alt text-info me-2"></i>Select year</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="nationalOrgPastYearsModalBody">
                    <p class="text-muted mb-0">No past years.</p>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="leagueIncomeDetailModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user-tie text-success me-2"></i>League Income</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="leagueIncomeByDivisionModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-list text-success me-2"></i>League Income — By division</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="leagueIncomeByDivisionModalBody">
                    <p class="text-muted mb-0">No division data.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal fade" id="paymentModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Record Payment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="paymentSuccess" class="d-none text-center py-3">
                        <p class="text-success mb-3"><i class="fas fa-check-circle me-2"></i>Payment recorded successfully!</p>
                        <div class="d-flex gap-2 justify-content-center flex-wrap">
                            <button type="button" class="btn btn-outline-primary" onclick="paymentModalAddAnother()">
                                <i class="fas fa-plus me-1"></i>Add another payment
                            </button>
                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Done</button>
                        </div>
                    </div>
                    <form id="paymentForm">
                        <div class="mb-3">
                            <label for="paymentAmount" class="form-label">Payment Amount</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <select class="form-select" id="paymentAmount">
                                    <!-- Options will be populated dynamically -->
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="paymentDate" class="form-label">Payment Date</label>
                            <input type="date" class="form-control" id="paymentDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="paymentMethod" class="form-label">Payment Method</label>
                            <select class="form-select" id="paymentMethod">
                                <option value="cash">Cash</option>
                                <option value="check">Check</option>
                                <option value="cashapp">CashApp</option>
                                <option value="venmo">Venmo</option>
                                <option value="paypal">PayPal</option>
                                <option value="zelle">Zelle</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="paymentNotes" class="form-label">Notes (Optional)</label>
                            <textarea class="form-control" id="paymentNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="recordPayment()">
                        <i class="fas fa-check me-2"></i>Record Payment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Weekly Payment Modal -->
    <div class="modal fade" id="weeklyPaymentModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header py-2">
                    <h5 class="modal-title">Record Weekly Payment for <span id="weeklyPaymentModalTeamName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body weekly-payment-modal-body py-3">
                    <form id="weeklyPaymentForm" class="weekly-payment-form">
                        <div class="row g-2 align-items-end mb-2">
                            <div class="col-6 col-lg">
                                <label for="weeklyPaymentWeek" class="form-label mb-0 small" data-bs-toggle="tooltip" data-bs-placement="top" title="Select the week this payment applies to.">Week</label>
                                <select class="form-select form-select-sm" id="weeklyPaymentWeek" onchange="populateWeeklyPaymentAmountDropdown()">
                                    <!-- Options will be populated dynamically -->
                                </select>
                            </div>
                            <div class="col-6 col-lg">
                                <label for="weeklyPaymentAmount" class="form-label mb-0 small" data-bs-toggle="tooltip" data-bs-placement="top" title="Total payment amount (weekly dues plus any sanction fees).">Amount</label>
                                <div class="input-group input-group-sm">
                                    <span class="input-group-text">$</span>
                                    <select class="form-select" id="weeklyPaymentAmount" onchange="updateWeeklyPaymentAmount()">
                                        <!-- Options will be populated dynamically -->
                                    </select>
                                </div>
                                <small class="text-muted" id="weeklyPaymentAmountHelp"></small>
                            </div>
                            <div class="col-6 col-lg">
                                <label for="weeklyPaymentDate" class="form-label mb-0 small" data-bs-toggle="tooltip" data-bs-placement="top" title="Date the payment was received.">Date</label>
                                <input type="date" class="form-control form-control-sm" id="weeklyPaymentDate" required>
                            </div>
                            <div class="col-6 col-lg">
                                <label for="weeklyPaymentMethod" class="form-label mb-0 small" data-bs-toggle="tooltip" data-bs-placement="top" title="How the payment was made (e.g. cash, check, Venmo).">Method</label>
                                <select class="form-select form-select-sm" id="weeklyPaymentMethod" onchange="togglePaidByPlayerDropdown()">
                                    <!-- Options populated by weeklypayment.js from standard + user custom methods -->
                                </select>
                            </div>
                            <div class="col-6 col-lg" id="weeklyPaymentMethodOtherWrap" style="display: none;">
                                <label for="weeklyPaymentMethodOtherName" class="form-label mb-0 small" data-bs-toggle="tooltip" data-bs-placement="top" title="Name this payment method; it will be saved to your dropdown for next time.">Name this payment method</label>
                                <input type="text" class="form-control form-control-sm" id="weeklyPaymentMethodOtherName" placeholder="e.g. Apple Pay" maxlength="80" autocomplete="off">
                            </div>
                            <div class="col-6 col-lg" id="paidByPlayerContainer" style="display: none;">
                                <label for="paidByPlayer" class="form-label mb-0 small" data-bs-toggle="tooltip" data-bs-placement="top" title="Which team player made this payment. Required for non-cash methods.">Paid By <span class="text-danger" id="paidByPlayerRequired">*</span></label>
                                <select class="form-select form-select-sm" id="paidByPlayer">
                                    <option value="">Select player...</option>
                                    <!-- Options will be populated dynamically -->
                                </select>
                                <small class="text-muted" id="paidByPlayerHelp"></small>
                            </div>
                        </div>
                        <div class="mb-2">
                            <label class="form-label mb-0 small" data-bs-toggle="tooltip" data-bs-placement="top" title="Whether this week's dues were paid, bye, makeup, or unpaid.">Payment status</label>
                            <div class="d-flex flex-wrap gap-2 gap-lg-3 justify-content-center">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidYes" value="true">
                                    <label class="form-check-label text-success fw-semibold small" for="weeklyPaidYes" data-bs-toggle="tooltip" data-bs-placement="top" title="Dues were paid for this week.">Paid <span class="badge bg-success ms-1"><i class="fas fa-check"></i></span></label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidBye" value="bye">
                                    <label class="form-check-label text-info fw-semibold small" for="weeklyPaidBye" data-bs-toggle="tooltip" data-bs-placement="top" title="Team had a bye; no match or dues this week.">Bye <span class="badge bg-info ms-1"><i class="fas fa-pause"></i></span></label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidMakeup" value="makeup">
                                    <label class="form-check-label text-warning fw-semibold small" for="weeklyPaidMakeup" data-bs-toggle="tooltip" data-bs-placement="top" title="Makeup match; dues in limbo until played.">Make up <span class="badge bg-warning text-dark ms-1"><i class="fas fa-clock"></i></span></label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidPartial" value="partial">
                                    <label class="form-check-label fw-semibold small" for="weeklyPaidPartial" data-bs-toggle="tooltip" data-bs-placement="top" title="Some payment received; remaining amount still owed." style="color: #0d6efd;">Partial <span class="badge bg-primary ms-1"><i class="fas fa-coins"></i></span></label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidNo" value="false">
                                    <label class="form-check-label text-danger fw-semibold small" for="weeklyPaidNo" data-bs-toggle="tooltip" data-bs-placement="top" title="Dues not yet paid for this week.">Unpaid <span class="badge bg-danger ms-1"><i class="fas fa-times"></i></span></label>
                                </div>
                            </div>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-12 col-lg-6">
                                <div id="bcaSanctionPlayers" class="p-3 border rounded">
                                    <button class="btn btn-link p-0 text-decoration-none d-flex align-items-center w-100 text-start" type="button" data-bs-toggle="collapse" data-bs-target="#bcaSanctionPlayersCollapse" aria-expanded="false" aria-controls="bcaSanctionPlayersCollapse">
                                        <i class="fas fa-chevron-down me-2" id="bcaSanctionPlayersChevron"></i>
                                        <span class="form-label fw-bold mb-0" data-bs-toggle="tooltip" data-bs-placement="top" title="Check each player whose sanction fee is included. Fee is set in Settings.">Include sanction fee</span>
                                    </button>
                                    <div class="collapse" id="bcaSanctionPlayersCollapse">
                                        <p class="text-muted small mb-2 mt-2">Check each player whose sanction fee is included.</p>
                                        <div id="bcaSanctionPlayersList"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-6" id="greenFeeIncludeSection">
                                <div class="p-3 border rounded green-fee-section">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="includeGreenFee" value="1">
                                        <label class="form-check-label fw-semibold" for="includeGreenFee" id="includeGreenFeeLabel" data-bs-toggle="tooltip" data-bs-placement="top" title="Check if this payment includes the green/table fee for this week. Amount is set in Settings.">
                                            <i class="fas fa-leaf text-success me-1"></i>Include green fee (<span id="greenFeeAmountDisplay">$0</span>)
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-6">
                                <div id="individualPaymentsSection" class="p-3 border rounded">
                                    <div class="form-check form-switch mb-0">
                                        <input class="form-check-input" type="checkbox" id="enableIndividualPayments" role="switch" onchange="toggleIndividualPayments()">
                                        <label class="form-check-label fw-semibold" for="enableIndividualPayments" data-bs-toggle="tooltip" data-bs-placement="top" title="Track how much each player paid; amounts count toward team dues."><i class="fas fa-user-check me-1"></i>Record per-player payments</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="individualPaymentsContainer" class="mb-3" style="display: none;">
                            <div class="individual-payments-panel border rounded p-3">
                                <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                                    <h6 class="mb-0"><i class="fas fa-users me-2"></i>Per-player amounts</h6>
                                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="splitEvenlyIndividualPayments()" title="Fill each player with an equal share of the weekly dues.">
                                        <i class="fas fa-equals me-1"></i>Split evenly
                                    </button>
                                </div>
                                <div class="table-responsive" style="max-height: 280px; overflow-y: auto;">
                                    <table class="table table-sm table-hover mb-0" id="individualPaymentsTable">
                                        <thead class="individual-payments-thead sticky-top">
                                            <tr>
                                                <th>Player</th>
                                                <th style="min-width: 100px;">Amount</th>
                                                <th style="min-width: 120px;">Method</th>
                                                <th style="min-width: 150px;">Date</th>
                                            </tr>
                                        </thead>
                                        <tbody id="individualPaymentsList"></tbody>
                                    </table>
                                </div>
                                <div class="individual-payments-summary mt-3 py-2 px-3 rounded d-flex flex-wrap justify-content-between align-items-center gap-2">
                                    <span>Dues due: <strong>$<span id="weeklyTeamDuesAmount">0.00</span></strong></span>
                                    <span>Total entered: <strong class="text-primary">$<span id="individualPaymentsTotal">0.00</span></strong></span>
                                    <span>Remaining: <strong id="remainingDuesBalance" class="text-muted">$0.00</strong></span>
                                </div>
                            </div>
                        </div>
                        <div class="mb-0">
                            <label for="weeklyPaymentNotes" class="form-label mb-0 small" data-bs-toggle="tooltip" data-bs-placement="top" title="Optional notes (e.g. check number, reference, memo).">Notes (optional)</label>
                            <textarea class="form-control form-control-sm" id="weeklyPaymentNotes" rows="2" placeholder="Optional notes"></textarea>
                        </div>
                    </form>
                    <div id="weeklyPaymentSuccess" class="d-none text-center py-3">
                        <p id="weeklyPaymentSuccessMessage" class="text-success mb-3"><i class="fas fa-check-circle me-2"></i>Weekly payment saved successfully!</p>
                        <div class="d-flex gap-2 justify-content-center flex-wrap">
                            <button type="button" class="btn btn-outline-primary btn-sm" id="weeklyPaymentAddAnotherBtn" onclick="weeklyPaymentAddAnother()">
                                <i class="fas fa-plus me-1"></i>Add another payment
                            </button>
                            <button type="button" class="btn btn-primary btn-sm" data-bs-dismiss="modal">Done</button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer py-2">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success btn-sm" onclick="saveWeeklyPayment()">
                        <i class="fas fa-check me-2"></i>Save Payment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Division Management Modal -->
    <div class="modal fade" id="divisionManagementModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Division Management</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto;">
                    <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                        <div class="d-flex align-items-center gap-2">
                            <h6 class="mb-0">Existing Divisions</h6>
                            <ul class="nav nav-pills" style="font-size: 0.875rem;">
                                <li class="nav-item">
                                    <button class="nav-link active" id="divisionsTabActive" onclick="showDivisionsTab('active')">Active</button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link" id="divisionsTabArchived" onclick="showDivisionsTab('archived')">Archived</button>
                                </li>
                            </ul>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="btn btn-primary btn-sm" onclick="openSmartBuilder(true)">
                                <i class="fas fa-plus me-1"></i>Add Division
                            </button>
                            <button class="btn btn-info btn-sm" onclick="openSmartBuilderFromAddDivision()">
                                <i class="fas fa-download me-1"></i>Import from FargoRate
                            </button>
                        </div>
                    </div>
                    <p class="alert py-2 px-3 mb-3 small fargo-lo-required-banner"><strong>Import from FargoRate / LMS:</strong> You must have a <strong>League Operator (LO) account</strong> in FargoRate LMS to import divisions and teams.</p>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th class="divisions-sortable" data-sort="name" onclick="sortDivisionsTable('name')" style="cursor: pointer;" title="Click to sort">Division Name <i class="fas fa-sort ms-1 opacity-50"></i></th>
                                    <th class="divisions-sortable" data-sort="teams" onclick="sortDivisionsTable('teams')" style="cursor: pointer;" title="Click to sort">Teams <i class="fas fa-sort ms-1 opacity-50"></i></th>
                                    <th class="divisions-sortable" data-sort="gameType" onclick="sortDivisionsTable('gameType')" style="cursor: pointer;" title="Click to sort">Game Type <i class="fas fa-sort ms-1 opacity-50"></i></th>
                                    <th class="divisions-sortable" data-sort="startDate" onclick="sortDivisionsTable('startDate')" style="cursor: pointer;" title="Click to sort">Start Date <i class="fas fa-sort ms-1 opacity-50"></i></th>
                                    <th class="divisions-sortable" data-sort="endDate" onclick="sortDivisionsTable('endDate')" style="cursor: pointer;" title="Click to sort">End Date <i class="fas fa-sort ms-1 opacity-50"></i></th>
                                    <th class="divisions-sortable" data-sort="totalWeeks" onclick="sortDivisionsTable('totalWeeks')" style="cursor: pointer;" title="Click to sort">Total Weeks <i class="fas fa-sort ms-1 opacity-50"></i></th>
                                    <th class="divisions-sortable" data-sort="matchesPerWeek" onclick="sortDivisionsTable('matchesPerWeek')" style="cursor: pointer;" title="Click to sort">Matches per Week <i class="fas fa-sort ms-1 opacity-50"></i></th>
                                    <th class="divisions-sortable" data-sort="weeklyDues" onclick="sortDivisionsTable('weeklyDues')" style="cursor: pointer;" title="Click to sort">Weekly Dues <i class="fas fa-sort ms-1 opacity-50"></i></th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="divisionsTable">
                                <!-- Divisions will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Division Modal -->
    <div class="modal fade" id="addDivisionModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addDivisionModalTitle">Add New Division</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="addDivisionModalBody">
                    <ul class="nav nav-tabs mb-3" id="addDivisionModalTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="division-details-tab" data-bs-toggle="tab" data-bs-target="#division-details-pane" type="button" role="tab">Details</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="division-financial-tab" data-bs-toggle="tab" data-bs-target="#division-financial-pane" type="button" role="tab">Financial</button>
                        </li>
                    </ul>
                    <form id="addDivisionForm">
                        <div class="tab-content" id="addDivisionModalTabContent">
                            <div class="tab-pane fade show active" id="division-details-pane" role="tabpanel">
                                <div class="division-details-title mb-2">
                                    <h5 class="mb-0" id="divisionDetailsTabTitle">New Division</h5>
                                    <small class="text-muted">Editable fields below</small>
                                </div>
                                <div class="row g-2">
                                    <!-- Left column: Division Name(s) + Schedule -->
                                    <div class="col-md-6">
                                        <div class="division-details-section mb-2">
                                            <h6 class="division-details-section-title text-muted text-uppercase small mb-1"><i class="fas fa-tag me-1"></i>Division Name(s)</h6>
                                            <div id="regularDivisionNameFields">
                                                <div class="row g-2">
                                                    <div class="col-7">
                                                        <label for="divisionName" class="form-label" title="Name of this division (e.g. Monday 8-ball)">Division Name *</label>
                                                        <input type="text" class="form-control form-control-sm" id="divisionName" required placeholder="e.g. Monday 8-ball" title="Name of this division" oninput="updateDivisionDetailsTitle()">
                                                    </div>
                                                    <div class="col-5">
                                                        <label for="gameType" class="form-label" title="Game type for this division">Game Type *</label>
                                                        <select class="form-select form-select-sm" id="gameType" required title="Game type (8-ball, 9-ball, etc.)" onchange="updateGameTypeOptions(); updateDivisionDetailsTitle();">
                                                            <option value="">Select</option>
                                                            <option value="8-ball">8-ball</option>
                                                            <option value="9-ball">9-ball</option>
                                                            <option value="10-ball">10-ball</option>
                                                            <option value="straight-pool">Straight Pool</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="doublePlayDivisionNameFields" style="display: none;">
                                                <div class="row g-2 mb-1">
                                                    <div class="col-6">
                                                        <label for="firstDivisionName" class="form-label">First Division Name *</label>
                                                        <input type="text" class="form-control form-control-sm" id="firstDivisionName" placeholder="e.g. 12861" title="First division name (e.g. FargoRate ID)" oninput="updateDivisionDetailsTitle()">
                                                    </div>
                                                    <div class="col-6">
                                                        <label for="firstDivisionGameType" class="form-label">First Game Type *</label>
                                                        <select class="form-select form-select-sm" id="firstDivisionGameType" onchange="updateGameTypeOptions(); updateDivisionDetailsTitle();">
                                                            <option value="">Select</option>
                                                            <option value="8-ball">8-ball</option>
                                                            <option value="9-ball">9-ball</option>
                                                            <option value="10-ball">10-ball</option>
                                                            <option value="straight-pool">Straight Pool</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row g-2">
                                                    <div class="col-6">
                                                        <label for="secondDivisionName" class="form-label">Second Division Name *</label>
                                                        <input type="text" class="form-control form-control-sm" id="secondDivisionName" placeholder="e.g. 12061" title="Second division name" oninput="updateDivisionDetailsTitle()">
                                                    </div>
                                                    <div class="col-6">
                                                        <label for="secondGameType" class="form-label">Second Game Type *</label>
                                                        <select class="form-select form-select-sm" id="secondGameType" onchange="updateGameTypeOptions(); updateDivisionDetailsTitle();">
                                                            <option value="">Select</option>
                                                            <option value="8-ball">8-ball</option>
                                                            <option value="9-ball">9-ball</option>
                                                            <option value="10-ball">10-ball</option>
                                                            <option value="straight-pool">Straight Pool</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-check mt-1">
                                                <input class="form-check-input" type="checkbox" id="isDoublePlay" title="Team plays in two divisions (e.g. 8-ball and 10-ball)" onchange="toggleDoublePlayOptions()">
                                                <label class="form-check-label" for="isDoublePlay" title="Team plays in two divisions">Double Play (plays multiple divisions)</label>
                                            </div>
                                        </div>
                                        <div class="division-details-section mb-2">
                                            <h6 class="division-details-section-title text-muted text-uppercase small mb-1"><i class="fas fa-calendar-alt me-1"></i>Schedule</h6>
                                            <div class="row g-2">
                                                <div class="col-4">
                                                    <label for="divisionStartDate" class="form-label" title="First day of the season">Start Date *</label>
                                                    <input type="date" class="form-control form-control-sm" id="divisionStartDate" required title="First day of the season" onchange="calculateEndDate()">
                                                    <small id="startDateDay" class="text-muted small" style="display: none;"><i class="fas fa-calendar-day me-1"></i><span id="startDayName">-</span></small>
                                                </div>
                                                <div class="col-4">
                                                    <label for="totalWeeks" class="form-label" title="Number of weeks in the season">Total Weeks *</label>
                                                    <input type="number" class="form-control form-control-sm" id="totalWeeks" min="1" required title="Number of weeks in the season" onchange="calculateEndDate()">
                                                </div>
                                                <div class="col-4">
                                                    <label for="divisionEndDate" class="form-label" title="Last day; auto-filled from start + weeks; edit for holidays">End Date</label>
                                                    <input type="date" class="form-control form-control-sm" id="divisionEndDate" title="Edit for holidays or no-play weeks">
                                                    <small class="text-muted small d-block">Auto-filled; edit for holidays.</small>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-sm btn-outline-primary mt-1" id="openDivisionScheduleBtn" onclick="openDivisionScheduleModal()" title="Set play date for each week; add no-play weeks (holidays)—shifts later weeks by 7 days">
                                                <i class="fas fa-calendar-alt me-1"></i>Customize play dates
                                            </button>
                                            <small class="text-muted small d-block">Override dates or add no-play weeks (e.g. holidays).</small>
                                        </div>
                                    </div>
                                    <!-- Right column: Format & Capacity + Display -->
                                    <div class="col-md-6">
                                        <div class="division-details-section mb-2">
                                            <h6 class="division-details-section-title text-muted text-uppercase small mb-1"><i class="fas fa-users me-1"></i>Format &amp; Capacity</h6>
                                            <div class="row g-2">
                                                <div class="col-4" id="regularMatchesPerWeekWrapper">
                                                    <label for="matchesPerWeek" class="form-label" title="Matches per team per week">Matches/wk *</label>
                                                    <select class="form-select form-select-sm" id="matchesPerWeek" required title="Number of matches each team plays per week">
                                                        <option value="1">1</option>
                                                        <option value="2">2</option>
                                                        <option value="3">3</option>
                                                        <option value="4">4</option>
                                                        <option value="5">5</option>
                                                    </select>
                                                    <small class="text-muted small">Per team, per week</small>
                                                </div>
                                                <div class="col-4">
                                                    <label for="playersPerWeek" class="form-label" title="Players counted per team per week for dues">Players/wk *</label>
                                                    <select class="form-select form-select-sm" id="playersPerWeek" required title="Players per team, per division, each week">
                                                        <option value="">—</option>
                                                        <option value="3">3</option>
                                                        <option value="4">4</option>
                                                        <option value="5" selected>5</option>
                                                        <option value="6">6</option>
                                                        <option value="7">7</option>
                                                        <option value="8">8</option>
                                                        <option value="9">9</option>
                                                        <option value="10">10</option>
                                                    </select>
                                                    <small class="text-muted small">Per team, per division</small>
                                                </div>
                                                <div class="col-4">
                                                    <label class="form-label" title="Team count and plan capacity">Teams</label>
                                                    <div class="small">Current: <strong id="divisionCurrentTeamsCount">—</strong> · Cap: <strong id="divisionTeamCapacityDisplay">—</strong></div>
                                                    <small class="text-muted small">Capacity from your plan.</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="division-details-section">
                                            <h6 class="division-details-section-title text-muted text-uppercase small mb-1"><i class="fas fa-palette me-1"></i>Display</h6>
                                            <div class="d-flex align-items-center gap-2 flex-wrap">
                                                <input type="color" class="form-control form-control-color" id="divisionColor" value="#0dcaf0" title="Division badge color in the teams table" oninput="var h=document.getElementById('divisionColorHex');if(h)h.textContent=this.value">
                                                <span class="text-muted small" id="divisionColorHex">#0dcaf0</span>
                                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="resetDivisionColor()" title="Reset to default color based on division name">Reset</button>
                                                <span class="text-muted small">Badge color in teams table</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="division-financial-pane" role="tabpanel">
                                <small class="text-muted d-block mb-3" id="divisionFinancialLockedHint" style="display: none;">Saved settings are read-only. Click <i class="fas fa-pen fa-xs"></i> next to a field to edit it.</small>
                                <div id="divisionFinancialUsingDefaultBadge" class="alert alert-success py-2 mb-3 d-flex align-items-center gap-2" style="display: none;">
                                    <i class="fas fa-check-circle"></i>
                                    <span><strong>Using default settings</strong> — This division uses your default distribution from Profile &amp; Settings.</span>
                                </div>
                                <div id="divisionFinancialOverrideNotice" class="alert alert-info py-2 mb-3 d-flex align-items-center gap-2" style="display: none;">
                                    <i class="fas fa-info-circle"></i>
                                    <span><strong>Division-specific settings</strong> — These values will override your default from Profile &amp; Settings when you save.</span>
                                </div>
                                <div id="divisionFinancialFieldsContainer">
                                <div class="mb-4 division-financial-field-group" data-fields="divisionWeeklyDues">
                                    <label for="divisionWeeklyDues" class="form-label d-flex align-items-center gap-1">Dues per Player per Match *
                                        <i class="fas fa-pen division-financial-edit-icon ms-1" onclick="toggleDivisionFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                    </label>
                                    <select class="form-select" id="divisionWeeklyDues" required>
                                        <option value="">Select Amount</option>
                                        <option value="5">$5.00</option>
                                        <option value="6">$6.00</option>
                                        <option value="7">$7.00</option>
                                        <option value="8">$8.00</option>
                                        <option value="9">$9.00</option>
                                        <option value="10">$10.00</option>
                                        <option value="11">$11.00</option>
                                        <option value="12">$12.00</option>
                                        <option value="13">$13.00</option>
                                        <option value="14">$14.00</option>
                                        <option value="15">$15.00</option>
                                        <option value="16">$16.00</option>
                                        <option value="17">$17.00</option>
                                        <option value="18">$18.00</option>
                                        <option value="19">$19.00</option>
                                        <option value="20">$20.00</option>
                                        <option value="25">$25.00</option>
                                        <option value="30">$30.00</option>
                                        <option value="35">$35.00</option>
                                        <option value="40">$40.00</option>
                                        <option value="50">$50.00</option>
                                    </select>
                                    <small class="text-muted d-block mt-1">
                                        <i class="fas fa-info-circle me-1"></i>Amount each player pays per match they play.
                                    </small>
                                </div>
                                <hr class="my-3">
                                <div class="d-flex justify-content-between align-items-center mb-2 flex-wrap gap-2">
                                    <h6 class="mb-0"><i class="fas fa-money-bill-wave me-2 text-primary"></i>Distribution</h6>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="divisionUseDefaultBtn" onclick="clearDivisionFinancialBreakdown()" title="Clear division-specific values so this division uses your default from Settings">
                                        <i class="fas fa-undo me-1"></i>Use default
                                    </button>
                                </div>
                                <p class="small text-muted mb-3">Set division-specific percentages or dollar amounts to override your default. Leave blank and click <strong>Use default</strong> to use Settings.</p>
                                <div class="mb-3 division-financial-field-group" data-fields="" data-radios="divisionCalculationMethod">
                                    <label class="form-label d-flex align-items-center gap-1">
                                        Calculation method
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Percentage: split dues by % across categories. Dollar: fixed $ per team or per player. All values are per division. Double play = two divisions; each uses this split (you don't double amounts)."></i>
                                        <i class="fas fa-pen division-financial-edit-icon ms-1" onclick="toggleDivisionFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                    </label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="divisionCalculationMethod" id="divisionMethodPercentage" value="percentage" checked onchange="toggleDivisionCalculationMethod()">
                                        <label class="form-check-label" for="divisionMethodPercentage">Percentage-based</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="divisionCalculationMethod" id="divisionMethodDollarAmount" value="dollar" onchange="toggleDivisionCalculationMethod()">
                                        <label class="form-check-label" for="divisionMethodDollarAmount">Dollar amount-based</label>
                                    </div>
                                    <small class="text-muted">Active format: <span id="divisionActiveFormatLabel">Percentage</span></small>
                                    <div id="divisionSaveToChangeFormatMsg" class="alert alert-warning mt-2 py-2 small" style="display: none;">
                                        Save the division to change the calculation method.
                                    </div>
                                </div>
                                <div id="divisionPercentageInputs">
                                    <div class="row g-2 mb-2">
                                        <div class="col-md-4">
                                            <div class="division-financial-field-group" data-fields="divisionPrizeFundPercentage">
                                            <label for="divisionPrizeFundPercentage" class="form-label small d-flex align-items-center gap-1">
                                                <span id="divisionPrizeFundPctLabel">Prize Fund %</span>
                                                <i class="fas fa-pen division-financial-edit-icon ms-1" onclick="toggleDivisionFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="input-group input-group-sm">
                                                <input type="number" class="form-control" id="divisionPrizeFundPercentage" step="0.1" min="0" max="100" placeholder="50" data-bs-toggle="tooltip" data-bs-placement="top" title="% of dues to prize fund. Per division; double play divisions each use this split.">
                                                <span class="input-group-text">%</span>
                                            </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="division-financial-field-group" data-fields="divisionFirstOrgPercentage">
                                            <label for="divisionFirstOrgPercentage" class="form-label small d-flex align-items-center gap-1">
                                                <span id="divisionFirstOrgPctLabel">First Org %</span>
                                                <i class="fas fa-pen division-financial-edit-icon ms-1" onclick="toggleDivisionFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="input-group input-group-sm">
                                                <input type="number" class="form-control" id="divisionFirstOrgPercentage" step="0.1" min="0" max="100" placeholder="60" data-bs-toggle="tooltip" data-bs-placement="top" title="% of dues to first org. Per division; double play divisions each use this split.">
                                                <span class="input-group-text">%</span>
                                            </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="division-financial-field-group" data-fields="divisionSecondOrgPercentage">
                                            <label for="divisionSecondOrgPercentage" class="form-label small d-flex align-items-center gap-1">
                                                <span id="divisionSecondOrgPctLabel">Second Org %</span>
                                                <i class="fas fa-pen division-financial-edit-icon ms-1" onclick="toggleDivisionFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="input-group input-group-sm">
                                                <input type="number" class="form-control" id="divisionSecondOrgPercentage" step="0.1" min="0" max="100" placeholder="40" data-bs-toggle="tooltip" data-bs-placement="top" title="% of dues to second org. Per division; double play divisions each use this split.">
                                                <span class="input-group-text">%</span>
                                            </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="divisionDollarAmountInputs" style="display: none;">
                                    <div class="row g-2 mb-3">
                                        <div class="col-md-4">
                                            <div class="division-financial-field-group" data-fields="divisionPrizeFundAmount" data-radios="divisionPrizeFundAmountType">
                                            <label for="divisionPrizeFundAmount" class="form-label small d-flex align-items-center gap-1">
                                                <span id="divisionPrizeFundDollarLabel">Prize Fund $</span>
                                                <i class="fas fa-pen division-financial-edit-icon ms-1" onclick="toggleDivisionFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">$</span>
                                                <input type="number" class="form-control" id="divisionPrizeFundAmount" step="0.01" min="0" placeholder="0" data-bs-toggle="tooltip" data-bs-placement="top" title="Dollar amount per team or per player, per division. Double play: each division uses these amounts (don't double them).">
                                            </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="division-financial-field-group" data-fields="divisionPrizeFundAmount" data-radios="divisionPrizeFundAmountType">
                                            <label class="form-label small d-flex align-items-center gap-1">Per <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Apply amount per team or per player in this division."></i>
                                                <i class="fas fa-pen division-financial-edit-icon ms-1" onclick="toggleDivisionFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="btn-group btn-group-sm w-100" role="group">
                                                <input type="radio" class="btn-check" name="divisionPrizeFundAmountType" id="divisionPrizeFundPerTeam" value="perTeam" checked>
                                                <label class="btn btn-outline-secondary" for="divisionPrizeFundPerTeam">Team</label>
                                                <input type="radio" class="btn-check" name="divisionPrizeFundAmountType" id="divisionPrizeFundPerPlayer" value="perPlayer">
                                                <label class="btn btn-outline-secondary" for="divisionPrizeFundPerPlayer">Player</label>
                                            </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-2 mb-3">
                                        <div class="col-md-4">
                                            <div class="division-financial-field-group" data-fields="divisionFirstOrganizationAmount" data-radios="divisionFirstOrgAmountType">
                                            <label for="divisionFirstOrganizationAmount" class="form-label small d-flex align-items-center gap-1">
                                                <span id="divisionFirstOrgDollarLabel">First Org $</span>
                                                <i class="fas fa-pen division-financial-edit-icon ms-1" onclick="toggleDivisionFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">$</span>
                                                <input type="number" class="form-control" id="divisionFirstOrganizationAmount" step="0.01" min="0" placeholder="0" data-bs-toggle="tooltip" data-bs-placement="top" title="Dollar amount per team or per player, per division. Double play: each division uses these amounts (don't double them).">
                                            </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="division-financial-field-group" data-fields="divisionFirstOrganizationAmount" data-radios="divisionFirstOrgAmountType">
                                            <label class="form-label small d-flex align-items-center gap-1">Per <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Apply amount per team or per player in this division."></i>
                                                <i class="fas fa-pen division-financial-edit-icon ms-1" onclick="toggleDivisionFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="btn-group btn-group-sm w-100" role="group">
                                                <input type="radio" class="btn-check" name="divisionFirstOrgAmountType" id="divisionFirstOrgPerTeam" value="perTeam" checked>
                                                <label class="btn btn-outline-secondary" for="divisionFirstOrgPerTeam">Team</label>
                                                <input type="radio" class="btn-check" name="divisionFirstOrgAmountType" id="divisionFirstOrgPerPlayer" value="perPlayer">
                                                <label class="btn btn-outline-secondary" for="divisionFirstOrgPerPlayer">Player</label>
                                            </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-2 mb-2">
                                        <div class="col-md-4">
                                            <div class="division-financial-field-group" data-fields="divisionSecondOrganizationAmount" data-radios="divisionSecondOrgAmountType">
                                            <label for="divisionSecondOrganizationAmount" class="form-label small d-flex align-items-center gap-1">
                                                <span id="divisionSecondOrgDollarLabel">Second Org $</span>
                                                <i class="fas fa-pen division-financial-edit-icon ms-1" onclick="toggleDivisionFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">$</span>
                                                <input type="number" class="form-control" id="divisionSecondOrganizationAmount" step="0.01" min="0" placeholder="0" data-bs-toggle="tooltip" data-bs-placement="top" title="Dollar amount per team or per player, per division. Double play: each division uses these amounts (don't double them).">
                                            </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="division-financial-field-group" data-fields="divisionSecondOrganizationAmount" data-radios="divisionSecondOrgAmountType">
                                            <label class="form-label small d-flex align-items-center gap-1">Per <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Apply amount per team or per player in this division."></i>
                                                <i class="fas fa-pen division-financial-edit-icon ms-1" onclick="toggleDivisionFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="btn-group btn-group-sm w-100" role="group">
                                                <input type="radio" class="btn-check" name="divisionSecondOrgAmountType" id="divisionSecondOrgPerTeam" value="perTeam" checked>
                                                <label class="btn btn-outline-secondary" for="divisionSecondOrgPerTeam">Team</label>
                                                <input type="radio" class="btn-check" name="divisionSecondOrgAmountType" id="divisionSecondOrgPerPlayer" value="perPlayer">
                                                <label class="btn btn-outline-secondary" for="divisionSecondOrgPerPlayer">Player</label>
                                            </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveDivisionBtn" onclick="addDivision()">
                        <i class="fas fa-plus me-2"></i>Add Division
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Customize Schedule modal (play dates by week, insert no-play) -->
    <div class="modal fade" id="divisionScheduleModal" tabindex="-1" aria-labelledby="divisionScheduleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="divisionScheduleModalLabel"><i class="fas fa-calendar-week me-2"></i>Customize play dates by week</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted small mb-2">Override the date played for any week. Use <strong>No play</strong> next to a week to mark it skipped (e.g. league moved matches and didn't play that date). Use <strong>Insert no-play week</strong> to add a new off week—all later weeks shift by 7 days.</p>
                    <div id="weekPlayDatesContainer" class="border rounded p-2 bg-light bg-opacity-50" style="max-height: 50vh; overflow-y: auto;"></div>
                    <div class="mt-3 d-flex flex-wrap align-items-center gap-2">
                        <span class="small text-muted">Insert no-play week after:</span>
                        <select class="form-select form-select-sm" id="insertNoPlayAfterWeek" style="width: auto; min-width: 10rem;">
                            <option value="">—</option>
                        </select>
                        <button type="button" class="btn btn-sm btn-outline-secondary" id="insertNoPlayWeekBtn" onclick="insertNoPlayWeekAfter()" title="Add a no-play week (e.g. holiday); shifts all later weeks by 7 days">
                            <i class="fas fa-calendar-plus me-1"></i>Insert no-play week
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Done</button>
                </div>
            </div>
        </div>
    </div>

    <!-- FargoRate Importer Instructions Popup (shown when opening Import from FargoRate; "Don't show again" hides it) -->
    <div class="modal fade" id="fargoInstructionsModal" tabindex="-1" aria-labelledby="fargoInstructionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="fargoInstructionsModalLabel"><i class="fas fa-info-circle me-2"></i>FargoRate Importer – Quick Guide</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">To import teams from FargoRate, get the <strong>League Reports URL</strong> first:</p>
                    <ol class="mb-3">
                        <li>Log into your <strong>League Operator (LO) account</strong> in FargoRate LMS.</li>
                        <li>Select your <strong>league</strong>, then the <strong>division</strong> you want to import. The app only uses the division you choose here.</li>
                        <li>Click <strong>Reports</strong>. Copy the URL from your browser. Example: <code class="small">https://www.fargorate.com/leagues/reports?leagueId=12345&amp;divisionId=67890</code></li>
                    </ol>
                    <div class="alert alert-warning py-2 px-3 mb-3 small">
                        <strong>Important:</strong> Do <strong>not</strong> use the dropdown on the Reports page to change division. The app cannot see that—it only finds teams for the division you selected in LMS <em>before</em> clicking Reports. To import a different division, go back to LMS, select that division, then open Reports again and copy the new URL.
                    </div>
                    <p class="mb-0">Then in the Smart Team Builder: paste the URL, click <strong>Load Divisions from FargoRate</strong>, select teams, configure settings, and click <strong>Create Division</strong>.</p>
                    <div class="form-check mt-4">
                        <input class="form-check-input" type="checkbox" id="fargoInstructionsDontShowAgain">
                        <label class="form-check-label" for="fargoInstructionsDontShowAgain">Don't show this again</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="fargoInstructionsGotItBtn" onclick="dismissFargoInstructionsModal()">Got it</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Smart Builder Modal -->
    <div class="modal fade" id="smartBuilderModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="smartBuilderModalTitle">Smart Team Builder - Import from FargoRate</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto;">
                    <div id="fargoScraperSection">
                        <p class="alert py-2 px-3 mb-3 small fargo-lo-required-banner"><strong>League Operator account required:</strong> You must have a <strong>League Operator (LO) account</strong> in FargoRate LMS to use this importer.</p>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Smart Builder</strong> allows you to import teams from FargoRate and automatically create divisions and teams in your dues tracker.
                        </div>
                        <div class="mb-4">
                            <h6>Step 1: Enter FargoRate URL</h6>
                            <div class="mb-3">
                                <label for="fargoLeagueUrl" class="form-label">FargoRate League Reports URL *</label>
                                <input type="url" class="form-control" id="fargoLeagueUrl" placeholder="https://www.fargorate.com/leagues/reports?leagueId=...&divisionId=...">
                                <small class="text-muted">Enter the URL from the FargoRate League Reports page for your division</small>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="fetchFargoDivisions()">
                                <i class="fas fa-sync me-2"></i>Load Divisions from FargoRate
                            </button>
                            <div id="fargoLoading" class="d-none mt-2">
                                <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                                <span>Loading divisions from FargoRate...</span>
                            </div>
                        </div>
                        <div id="fargoConfig" style="display: none;" class="mb-4">
                        <h6>Step 2: Select Division</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <label for="fargoDivisionSelect" class="form-label">FargoRate Division</label>
                                <select class="form-select" id="fargoDivisionSelect" onchange="onDivisionSelected()">
                                    <option value="">-- Select Division --</option>
                                    <!-- Options will be populated dynamically -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="fargoDivisionId" class="form-label">Or Enter Division ID</label>
                                <input type="text" class="form-control" id="fargoDivisionId" placeholder="Enter FargoRate Division ID">
                                <button type="button" class="btn btn-sm btn-outline-primary mt-2" onclick="setupManualDivisionIdListener()">
                                    <i class="fas fa-search me-1"></i>Load Division
                                </button>
                            </div>
                        </div>
                        </div>
                    </div>
                    
                    <div id="teamsSelectionSection" style="display: none;">
                        <h6>Step 2: Select Teams</h6>
                        <div class="mb-3">
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="toggleAllTeams()">
                                <i class="fas fa-check-square me-1"></i>Toggle All
                            </button>
                            <span class="ms-3"><strong id="selectedTeamsCount">0</strong> teams selected</span>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped" id="fargoTeamsPreview">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox" id="selectAllTeams" onchange="toggleAllTeams()"></th>
                                        <th>Team Name</th>
                                        <th>Captain</th>
                                        <th>Players</th>
                                        <th>Location</th>
                                        <th>Division</th>
                                        <th>Day</th>
                                    </tr>
                                </thead>
                                <tbody id="fargoTeamsPreviewBody">
                                    <!-- Teams will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div id="divisionSettingsSection" style="display: none;" class="mt-4 p-3 border rounded">
                        <h6>Step 4: Division Settings</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="smartBuilderDivisionName" class="form-label" id="divisionNameLabel">Division Name *</label>
                                    <input type="text" class="form-control" id="smartBuilderDivisionName" required>
                                    <small class="text-muted">This will be created in your dues tracker</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="smartBuilderGameType" class="form-label" id="gameTypeLabel">Game Type *</label>
                                    <select class="form-select" id="smartBuilderGameType" required onchange="updateSmartBuilderGameTypeOptions()">
                                        <option value="">Select Game Type</option>
                                        <option value="8-ball">8-ball</option>
                                        <option value="9-ball">9-ball</option>
                                        <option value="10-ball">10-ball</option>
                                        <option value="straight-pool">Straight Pool</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="smartBuilderIsDoublePlay" onchange="toggleSmartBuilderDoublePlayOptions(event)">
                                <label class="form-check-label" for="smartBuilderIsDoublePlay">
                                    Double Play (plays multiple divisions)
                                </label>
                            </div>
                        </div>
                        <div id="smartBuilderDoublePlayOptions" style="display: none;">
                            <div class="alert alert-info mb-3">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Double Play:</strong> This will create two divisions. The field above becomes "Division 1 Name". Enter Division 2 name and select both game types below.
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="smartBuilderDivision2Name" class="form-label">Division 2 Name *</label>
                                        <input type="text" class="form-control" id="smartBuilderDivision2Name" placeholder="e.g., Monday Night">
                                        <small class="text-muted">Name for the second division</small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="smartBuilderSecondGameType" class="form-label">Division 2 Game Type *</label>
                                        <select class="form-select" id="smartBuilderSecondGameType" required onchange="updateSmartBuilderGameTypeOptions()">
                                            <option value="">Select Division 2 Game Type</option>
                                            <option value="8-ball">8-ball</option>
                                            <option value="9-ball">9-ball</option>
                                            <option value="10-ball">10-ball</option>
                                            <option value="straight-pool">Straight Pool</option>
                                        </select>
                                        <small class="text-muted">Game type for Division 2</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="smartBuilderStartDate" class="form-label">First Date of Play *</label>
                                    <input type="date" class="form-control" id="smartBuilderStartDate" required onchange="calculateSmartBuilderEndDate()">
                                    <small id="smartBuilderDayOfWeekDisplay" class="text-muted d-block mt-1" style="display: none;">
                                        <i class="fas fa-calendar-day me-1"></i><span id="smartBuilderDayOfWeekText">-</span>
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="smartBuilderTotalWeeks" class="form-label">Total Weeks *</label>
                                    <select class="form-select" id="smartBuilderTotalWeeks" required onchange="calculateSmartBuilderEndDate()">
                                        <option value="">Select Weeks</option>
                                        <option value="8">8 weeks</option>
                                        <option value="10">10 weeks</option>
                                        <option value="12">12 weeks</option>
                                        <option value="14">14 weeks</option>
                                        <option value="16">16 weeks</option>
                                        <option value="18">18 weeks</option>
                                        <option value="20" selected>20 weeks</option>
                                        <option value="22">22 weeks</option>
                                        <option value="24">24 weeks</option>
                                        <option value="26">26 weeks</option>
                                        <option value="28">28 weeks</option>
                                        <option value="30">30 weeks</option>
                                        <option value="32">32 weeks</option>
                                        <option value="36">36 weeks</option>
                                        <option value="40">40 weeks</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="smartBuilderEndDate" class="form-label">End Date (Auto-calculated)</label>
                                    <input type="date" class="form-control" id="smartBuilderEndDate" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="smartBuilderMatchesPerWeek" class="form-label">Matches per Week (per Division) *</label>
                                    <select class="form-select" id="smartBuilderMatchesPerWeek" required onchange="toggleSmartBuilderMatchesOther()">
                                        <option value="">Select Matches</option>
                                        <option value="1">1 match per week</option>
                                        <option value="2">2 matches per week</option>
                                        <option value="3">3 matches per week</option>
                                        <option value="4">4 matches per week</option>
                                        <option value="5" selected>5 matches per week</option>
                                        <option value="6">6 matches per week</option>
                                        <option value="7">7 matches per week</option>
                                        <option value="8">8 matches per week</option>
                                        <option value="9">9 matches per week</option>
                                        <option value="10">10 matches per week</option>
                                        <option value="other">Other</option>
                                    </select>
                                    <div id="smartBuilderMatchesOtherWrap" class="mt-2" style="display: none;">
                                        <label for="smartBuilderMatchesPerWeekOther" class="form-label small">Custom matches per week</label>
                                        <input type="number" class="form-control form-control-sm" id="smartBuilderMatchesPerWeekOther" min="1" max="99" placeholder="e.g. 12" style="max-width: 8rem;">
                                    </div>
                                    <small class="text-muted d-block mt-1">
                                        <i class="fas fa-info-circle me-1"></i>This is per division. Double play counts as 2 divisions (the app combines them for display).
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="smartBuilderPlayersPerWeek" class="form-label">Players per Week *</label>
                                    <select class="form-select" id="smartBuilderPlayersPerWeek" required onchange="toggleSmartBuilderPlayersOther()">
                                        <option value="">Select Players</option>
                                        <option value="1">1 player</option>
                                        <option value="2">2 players</option>
                                        <option value="3">3 players</option>
                                        <option value="4">4 players</option>
                                        <option value="5" selected>5 players</option>
                                        <option value="other">Other</option>
                                    </select>
                                    <div id="smartBuilderPlayersOtherWrap" class="mt-2" style="display: none;">
                                        <label for="smartBuilderPlayersPerWeekOther" class="form-label small">Custom players per week</label>
                                        <input type="number" class="form-control form-control-sm" id="smartBuilderPlayersPerWeekOther" min="1" max="99" placeholder="e.g. 8" style="max-width: 8rem;">
                                    </div>
                                    <small class="text-muted d-block mt-1">
                                        <i class="fas fa-info-circle me-1"></i>Per team, per division, each week.
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="smartBuilderWeeklyDues" class="form-label">Dues per Player per Match *</label>
                                    <select class="form-select" id="smartBuilderWeeklyDues" required>
                                        <option value="">Select Amount</option>
                                        <option value="5">$5.00</option>
                                        <option value="6">$6.00</option>
                                        <option value="7">$7.00</option>
                                        <option value="8" selected>$8.00</option>
                                        <option value="9">$9.00</option>
                                        <option value="10">$10.00</option>
                                        <option value="11">$11.00</option>
                                        <option value="12">$12.00</option>
                                        <option value="13">$13.00</option>
                                        <option value="14">$14.00</option>
                                        <option value="15">$15.00</option>
                                        <option value="16">$16.00</option>
                                        <option value="17">$17.00</option>
                                        <option value="18">$18.00</option>
                                        <option value="19">$19.00</option>
                                        <option value="20">$20.00</option>
                                        <option value="25">$25.00</option>
                                        <option value="30">$30.00</option>
                                        <option value="35">$35.00</option>
                                        <option value="40">$40.00</option>
                                        <option value="50">$50.00</option>
                                    </select>
                                    <small class="text-muted d-block mt-1">
                                        <i class="fas fa-info-circle me-1"></i>Amount each player pays per match they play.
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 pt-3 border-top">
                            <button class="btn btn-sm btn-outline-secondary d-flex align-items-center gap-2" type="button" data-bs-toggle="collapse" data-bs-target="#smartBuilderFinancialCollapse" aria-expanded="false">
                                <i class="fas fa-money-bill-wave"></i>
                                <span>Financial breakdown (optional)</span>
                                <i class="fas fa-chevron-down ms-auto small"></i>
                            </button>
                            <div class="collapse mt-3" id="smartBuilderFinancialCollapse">
                                <div class="mb-3">
                                    <label class="form-label small fw-semibold">Financial distribution</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="smartBuilderFinancialOption" id="smartBuilderFinancialUseDefault" value="default" checked onchange="toggleSmartBuilderFinancialOption()">
                                        <label class="form-check-label" for="smartBuilderFinancialUseDefault">Use default</label>
                                    </div>
                                    <small class="text-muted d-block ms-4 mb-2">Use your default distribution from Profile &amp; Settings for this division.</small>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="smartBuilderFinancialOption" id="smartBuilderFinancialDivisionSpecific" value="divisionSpecific" onchange="toggleSmartBuilderFinancialOption()">
                                        <label class="form-check-label" for="smartBuilderFinancialDivisionSpecific">Set division-specific</label>
                                    </div>
                                    <small class="text-muted d-block ms-4 mb-2">Override with percentages or dollar amounts below. These will override your default when you create the division.</small>
                                </div>
                                <div id="smartBuilderUsingDefaultMessage" class="alert alert-success py-2 mb-3 d-flex align-items-center gap-2">
                                    <i class="fas fa-check-circle"></i>
                                    <span><strong>Using default settings</strong> — This division will use your default distribution from Profile &amp; Settings.</span>
                                </div>
                                <div id="smartBuilderDivisionSpecificWrap" style="display: none;">
                                <p class="small text-info mb-2"><i class="fas fa-info-circle me-1"></i><strong>Division-specific settings</strong> — The values below will override your default from Profile &amp; Settings.</p>
                                <div class="mb-3">
                                    <label class="form-label small">Calculation method</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="smartBuilderCalculationMethod" id="smartBuilderMethodPercentage" value="percentage" checked onchange="toggleSmartBuilderFinancialMethod()">
                                        <label class="form-check-label" for="smartBuilderMethodPercentage">Percentage-based</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="smartBuilderCalculationMethod" id="smartBuilderMethodDollar" value="dollar" onchange="toggleSmartBuilderFinancialMethod()">
                                        <label class="form-check-label" for="smartBuilderMethodDollar">Dollar amount-based</label>
                                    </div>
                                </div>
                                <div id="smartBuilderPercentageInputs">
                                    <div class="row g-2 mb-2">
                                        <div class="col-md-4">
                                            <label for="smartBuilderPrizeFundPct" class="form-label small">Prize Fund %</label>
                                            <div class="input-group input-group-sm">
                                                <input type="number" class="form-control" id="smartBuilderPrizeFundPct" step="0.1" min="0" max="100" placeholder="50">
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="smartBuilderFirstOrgPct" class="form-label small"><span id="smartBuilderFirstOrgLabel">League Manager</span> %</label>
                                            <div class="input-group input-group-sm">
                                                <input type="number" class="form-control" id="smartBuilderFirstOrgPct" step="0.1" min="0" max="100" placeholder="60">
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="smartBuilderSecondOrgPct" class="form-label small"><span id="smartBuilderSecondOrgLabel">National Org</span> %</label>
                                            <div class="input-group input-group-sm">
                                                <input type="number" class="form-control" id="smartBuilderSecondOrgPct" step="0.1" min="0" max="100" placeholder="40">
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="smartBuilderDollarInputs" style="display: none;">
                                    <div class="row g-2 mb-2">
                                        <div class="col-md-4">
                                            <label for="smartBuilderPrizeFundAmount" class="form-label small">Prize Fund $</label>
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">$</span>
                                                <input type="number" class="form-control" id="smartBuilderPrizeFundAmount" step="0.01" min="0" placeholder="0">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label small">Per</label>
                                            <div class="btn-group btn-group-sm w-100" role="group">
                                                <input type="radio" class="btn-check" name="smartBuilderPrizeFundAmountType" id="smartBuilderPrizePerTeam" value="perTeam" checked>
                                                <label class="btn btn-outline-secondary" for="smartBuilderPrizePerTeam">Team</label>
                                                <input type="radio" class="btn-check" name="smartBuilderPrizeFundAmountType" id="smartBuilderPrizePerPlayer" value="perPlayer">
                                                <label class="btn btn-outline-secondary" for="smartBuilderPrizePerPlayer">Player</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-2 mb-2">
                                        <div class="col-md-4">
                                            <label for="smartBuilderFirstOrgAmount" class="form-label small"><span id="smartBuilderFirstOrgDollarLabel">League Manager</span> $</label>
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">$</span>
                                                <input type="number" class="form-control" id="smartBuilderFirstOrgAmount" step="0.01" min="0" placeholder="0">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label small">Per</label>
                                            <div class="btn-group btn-group-sm w-100" role="group">
                                                <input type="radio" class="btn-check" name="smartBuilderFirstOrgAmountType" id="smartBuilderFirstOrgPerTeam" value="perTeam" checked>
                                                <label class="btn btn-outline-secondary" for="smartBuilderFirstOrgPerTeam">Team</label>
                                                <input type="radio" class="btn-check" name="smartBuilderFirstOrgAmountType" id="smartBuilderFirstOrgPerPlayer" value="perPlayer">
                                                <label class="btn btn-outline-secondary" for="smartBuilderFirstOrgPerPlayer">Player</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-2 mb-2">
                                        <div class="col-md-4">
                                            <label for="smartBuilderSecondOrgAmount" class="form-label small"><span id="smartBuilderSecondOrgDollarLabel">National Org</span> $</label>
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">$</span>
                                                <input type="number" class="form-control" id="smartBuilderSecondOrgAmount" step="0.01" min="0" placeholder="0">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label small">Per</label>
                                            <div class="btn-group btn-group-sm w-100" role="group">
                                                <input type="radio" class="btn-check" name="smartBuilderSecondOrgAmountType" id="smartBuilderSecondOrgPerTeam" value="perTeam" checked>
                                                <label class="btn btn-outline-secondary" for="smartBuilderSecondOrgPerTeam">Team</label>
                                                <input type="radio" class="btn-check" name="smartBuilderSecondOrgAmountType" id="smartBuilderSecondOrgPerPlayer" value="perPlayer">
                                                <label class="btn btn-outline-secondary" for="smartBuilderSecondOrgPerPlayer">Player</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                </div>
                            </div>
                        </div>
                        <div id="manualBuilderInHouseWrap" class="mt-3 pt-3 border-top" style="display: none;">
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="manualBuilderInHouseCheckbox" onchange="toggleManualBuilderInHouse()">
                                <label class="form-check-label" for="manualBuilderInHouseCheckbox">In-House (set default location for teams in this division)</label>
                            </div>
                            <div id="manualBuilderInHouseLocationWrap" class="mt-2" style="display: none;">
                                <label for="manualBuilderInHouseLocation" class="form-label small mb-0">Default Location</label>
                                <input type="text" class="form-control form-control-sm" id="manualBuilderInHouseLocation" placeholder="e.g., Main Street Pool Hall" style="max-width: 300px;">
                            </div>
                            <small class="text-muted d-block mt-1">
                                <i class="fas fa-info-circle me-1"></i>Teams you add to this division will have this location pre-filled.
                            </small>
                        </div>
                    </div>
                    
                    <div id="continueToPreviewContainer" style="display: none;" class="mt-3">
                        <!-- Continue to Preview button will be added here dynamically -->
                    </div>
                    
                    <div id="summarySection" style="display: none;" class="mt-4">
                        <h6>Step 4: Division Summary</h6>
                        <div class="alert alert-info mb-3">
                            <i class="fas fa-clipboard-check me-2"></i>
                            <strong>Review your division configuration below.</strong> When ready, click Import to App to create the division and teams.
                        </div>
                        <div id="summaryContent" class="card border mb-3">
                            <div class="card-body">
                                <div id="summaryDivisionName" class="mb-3">
                                    <strong class="text-muted small d-block">Division Name</strong>
                                    <span id="summaryDivisionNameText">-</span>
                                </div>
                                <div class="row g-2 mb-3">
                                    <div class="col-md-4">
                                        <strong class="text-muted small d-block">Matches per Week</strong>
                                        <span id="summaryMatchesPerWeek">-</span>
                                    </div>
                                    <div class="col-md-4">
                                        <strong class="text-muted small d-block">Players per Week</strong>
                                        <span id="summaryPlayersPerWeek">-</span>
                                    </div>
                                    <div class="col-md-4">
                                        <strong class="text-muted small d-block">Dues per Player per Match</strong>
                                        <span id="summaryDuesPerMatch">-</span>
                                    </div>
                                </div>
                                <div class="row g-2 mb-3">
                                    <div class="col-md-4">
                                        <strong class="text-muted small d-block">Start Date</strong>
                                        <span id="summaryStartDate">-</span>
                                    </div>
                                    <div class="col-md-4">
                                        <strong class="text-muted small d-block">End Date</strong>
                                        <span id="summaryEndDate">-</span>
                                    </div>
                                    <div class="col-md-4">
                                        <strong class="text-muted small d-block">Total Weeks</strong>
                                        <span id="summaryTotalWeeks">-</span>
                                    </div>
                                </div>
                                <div class="row g-2 mb-3">
                                    <div class="col-md-4">
                                        <strong class="text-muted small d-block">Teams to Import</strong>
                                        <span id="summaryTeamCount">-</span>
                                    </div>
                                    <div class="col-md-4">
                                        <strong class="text-muted small d-block">Total Players</strong>
                                        <span id="summaryPlayerCount">-</span>
                                    </div>
                                    <div class="col-md-4">
                                        <strong class="text-muted small d-block">Weekly Dues per Team</strong>
                                        <span id="summaryWeeklyDues">-</span>
                                    </div>
                                </div>
                                <div id="summaryFinancialWrap" class="mb-0" style="display: none;">
                                    <strong class="text-muted small d-block mb-2">Financial Breakdown</strong>
                                    <div id="summaryFinancialContent" class="small"></div>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-outline-secondary" id="backToTeamPreviewBtn" onclick="goBackToTeamPreview()">
                                <i class="fas fa-arrow-left me-2"></i>Back to Teams
                            </button>
                        </div>
                    </div>
                    
                    <div id="previewSection" style="display: none;" class="mt-4">
                        <h6>Step 3: Preview Teams</h6>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Set up your division and teams below.</strong> Edit team names, captains, and locations. When ready, click View Summary to review and import.
                        </div>
                        <div class="mb-3">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="previewInHouseCheckbox" onchange="togglePreviewInHouseLocation()">
                                <label class="form-check-label" for="previewInHouseCheckbox">In-House (same location for all teams)</label>
                            </div>
                            <div id="previewInHouseLocationWrap" class="mt-2" style="display: none;">
                                <label for="previewInHouseLocation" class="form-label small mb-0">In-House Location</label>
                                <input type="text" class="form-control form-control-sm" id="previewInHouseLocation" placeholder="e.g., Main Street Pool Hall" style="max-width: 300px;" oninput="applyInHouseLocationToAllTeams()">
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped" id="teamsPreview">
                                <thead>
                                    <tr>
                                        <th style="width: 40px;"></th>
                                        <th>Team Name</th>
                                        <th>Captain</th>
                                        <th>Players</th>
                                        <th>Location</th>
                                        <th>Dues</th>
                                    </tr>
                                </thead>
                                <tbody id="teamsPreviewBody">
                                    <!-- Teams preview will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-3">
                            <button type="button" class="btn btn-primary" id="viewSummaryBtn" onclick="showSummaryFromPreview()">
                                <i class="fas fa-clipboard-list me-2"></i>View Summary
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="flex-grow-1 me-3">
                        <div id="divisionStatsFooter" class="d-flex flex-wrap gap-3 align-items-center" style="display: none;">
                            <div class="stat-item">
                                <span class="text-muted small">Division:</span>
                                <strong id="statsDivisionName">-</strong>
                            </div>
                            <div class="stat-item">
                                <span class="text-muted small">Day of Play:</span>
                                <strong id="statsDayOfPlay">-</strong>
                            </div>
                            <div class="stat-item">
                                <span class="text-muted small">Weeks:</span>
                                <strong id="statsTotalWeeks">-</strong>
                            </div>
                            <div class="stat-item">
                                <span class="text-muted small">Teams:</span>
                                <strong id="statsTeamCount">-</strong>
                            </div>
                            <div class="stat-item">
                                <span class="text-muted small">Players:</span>
                                <strong id="statsPlayerCount">-</strong>
                            </div>
                            <div class="stat-item">
                                <span class="text-muted small">Weekly Dues per Team:</span>
                                <strong id="statsWeeklyDuesPerTeam">-</strong>
                            </div>
                        </div>
                    </div>
                    <div>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-success" id="createDivisionManualBtn" onclick="createDivisionFromManualBuilder()" style="display: none;">
                            <i class="fas fa-plus me-2"></i>Create Division
                        </button>
                        <button type="button" class="btn btn-primary" id="createTeamsBtn" onclick="createTeamsAndDivision()" style="display: none;">
                            <i class="fas fa-download me-2"></i>Import to App
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Players Modal -->
    <div class="modal fade" id="playersModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">All Players</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto;">
                    <div class="players-modal-stats mb-3">
                        <h6 class="text-center text-muted mb-2">Sanctioning Stats</h6>
                        <div id="playersSummaryCards" class="d-flex flex-wrap gap-2 justify-content-center align-items-center mb-3">
                            <span class="badge bg-secondary players-stat-badge">Total: <span id="totalPlayersCount">0</span></span>
                            <span class="badge bg-success players-stat-badge">Paid: <span id="sanctionPaidCount">0</span></span>
                            <span class="badge bg-warning text-dark players-stat-badge">Pending: <span id="sanctionPendingCount">0</span></span>
                            <span class="badge bg-info players-stat-badge">Previously: <span id="previouslySanctionedCount">0</span></span>
                            <span class="badge bg-primary players-stat-badge">Fees: <span id="sanctionFeesCollected">$0.00</span></span>
                        </div>
                        <div class="d-flex justify-content-center">
                            <div class="players-search-wrap" style="max-width: 400px; width: 100%;">
                                <input type="text" class="form-control" id="playersSearchInput" placeholder="Search players..." oninput="filterPlayersTable()">
                            </div>
                        </div>
                    </div>
                    <div class="card border-0 shadow-sm mb-3">
                        <div class="card-body">
                            <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-2">
                                <h6 class="mb-0">
                                    <i class="fas fa-user-plus me-1 text-primary"></i>
                                    Players Looking for Teams
                                </h6>
                                <div class="d-flex gap-2">
                                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="loadTeamSeekers()">
                                        <i class="fas fa-sync-alt me-1"></i>Refresh
                                    </button>
                                    <button type="button" class="btn btn-primary btn-sm" onclick="showAddSeekerModal()">
                                        <i class="fas fa-plus me-1"></i>Add Player
                                    </button>
                                </div>
                            </div>
                            <div class="d-flex flex-wrap gap-2 mb-2">
                                <span class="badge bg-secondary players-stat-badge">Total: <span id="seekersTotalCount">0</span></span>
                                <span class="badge bg-warning text-dark players-stat-badge">Seeking: <span id="seekersSeekingCount">0</span></span>
                                <span class="badge bg-success players-stat-badge">Placed: <span id="seekersPlacedCount">0</span></span>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="showPlacedSeekers" onchange="renderTeamSeekersTable()">
                                <label class="form-check-label small text-muted" for="showPlacedSeekers">
                                    Show placed players
                                </label>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-sm table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th>Player</th>
                                            <th>Contact</th>
                                            <th>Preference</th>
                                            <th>Status</th>
                                            <th>Notes</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="seekersTableBody">
                                        <tr><td colspan="6" class="text-muted small">No players looking for teams yet.</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover" id="playersTable">
                            <thead>
                                <tr>
                                    <th class="sortable-column" onclick="sortPlayersTable('name')" style="cursor: pointer;">
                                        Player Name
                                        <i class="fas fa-sort sort-icon" id="players-sort-icon-name"></i>
                                    </th>
                                    <th class="sortable-column" onclick="sortPlayersTable('team')" style="cursor: pointer;">
                                        Team
                                        <i class="fas fa-sort sort-icon" id="players-sort-icon-team"></i>
                                    </th>
                                    <th class="sortable-column" onclick="sortPlayersTable('division')" style="cursor: pointer;">
                                        Division
                                        <i class="fas fa-sort sort-icon" id="players-sort-icon-division"></i>
                                    </th>
                                    <th class="sortable-column" onclick="sortPlayersTable('sanctionStatus')" style="cursor: pointer;">
                                        Sanction Status
                                        <i class="fas fa-sort sort-icon" id="players-sort-icon-sanctionStatus"></i>
                                    </th>
                                    <th class="sortable-column" onclick="sortPlayersTable('previouslySanctioned')" style="cursor: pointer;">
                                        Previously Sanctioned
                                        <i class="fas fa-sort sort-icon" id="players-sort-icon-previouslySanctioned"></i>
                                    </th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="playersTableBody">
                                <!-- Players will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Team Seeker Modal -->
    <div class="modal fade" id="addSeekerModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="seekerModalTitle"><i class="fas fa-user-plus text-primary me-2"></i>Add Player Looking for Team</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addSeekerForm">
                        <input type="hidden" id="seekerId">
                        <div class="mb-2">
                            <label for="seekerName" class="form-label">Name *</label>
                            <input type="text" class="form-control" id="seekerName" required>
                        </div>
                        <div class="mb-2">
                            <label for="seekerEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="seekerEmail" placeholder="player@example.com">
                        </div>
                        <div class="mb-2">
                            <label for="seekerPhone" class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="seekerPhone" placeholder="(555) 123-4567">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Preference Type</label>
                            <div class="d-flex gap-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="seekerPreferenceMode" id="seekerPreferenceDivision" value="division" checked onchange="toggleSeekerPreferenceMode()">
                                    <label class="form-check-label" for="seekerPreferenceDivision">Division</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="seekerPreferenceMode" id="seekerPreferenceDay" value="day" onchange="toggleSeekerPreferenceMode()">
                                    <label class="form-check-label" for="seekerPreferenceDay">Day of Week</label>
                                </div>
                            </div>
                        </div>
                        <div class="mb-2" id="seekerPreferredDivisionWrap">
                            <label for="seekerPreferredDivision" class="form-label">Preferred Division</label>
                            <select class="form-select" id="seekerPreferredDivision">
                                <option value="">Any division</option>
                            </select>
                        </div>
                        <div class="mb-2" id="seekerPreferredDayWrap" style="display: none;">
                            <label for="seekerPreferredDay" class="form-label">Preferred Day of Week</label>
                            <select class="form-select" id="seekerPreferredDay">
                                <option value="">Any day</option>
                                <option value="Monday">Monday</option>
                                <option value="Tuesday">Tuesday</option>
                                <option value="Wednesday">Wednesday</option>
                                <option value="Thursday">Thursday</option>
                                <option value="Friday">Friday</option>
                                <option value="Saturday">Saturday</option>
                                <option value="Sunday">Sunday</option>
                            </select>
                            <div class="form-check mt-2">
                                <input class="form-check-input" type="checkbox" id="seekerPrefersEarlyStart">
                                <label class="form-check-label" for="seekerPrefersEarlyStart">
                                    Prefers earlier start time
                                </label>
                            </div>
                        </div>
                        <div class="mb-0">
                            <label for="seekerNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="seekerNotes" rows="3" placeholder="Availability, skill level, contact preferences, etc."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveSeekerButton" onclick="saveTeamSeeker()">
                        <i class="fas fa-save me-1"></i>Save
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Place Seeker On Team Modal -->
    <div class="modal fade" id="placeSeekerModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user-check text-success me-2"></i>Place Player On Team</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="placeSeekerId">
                    <label for="placeSeekerTeamSelect" class="form-label">Select team *</label>
                    <select class="form-select" id="placeSeekerTeamSelect">
                        <option value="">Select a team...</option>
                    </select>
                    <small class="text-muted d-block mt-2">A team is required to mark this player as placed.</small>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="confirmSeekerPlacement()">
                        <i class="fas fa-check me-1"></i>Mark Placed
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Player Modal -->
    <div class="modal fade" id="editPlayerModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Player</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto;">
                    <form id="editPlayerForm">
                        <div class="mb-3">
                            <label for="editPlayerName" class="form-label">Player Name</label>
                            <input type="text" class="form-control" id="editPlayerName" readonly style="background-color: #f8f9fa; cursor: not-allowed;">
                            <small class="text-muted">Player name cannot be changed. To rename a player, edit them in their team settings.</small>
                        </div>
                        <div class="mb-3">
                            <label for="editPlayerEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="editPlayerEmail" placeholder="player@example.com">
                        </div>
                        <div class="mb-3">
                            <label for="editPlayerPhone" class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="editPlayerPhone" placeholder="(555) 123-4567">
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Sanction Status</label>
                            <div class="card bg-light mb-2">
                                <div class="card-body p-3">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="editPlayerSanctionPaid">
                                        <label class="form-check-label fw-semibold" for="editPlayerSanctionPaid">
                                            <i class="fas fa-dollar-sign text-success me-1"></i>Sanction Fee Paid
                                        </label>
                                        <small class="d-block text-muted ms-4 mt-1">Player has paid the sanction fee through this system</small>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="editPlayerPreviouslySanctioned">
                                        <label class="form-check-label fw-semibold" for="editPlayerPreviouslySanctioned">
                                            <i class="fas fa-history text-info me-1"></i>Previously Sanctioned
                                        </label>
                                        <small class="d-block text-muted ms-4 mt-1">Player paid elsewhere/earlier for current year (not counted in app totals)</small>
                                    </div>
                                </div>
                            </div>
                            <div id="editPlayerSanctionDatesContainer" style="display: none;" class="mt-3">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-calendar me-1"></i>Sanction Period
                                    <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Set the start and end dates for this sanction. Defaults to calendar year (Jan 1 - Dec 31) if not set."></i>
                                </label>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="editPlayerSanctionStartDate" class="form-label small">Start Date</label>
                                        <input type="date" class="form-control" id="editPlayerSanctionStartDate">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="editPlayerSanctionEndDate" class="form-label small">End Date</label>
                                        <input type="date" class="form-control" id="editPlayerSanctionEndDate">
                                    </div>
                                </div>
                                <small class="text-muted">
                                    <span id="editPlayerSanctionExpired" class="text-danger" style="display: none;">
                                        <i class="fas fa-exclamation-triangle me-1"></i>This sanction has expired.
                                    </span>
                                </small>
                            </div>
                            <small class="text-muted"><i class="fas fa-info-circle me-1"></i>These settings apply to this player across all teams.</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="savePlayerButton" onclick="savePlayerChanges()">
                        <i class="fas fa-save me-2"></i>Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sanction Fee Confirmation Modal -->
    <div class="modal fade" id="sanctionFeeConfirmModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-dollar-sign me-2"></i>Sanction Fee Payment
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">
                        <strong id="confirmSanctionPlayerName">This player</strong> is marked as sanction fee paid 
                        (<strong id="confirmSanctionFeeAmount">$0.00</strong>). Should this sanction fee be <strong>calculated</strong> 
                        (included in totals collected)?
                    </p>
                    <div class="alert alert-info mb-0">
                        <strong>Options:</strong><br>
                        • <strong>Yes, calculate it</strong>: Player paid through this system — include in sanction fees collected<br>
                        • <strong>No, don't calculate it</strong>: Player paid elsewhere — mark "Previously Sanctioned," not counted in totals<br>
                        • <strong>Cancel</strong>: Don't change status
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="sanctionConfirmCancelBtn" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-outline-info" id="sanctionConfirmPaidElsewhereBtn">
                        <i class="fas fa-history me-1"></i>No, Don't Calculate
                    </button>
                    <button type="button" class="btn btn-success" id="sanctionConfirmAddToTotalsBtn">
                        <i class="fas fa-calculator me-1"></i>Yes, Calculate It
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment History Modal -->
    <div class="modal fade" id="paymentHistoryModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Payment History</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto;">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Week</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Amount</th>
                                    <th>Method</th>
                                    <th>Paid By</th>
                                    <th>Payment Date</th>
                                    <th>Notes</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="paymentHistoryTableBody">
                                <!-- Payment history will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Profile & Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs mb-3" id="profileTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="profile-tab" role="tab">Profile</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="financial-tab" role="tab">Dues Distribution</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="sanction-tab" role="tab">Sanction Fees</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="subscription-tab" role="tab">Subscription/Donate</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="profileTabContent">
                        <div class="tab-pane fade show active" id="profile-pane" role="tabpanel">
                            <form id="profileForm">
                                <div class="mb-3">
                                    <label for="profileName" class="form-label">
                                        Your Name
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Your personal name as the league operator"></i>
                                    </label>
                                    <input type="text" class="form-control" id="profileName">
                                </div>
                                <div class="mb-3">
                                    <label for="profileEmail" class="form-label">
                                        Email
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Your email address (cannot be changed)"></i>
                                    </label>
                                    <input type="email" class="form-control" id="profileEmail" readonly>
                                </div>
                                <div class="mb-3">
                                    <label for="profileOrganizationName" class="form-label">
                                        Organization/League Name
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="The name of your pool league or organization. If left blank, the navbar shows Duezy."></i>
                                    </label>
                                    <input type="text" class="form-control" id="profileOrganizationName" placeholder="e.g. My Pool League">
                                    <small class="text-muted">If left blank, the navbar shows <strong>Duezy</strong>.</small>
                                </div>
                                <div class="mb-3">
                                    <label for="profilePhone" class="form-label">
                                        Phone
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Your contact phone number (optional)"></i>
                                    </label>
                                    <input type="tel" class="form-control" id="profilePhone">
                                </div>
                                
                                <h6 class="mt-4">Theme</h6>
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="themeToggle" onchange="setTheme(this.checked ? 'dark' : 'light')">
                                        <label class="form-check-label" for="themeToggle">
                                            Dark Mode
                                        </label>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="financial-pane" role="tabpanel">
                            <small class="text-muted d-block mb-3" id="financialLockedHint" style="display: none;">Saved settings are read-only. Click <i class="fas fa-pen fa-xs"></i> next to a field to edit it.</small>
                            <div id="financialFieldsContainer">
                            <div class="mb-3 financial-field-group" data-fields="profileDefaultDues">
                                <label for="profileDefaultDues" class="form-label d-flex align-items-center gap-1">
                                    Default Dues Per Player Per Match
                                    <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="The default dues amount charged per player per match. This is used when creating new divisions and can be overridden per division."></i>
                                    <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="profileDefaultDues" step="0.01" min="0">
                                </div>
                                <small class="text-muted">This is the default dues rate used when creating new divisions.</small>
                            </div>
                            <div class="mb-3 financial-field-group" data-fields="profileDefaultPlayersPerWeek">
                                <label for="profileDefaultPlayersPerWeek" class="form-label d-flex align-items-center gap-1">
                                    Default Players per Week
                                    <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Default number of players per team per week. Used when creating new divisions and can be overridden per division."></i>
                                    <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                </label>
                                <select class="form-select" id="profileDefaultPlayersPerWeek" style="max-width: 8rem;">
                                    <option value="">No default</option>
                                    <option value="3">3 players</option>
                                    <option value="4">4 players</option>
                                    <option value="5">5 players</option>
                                    <option value="6">6 players</option>
                                    <option value="7">7 players</option>
                                    <option value="8">8 players</option>
                                    <option value="9">9 players</option>
                                    <option value="10">10 players</option>
                                </select>
                                <small class="text-muted">Used when creating new divisions; each division can override this.</small>
                            </div>
                            <hr>
                            <div class="mb-3 financial-field-group" data-fields="" data-radios="calculationMethod">
                                <label class="form-label d-flex align-items-center gap-1">
                                    Calculation Method
                                    <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Choose how to calculate financial breakdown: Percentage splits the dues by percentage, Dollar Amount uses fixed dollar amounts per team or player."></i>
                                    <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                </label>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="calculationMethod" id="methodPercentage" value="percentage" checked onchange="toggleCalculationMethod()">
                                    <label class="form-check-label" for="methodPercentage">
                                        Percentage-based
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="calculationMethod" id="methodDollarAmount" value="dollar" onchange="toggleCalculationMethod()">
                                    <label class="form-check-label" for="methodDollarAmount">
                                        Dollar amount-based
                                    </label>
                                </div>
                                <small class="text-muted">Active format: <span id="activeFormatLabel">Percentage</span></small>
                                <div id="saveToChangeFormatMsg" class="alert alert-warning mt-2" style="display: none;">
                                    <small>Save your profile to change the calculation method.</small>
                                </div>
                            </div>
                            <div id="percentageInputs">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3 financial-field-group" data-fields="profilePrizeFundPercentage">
                                            <label for="profilePrizeFundPercentage" class="form-label d-flex align-items-center gap-1">
                                                Prize Fund Percentage
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Percentage of dues that goes to the prize fund for tournaments and payouts"></i>
                                                <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="input-group">
                                                <input type="number" class="form-control" id="profilePrizeFundPercentage" step="0.1" min="0" max="100">
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3 financial-field-group" data-fields="profilePrizeFundName">
                                            <label for="profilePrizeFundName" class="form-label d-flex align-items-center gap-1">
                                                Prize Fund Name
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Custom name for your prize fund (e.g., 'Tournament Fund', 'Prize Pool')"></i>
                                                <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <input type="text" class="form-control" id="profilePrizeFundName">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3 financial-field-group" data-fields="profileFirstOrganizationPercentage">
                                            <label for="profileFirstOrganizationPercentage" class="form-label d-flex align-items-center gap-1">
                                                First Organization Percentage
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Percentage of dues allocated to the first organization (e.g., League Manager)"></i>
                                                <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="input-group">
                                                <input type="number" class="form-control" id="profileFirstOrganizationPercentage" step="0.1" min="0" max="100">
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3 financial-field-group" data-fields="profileFirstOrganizationName">
                                            <label for="profileFirstOrganizationName" class="form-label d-flex align-items-center gap-1">
                                                Your organization / League
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Your league or local organization—the share of dues that stays with you (e.g., League Manager, Local Office)"></i>
                                                <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <input type="text" class="form-control" id="profileFirstOrganizationName">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3 financial-field-group" data-fields="profileSecondOrganizationPercentage">
                                            <label for="profileSecondOrganizationPercentage" class="form-label d-flex align-items-center gap-1">
                                                Second Organization Percentage
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Percentage of dues allocated to the second organization (e.g., National Office, Parent Organization)"></i>
                                                <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="input-group">
                                                <input type="number" class="form-control" id="profileSecondOrganizationPercentage" step="0.1" min="0" max="100">
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3 financial-field-group" data-fields="profileSecondOrganizationName">
                                            <label for="profileSecondOrganizationName" class="form-label d-flex align-items-center gap-1">
                                                Parent / National organization
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="The parent or national body that receives a portion of dues (e.g., USAPL, BCA, state or national office)"></i>
                                                <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <input type="text" class="form-control" id="profileSecondOrganizationName">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="dollarAmountInputs" style="display: none;">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3 financial-field-group" data-fields="profilePrizeFundAmount" data-radios="prizeFundAmountType">
                                            <label for="profilePrizeFundAmount" class="form-label d-flex align-items-center gap-1">
                                                Prize Fund Amount
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Fixed dollar amount allocated to the prize fund per team or per player (based on Amount Type)"></i>
                                                <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="input-group">
                                                <span class="input-group-text">$</span>
                                                <input type="number" class="form-control" id="profilePrizeFundAmount" step="0.01" min="0">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3 financial-field-group" data-fields="profilePrizeFundAmount" data-radios="prizeFundAmountType">
                                            <label for="prizeFundAmountType" class="form-label d-flex align-items-center gap-1">
                                                Amount Type
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Whether the prize fund amount is calculated per team or per player"></i>
                                                <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="btn-group w-100" role="group">
                                                <input type="radio" class="btn-check" name="prizeFundAmountType" id="prizeFundPerTeam" value="perTeam" checked>
                                                <label class="btn btn-outline-secondary btn-sm" for="prizeFundPerTeam">Per Team</label>
                                                <input type="radio" class="btn-check" name="prizeFundAmountType" id="prizeFundPerPlayer" value="perPlayer">
                                                <label class="btn btn-outline-secondary btn-sm" for="prizeFundPerPlayer">Per Player</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-5">
                                        <div class="mb-3 financial-field-group" data-fields="profileFirstOrganizationNameDollar,profileFirstOrganizationAmount" data-radios="firstOrganizationAmountType">
                                            <label for="profileFirstOrganizationNameDollar" class="form-label d-flex align-items-center gap-1">
                                                Your organization / League
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Your league or local organization—the fixed amount that stays with you"></i>
                                                <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <input type="text" class="form-control" id="profileFirstOrganizationNameDollar">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3 financial-field-group" data-fields="profileFirstOrganizationAmount" data-radios="firstOrganizationAmountType">
                                            <label class="form-label d-flex align-items-center gap-1">
                                                Amount Type
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Whether the first organization amount is calculated per team or per player"></i>
                                                <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="btn-group w-100" role="group">
                                                <input type="radio" class="btn-check" name="firstOrganizationAmountType" id="firstOrgPerTeam" value="perTeam" checked>
                                                <label class="btn btn-outline-secondary btn-sm" for="firstOrgPerTeam">Per Team</label>
                                                <input type="radio" class="btn-check" name="firstOrganizationAmountType" id="firstOrgPerPlayer" value="perPlayer">
                                                <label class="btn btn-outline-secondary btn-sm" for="firstOrgPerPlayer">Per Player</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3 financial-field-group" data-fields="profileFirstOrganizationAmount" data-radios="firstOrganizationAmountType">
                                            <label for="profileFirstOrganizationAmount" class="form-label d-flex align-items-center gap-1">
                                                Amount
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Fixed dollar amount allocated to the first organization per team or per player"></i>
                                                <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="input-group">
                                                <span class="input-group-text">$</span>
                                                <input type="number" class="form-control" id="profileFirstOrganizationAmount" step="0.01" min="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-5">
                                        <div class="mb-3 financial-field-group" data-fields="profileSecondOrganizationNameDollar,profileSecondOrganizationAmount" data-radios="secondOrganizationAmountType">
                                            <label for="profileSecondOrganizationNameDollar" class="form-label d-flex align-items-center gap-1">
                                                Parent / National organization
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="The parent or national body that receives a fixed dollar amount (e.g., USAPL, BCA)"></i>
                                                <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <input type="text" class="form-control" id="profileSecondOrganizationNameDollar">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3 financial-field-group" data-fields="profileSecondOrganizationAmount" data-radios="secondOrganizationAmountType">
                                            <label class="form-label d-flex align-items-center gap-1">
                                                Amount Type
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Whether the second organization amount is calculated per team or per player"></i>
                                                <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="btn-group w-100" role="group">
                                                <input type="radio" class="btn-check" name="secondOrganizationAmountType" id="secondOrgPerTeam" value="perTeam" checked>
                                                <label class="btn btn-outline-secondary btn-sm" for="secondOrgPerTeam">Per Team</label>
                                                <input type="radio" class="btn-check" name="secondOrganizationAmountType" id="secondOrgPerPlayer" value="perPlayer">
                                                <label class="btn btn-outline-secondary btn-sm" for="secondOrgPerPlayer">Per Player</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3 financial-field-group" data-fields="profileSecondOrganizationAmount" data-radios="secondOrganizationAmountType">
                                            <label for="profileSecondOrganizationAmount" class="form-label d-flex align-items-center gap-1">
                                                Amount
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Fixed dollar amount allocated to the second organization per team or per player"></i>
                                                <i class="fas fa-pen financial-edit-icon ms-1" onclick="toggleFinancialFieldEdit(this)" title="Edit" style="display: none;"></i>
                                            </label>
                                            <div class="input-group">
                                                <span class="input-group-text">$</span>
                                                <input type="number" class="form-control" id="profileSecondOrganizationAmount" step="0.01" min="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="profileCombinePrizeAndNationalCheck">
                                        <label class="form-check-label" for="profileCombinePrizeAndNationalCheck">
                                            Combine prize fund and national org in one payment
                                            <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" title="When on, the Parent/National card shows a combined payment to national office (Prize Fund + National org). When off, the card shows only the national org amount."></i>
                                        </label>
                                    </div>
                                    <small class="text-muted d-block mt-1">Turn on if you send one payment to the national office that includes both prize fund and national org amounts.</small>
                                </div>
                            </div>
                            <div id="combinedPaymentPeriodContainer" class="mt-3 border-start border-2 border-info ps-3" style="display: none;">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-calendar-alt me-1"></i>Combined payment period
                                    <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" title="The card shows one payment total for the current period. Resets at the start of each period (e.g. 1st–last of month)."></i>
                                </label>
                                <div class="row mb-2">
                                    <div class="col-md-6">
                                        <label for="profileCombinedPaymentPeriodType" class="form-label small">Period</label>
                                        <select class="form-select form-select-sm" id="profileCombinedPaymentPeriodType">
                                            <option value="monthly">Monthly (e.g. 1st–last of month)</option>
                                            <option value="weekly">Weekly</option>
                                            <option value="bi-weekly">Bi-weekly (every 14 days)</option>
                                            <option value="bi-monthly">Bi-monthly (1st–15th, 16th–last)</option>
                                            <option value="quarterly">Quarterly</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6" id="profileCombinedPaymentAnchorWrapMonthly" style="display: none;">
                                        <label for="profileCombinedPaymentAnchorMonth" class="form-label small">Reset on day of month (1–28)</label>
                                        <input type="number" class="form-control form-control-sm" id="profileCombinedPaymentAnchorMonth" min="1" max="28" value="1" placeholder="1">
                                    </div>
                                    <div class="col-md-6" id="profileCombinedPaymentAnchorWrapWeekly" style="display: none;">
                                        <label for="profileCombinedPaymentAnchorWeek" class="form-label small">Week starts on</label>
                                        <select class="form-select form-select-sm" id="profileCombinedPaymentAnchorWeek">
                                            <option value="0">Sunday</option>
                                            <option value="1">Monday</option>
                                            <option value="2">Tuesday</option>
                                            <option value="3">Wednesday</option>
                                            <option value="4">Thursday</option>
                                            <option value="5">Friday</option>
                                            <option value="6">Saturday</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6" id="profileCombinedPaymentAnchorWrapBiWeekly" style="display: none;">
                                        <label for="profileCombinedPaymentAnchorDate" class="form-label small">First period start date (optional)</label>
                                        <input type="date" class="form-control form-control-sm" id="profileCombinedPaymentAnchorDate" placeholder="YYYY-MM-DD">
                                    </div>
                                </div>
                                <small class="text-muted">The national org card will show Expected/Collected for the current period only.</small>
                            </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="sanction-pane" role="tabpanel">
                                    <h6>Sanction Fee Settings</h6>
                                    <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="profileSanctionFeesEnabled" onchange="updateSanctionFeeSettings()">
                                    <label class="form-check-label" for="profileSanctionFeesEnabled">
                                        Enable Sanction Fees
                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Enable tracking and collection of sanction fees from players"></i>
                                    </label>
                                </div>
                                    </div>
                                    <div id="sanctionFeeSettingsContainer" style="display: none;">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="profileSanctionFeeName" class="form-label">
                                                        Sanction Fee Name
                                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Custom name for your sanction fee (e.g., 'Player Registration', 'Sanction Fee')"></i>
                                                    </label>
                                                    <input type="text" class="form-control" id="profileSanctionFeeName">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="profileSanctionFeeAmount" class="form-label">
                                                        Collection Amount (per player)
                                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="The amount you charge each player for sanction fees"></i>
                                                    </label>
                                                    <div class="input-group">
                                                        <span class="input-group-text">$</span>
                                                        <input type="number" class="form-control" id="profileSanctionFeeAmount" step="0.01" min="0">
                                                    </div>
                                                    <small class="text-muted">What you charge players</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="profileSanctionFeePayoutAmount" class="form-label">
                                                Payout Amount (per player)
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="The amount you pay out to the sanctioning organization for each player"></i>
                                            </label>
                                            <div class="input-group">
                                                <span class="input-group-text">$</span>
                                                <input type="number" class="form-control" id="profileSanctionFeePayoutAmount" step="0.01" min="0">
                                            </div>
                                            <small class="text-muted">What you pay out for each sanction</small>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label fw-bold">
                                                <i class="fas fa-calendar me-1"></i>Default Sanction Period
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Default start and end dates for sanctions. These will be used when marking players as sanctioned unless custom dates are set."></i>
                                            </label>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label for="profileSanctionStartDate" class="form-label small">Start Date</label>
                                                    <input type="date" class="form-control" id="profileSanctionStartDate">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="profileSanctionEndDate" class="form-label small">End Date</label>
                                                    <input type="date" class="form-control" id="profileSanctionEndDate">
                                                </div>
                                            </div>
                                            <small class="text-muted">These dates will be used as defaults when marking players as sanctioned. Individual player dates can be customized in the player editor.</small>
                                        </div>
                                    </div>
                                    <hr class="my-4">
                                    <h6>Green Fee Settings</h6>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="profileGreenFeesEnabled" onchange="updateGreenFeeSettings()">
                                            <label class="form-check-label" for="profileGreenFeesEnabled">
                                                Enable Green Fees
                                                <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Enable tracking of green/table/room fees charged per team per week"></i>
                                            </label>
                                        </div>
                                    </div>
                                    <div id="greenFeeSettingsContainer" style="display: none;">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="profileGreenFeeName" class="form-label">
                                                        Green Fee Name
                                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Custom name (e.g. 'Green Fee', 'Table Fee', 'Room Fee')"></i>
                                                    </label>
                                                    <input type="text" class="form-control" id="profileGreenFeeName">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="profileGreenFeeAmount" class="form-label">
                                                        Collection Amount (per team per week)
                                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="The amount you charge each team per week for table/room fees"></i>
                                                    </label>
                                                    <div class="input-group">
                                                        <span class="input-group-text">$</span>
                                                        <input type="number" class="form-control" id="profileGreenFeeAmount" step="0.01" min="0">
                                                    </div>
                                                    <small class="text-muted">What you charge teams</small>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="profileGreenFeePayoutAmount" class="form-label">
                                                        Payout Amount (per team per week)
                                                        <i class="fas fa-info-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="The amount you pay out to the venue for each team per week"></i>
                                                    </label>
                                                    <div class="input-group">
                                                        <span class="input-group-text">$</span>
                                                        <input type="number" class="form-control" id="profileGreenFeePayoutAmount" step="0.01" min="0">
                                                    </div>
                                                    <small class="text-muted">What you pay to the venue</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        </div>
                        <div class="tab-pane fade" id="subscription-pane" role="tabpanel">
                            <div id="subscriptionInfo">
                                <div class="text-center py-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="text-muted mt-3">Loading subscription information...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Error/Success Messages -->
                    <div class="px-4 pb-3">
                        <div id="profileError" class="alert alert-danger hidden" role="alert"></div>
                        <div id="profileSuccess" class="alert alert-success hidden" role="alert">
                            <i class="fas fa-check-circle me-2"></i>Profile updated successfully!
                        </div>
                    </div>
                </div>
                <div class="modal-footer profile-modal-footer">
                    <button type="button" class="btn profile-modal-cancel" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancel
                    </button>
                    <button type="button" id="saveProfileButton" class="btn profile-modal-update">
                        <i class="fas fa-save me-2"></i>Update
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div class="modal fade" id="alertModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" id="alertModalHeader">
                    <h5 class="modal-title" id="alertModalTitle">Notice</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="alertModalMessage"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Local Storage Settings Modal -->
    <div class="modal fade" id="localStorageSettingsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title"><i class="fas fa-database me-2"></i>Local Storage Settings</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="localStorageStatusText" class="mb-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Shows whether Duezy can store data on this device for faster loading and offline fallback."></p>
                    <small class="text-muted d-block mb-3">Duezy stores cached data on this device for faster loading. The cloud database remains your backup.</small>
                    <p id="localStorageLastSyncText" class="small text-muted mb-0" data-bs-toggle="tooltip" data-bs-placement="top" title="Timestamp of the last local snapshot saved on this device."></p>
                </div>
                <div class="modal-footer d-flex flex-wrap gap-2 justify-content-between">
                    <button type="button" id="localStorageDenyBtn" class="btn btn-outline-secondary" data-bs-toggle="tooltip" data-bs-placement="top" title="Turns off local device caching. Duezy will rely on live cloud database fetches.">Disable Local Storage</button>
                    <div class="d-flex gap-2">
                        <button type="button" id="localStorageClearBtn" class="btn btn-outline-warning" data-bs-toggle="tooltip" data-bs-placement="top" title="Deletes only Duezy local cache and snapshots on this device. Does not delete cloud data.">Clear Local Cache</button>
                        <button type="button" id="localStorageAllowBtn" class="btn btn-success" data-bs-toggle="tooltip" data-bs-placement="top" title="Enables local device caching for faster loads and offline fallback while keeping the cloud database as backup.">Enable Local Storage</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Division Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white" id="deleteConfirmModalHeader">
                    <h5 class="modal-title" id="deleteConfirmModalTitle">
                        <i class="fas fa-exclamation-triangle me-2"></i>Confirm Deletion
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="deleteConfirmMessage"></p>
                </div>
                <div class="modal-footer" id="deleteConfirmModalFooter">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                        <i class="fas fa-trash-alt me-2"></i>Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Archive Division Modal -->
    <div class="modal fade" id="archiveDivisionModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title">
                        <i class="fas fa-archive me-2"></i>Archive Division
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">Choose how to archive <strong id="archiveDivisionName"></strong>:</p>
                    <div class="d-grid gap-2">
                        <button type="button" class="btn btn-outline-secondary" id="archiveDivisionOnlyBtn">
                            <i class="fas fa-folder me-2"></i>Archive division settings only
                            <small class="d-block text-muted mt-1">Keeps teams active; they will appear under "All Teams" until reassigned</small>
                        </button>
                        <button type="button" class="btn btn-outline-warning" id="archiveDivisionAndTeamsBtn">
                            <i class="fas fa-archive me-2"></i>Archive division and all <span id="archiveDivisionTeamCount">0</span> teams
                            <small class="d-block text-muted mt-1">Hides the division and all its teams; you can restore teams later from Archived</small>
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Restore Team Modal -->
    <div class="modal fade" id="restoreTeamModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="restoreTeamModalTitle">
                        <i class="fas fa-undo me-2"></i>Restore Team
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">Select a division to restore <strong id="restoreTeamName"></strong> to:</p>
                    <div id="restoreTeamNoDivisions" style="display: none;">
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>No divisions available.</strong> Please create a division first before restoring this team.
                        </div>
                    </div>
                    <div id="restoreTeamDivisionSelect">
                        <label for="restoreTeamDivision" class="form-label">Division:</label>
                        <select class="form-select" id="restoreTeamDivision">
                            <option value="">Select Division</option>
                        </select>
                        <small class="text-muted">The team will be restored to the selected division.</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="confirmRestoreTeamBtn" disabled>
                        <i class="fas fa-undo me-2"></i>Restore Team
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Permanent Delete Confirmation Modal -->
    <div class="modal fade" id="permanentDeleteConfirmModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="permanentDeleteModalTitle">
                        <i class="fas fa-exclamation-triangle me-2"></i>Permanently Delete Team
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="permanentDeleteStep1">
                        <p class="fw-bold mb-3">⚠️ WARNING: This will permanently delete the team and ALL associated data including:</p>
                        <ul class="mb-3">
                            <li>Payment history</li>
                            <li>Team members</li>
                            <li>All records</li>
                        </ul>
                        <p class="text-danger fw-bold mb-0">This action CANNOT be undone!</p>
                        <p class="mt-3 mb-0">Are you absolutely sure you want to permanently delete <strong id="permanentDeleteTeamName1"></strong>?</p>
                    </div>
                    <div id="permanentDeleteStep2" style="display: none;">
                        <p class="fw-bold text-danger mb-3">FINAL CONFIRMATION</p>
                        <p class="mb-3">You are about to <strong class="text-danger">PERMANENTLY DELETE</strong> <strong id="permanentDeleteTeamName2"></strong>.</p>
                        <p class="text-danger fw-bold mb-0">This is your last chance to cancel.</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="permanentDeleteCancelBtn" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="permanentDeleteConfirmBtn">
                        <i class="fas fa-trash-alt me-2"></i>Yes, Delete Permanently
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Sentry: errors-only bundle. Set SENTRY_DSN in backend; use same or separate browser DSN for frontend. -->
    <script src="https://browser.sentry-cdn.com/10.36.0/bundle.min.js" crossorigin="anonymous" integrity="sha384-XIQXPJ7bTGrgI7ICq0EPuubhgORPN8rAwpnVNfG0sT5Anm93JVz/Z1poTFNjp5lD"></script>
    <script src="dues-utils.js"></script>
    <script src="modules/getSanctionPaidSet.js"></script>
    <script src="modules/combinedPaymentPeriod.js"></script>
    <script src="dues-divisions.js"></script>
    <script src="dues-financial.js"></script>    <script src="dues-players.js"></script>    <script src="modals/addteam.js"></script>    <script src="modals/weeklypayment.js"></script>    <script src="modals/payment.js"></script>    <script src="modals/help.js"></script>
    <script src="modals/feedback.js"></script>
    <script src="modals/donate.js"></script>
    <script src="modals/alert.js"></script>
    <script src="modals/export.js"></script>
    <script src="modals/fargoinstructions.js"></script>
    <script src="modals/fargoinstructionsmodalwithcallback.js"></script>
    <script src="modals/permanentdeleteconfirm.js"></script>
    <script src="modals/archivedteams.js"></script>
    <script src="modals/restoreteam.js"></script>
    <script src="modals/smartbuilder.js"></script>
    <script src="modals/profile.js"></script>
    <script src="modules/createteamsanddivision.js"></script>
    <script src="modules/formatusage.js"></script>
    <script src="modules/combinedPaymentPeriodUI.js"></script>
    <script src="modules/switchprofilesettingstab.js"></script>
    <script src="modules/updateappbranding.js"></script>
    <script src="modules/saveprofile.js"></script>
    <script src="modules/carddetailmodals.js"></script>
    <script src="modules/calculateanddisplaysmartsummary.js?v=24h-rule-v2-20260210"></script>
    <script src="modules/initializemodaltooltips.js"></script>
    <script src="modules/draggablemodals.js"></script>
    <script src="modules/fetchselecteddivisionteams.js"></script>
    <script src="modules/estimatevisualwidth.js"></script>
    <script src="modules/initializeclock.js"></script>
    <script src="modules/updatedivisionstats.js"></script>
    <script src="modules/findavailableplansdiv.js"></script>
    <script src="modules/fetchfargodivisions.js"></script>
    <script src="modules/showpreviewsection.js"></script>
    <script src="modules/smartbuildersummary.js"></script>
    <script src="modules/updateteam.js"></script>
    <script src="modules/billinghandler.js"></script>
    <script src="modules/updatedivisionspecificsummary.js"></script>
    <script src="modules/saveweeklypayment.js"></script>
    <script src="modules/showpaymenthistory.js"></script>
    <script src="modules/loadavailableplans.js"></script>
    <script src="modules/logout.js"></script>
    <script src="modules/updatelocalclock.js"></script>
    <script src="modules/editteam.js"></script>
    <script src="modules/processoauthsession.js"></script>
    <script src="modules/updateselectedcount.js"></script>
    <script src="modules/downloadbackup.js"></script>
    <script src="modules/filterteamsbydivisionwithsort.js"></script>
    <script src="modules/sorttable.js"></script>
    <script src="modules/verifyresettoken.js"></script>
    <script src="modules/addteam.js"></script>
    <script src="modules/populateweeklypaymentamountdropdown.js"></script>
    <script src="modules/handleoauthcallback.js"></script>
    <script src="modules/createdivisionfrommanualbuilder.js"></script>
    <script src="modules/cleansubscriptioncontentfromothertabs.js"></script>
    <script src="modules/archiveteam.js"></script>
    <script src="modules/checkandhandleoauth.js"></script>
    <script src="modules/executeexport.js"></script>
    <script src="modules/editcaptain.js"></script>
    <script src="modules/togglesanctionfeeui.js"></script>
    <script src="modules/togglegreenfeeui.js"></script>
    <script src="modules/renderarchivedteamstable.js"></script>
    <script src="modules/checkforduplicateplayers.js"></script>
    <script src="modules/syncplanpricesfrombillingtoggle.js"></script>
    <script src="modules/filterteamsbydivision.js"></script>
    <script src="modules/showupdatepreview.js"></script>
    <script src="modules/updatesanctionfeelabels.js"></script>
    <script src="modules/updategreenfeelabels.js"></script>
    <script src="modules/updategreenfeesettings.js"></script>
    <script src="modules/populatebcasanctionplayers.js"></script>
    <script src="modules/loadteams.js"></script>
    <script src="modules/signinwithgoogle.js"></script>
    <script src="modules/loadplanswhenready.js"></script>
    <script src="modules/updatetrialstatusintabs.js"></script>
    <script src="modules/recordpayment.js"></script>
    <script src="modules/removeteamfromdivision.js"></script>
    <script src="modules/updaterequirement.js"></script>
    <script src="modules/displayteamsinpreview.js"></script>
    <script src="modules/executerestoreteam.js"></script>
    <script src="modules/updatedivisiondropdown.js"></script>
    <script src="modules/checksimilarnames.js"></script>
    <script src="modules/checkbulksimilarnames.js"></script>
    <script src="modules/handlenameinputblur.js"></script>
    <script src="modules/addteammember.js"></script>
    <script src="modules/showdivisionsettingssection.js"></script>
    <script src="modules/updatesanctionfeesettings.js"></script>
    <script src="modules/populateindividualplayerpayments.js"></script>
    <script src="modules/validatepaymentamount.js"></script>
    <script src="modules/getmatchesperweekconfig.js"></script>
    <script src="modules/settheme.js"></script>
    <script src="modules/deleteteam.js"></script>
    <script src="modules/loaddata.js"></script>
    <script src="modules/exporttopdf.js"></script>
    <script src="modules/getdivisioncolor.js"></script>
    <script src="modules/projectionfilters.js"></script>
    <script src="modules/getPlayDateForWeek.js?v=24h-rule-v2-20260210"></script>
    <script src="modules/daterangereport.js"></script>
    <script src="modules/displayteams.js"></script>
    <script src="modules/updatefinancialbreakdownsettings.js"></script>
    <script src="modules/financialfieldslock.js"></script>
    <script src="modules/divisionfinancialfieldslock.js"></script>
    <script src="modules/getbcastatusdisplay.js"></script>
    <script src="modules/updatepaginationui.js"></script>
    <script src="app.js"></script>
</body>
</html>
