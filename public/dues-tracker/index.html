<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USA Pool League - Dues Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .login-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .main-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .card {
            border: none;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.12);
        }
        .btn {
            border-radius: 12px;
            font-weight: 600;
            padding: 10px 20px;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            border: none;
        }
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(86, 171, 47, 0.4);
        }
        .btn-danger {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            border: none;
        }
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 65, 108, 0.4);
        }
        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border: none;
        }
        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        }
        .status-paid {
            color: #28a745;
            font-weight: bold;
        }
        .status-unpaid {
            color: #dc3545;
            font-weight: bold;
        }
        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
        }
        .summary-card h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
        }
        .summary-card h5 {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }
        .table {
            border-radius: 15px;
            overflow: hidden;
        }
        .table thead th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-weight: 600;
            padding: 15px 12px;
        }
        .table tbody td {
            padding: 15px 12px;
            vertical-align: middle;
            border-color: #f1f3f4;
        }
        
        /* BCA Status Styling */
        .bca-status-container {
            min-width: 120px;
        }
        
        .bca-status-container .btn-group {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .bca-status-container .btn-check:checked + .btn {
            box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.25);
        }
        
        .bca-status-container .btn-check:checked + .btn-outline-warning {
            background-color: #ffc107;
            border-color: #ffc107;
            color: #000;
        }
        
        .bca-status-container .btn-check:checked + .btn-outline-success {
            background-color: #198754;
            border-color: #198754;
            color: #fff;
        }
        
        .bca-status-container .btn-check:checked + .btn-outline-info {
            background-color: #0dcaf0;
            border-color: #0dcaf0;
            color: #000;
        }
        .table tbody tr:hover {
            background-color: #f8f9ff;
        }
        .badge {
            border-radius: 8px;
            font-weight: 500;
            padding: 6px 12px;
        }
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 10px 15px;
            transition: all 0.3s ease;
        }
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .navbar {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%) !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .navbar-brand {
            font-weight: 700;
            font-size: 1.4rem;
        }
        .member-card {
            transition: transform 0.2s;
        }
        .member-card:hover {
            transform: translateY(-5px);
        }
        .hidden {
            display: none !important;
        }
        .container-fluid {
            max-width: 2500px !important;
            width: 100% !important;
        }
        
        /* Force wider layout */
        body .container-fluid {
            max-width: 2500px !important;
        }
        
        /* Target the specific container in the main app */
        #mainApp .container-fluid {
            max-width: 2500px !important;
            width: 100% !important;
        }
        
        /* Nuclear option - override everything */
        .main-container .container-fluid {
            max-width: 2500px !important;
            width: 100% !important;
        }
        
        /* Override global CSS constraints */
        #mainApp {
            max-width: none !important;
            width: 100vw !important;
        }
        
        .main-container {
            max-width: none !important;
            width: 100vw !important;
        }
        
        /* Override the global max-width unset rule */
        .main-container * {
            max-width: unset !important;
        }
        
        .main-container .container-fluid {
            max-width: 3500px !important;
        }
        
        /* Ensure action buttons don't get cut off */
        .table-responsive {
            overflow-x: auto;
        }
        
        /* Make sure action column has enough space */
        .table th:last-child, .table td:last-child {
            min-width: 120px;
            white-space: nowrap;
        }
        
        /* Make Division column narrower */
        .table th:nth-child(2), .table td:nth-child(2) { 
            width: 15%; /* Reduced from default */
            max-width: 15%;
        }
        
        /* Division color buttons */
        .division-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }
        
        /* Division color schemes */
        .division-nay-nay { background: #e91e63; color: white; }
        .division-3310 { background: #2196f3; color: white; }
        .division-tuesday { background: #4caf50; color: white; }
        .division-wednesday { background: #ff9800; color: white; }
        .division-thursday { background: #9c27b0; color: white; }
        .division-friday { background: #f44336; color: white; }
        .division-saturday { background: #00bcd4; color: white; }
        .division-sunday { background: #795548; color: white; }
        .division-default { background: #607d8b; color: white; }
        
        /* Make players modal wider */
        #playersModal .modal-dialog {
            max-width: 95vw;
            width: 95vw;
        }
        
        @media (min-width: 1200px) {
            #playersModal .modal-dialog {
                max-width: 90vw;
                width: 90vw;
            }
        }
        .card-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 2px solid #dee2e6;
            font-weight: 600;
        }
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.875rem;
        }
        .btn-group .btn {
            border-radius: 0;
        }
        .btn-group .btn:first-child {
            border-top-left-radius: 8px;
            border-bottom-left-radius: 8px;
        }
        .btn-group .btn:last-child {
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
        }
        .form-select {
            position: relative;
        }
        .form-select:focus {
            z-index: 3;
        }
        /* Force select dropdown to open downward */
        select.form-select {
            background-position: right 0.75rem center !important;
        }
        /* Override any Bootstrap dropdown positioning */
        .dropdown-menu {
            transform: none !important;
            top: 100% !important;
            bottom: auto !important;
        }
        /* Ensure select elements open downward */
        select {
            direction: ltr;
        }
        
        /* Fix modal positioning to center on viewport */
        .modal {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            z-index: 1055 !important;
            display: none !important;
        }
        
        .modal.show {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        .modal-dialog {
            position: relative !important;
            width: auto !important;
            margin: 0 !important;
            pointer-events: none !important;
        }
        
        .modal-content {
            position: relative !important;
            display: flex !important;
            flex-direction: column !important;
            width: 100% !important;
            pointer-events: auto !important;
            background-color: #fff !important;
            background-clip: padding-box !important;
            border: 1px solid rgba(0,0,0,.2) !important;
            border-radius: 0.3rem !important;
            outline: 0 !important;
        }
        
        .modal-backdrop {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            z-index: 1050 !important;
            width: 100vw !important;
            height: 100vh !important;
            background-color: #000 !important;
        }
        
        /* Modal size overrides with proper centering */
        .modal-dialog:not(.modal-lg):not(.modal-xl) {
            max-width: 500px !important;
        }
        
        .modal-dialog.modal-lg {
            max-width: 800px !important;
        }
        
        /* Specific override for weekly payment modal */
        #weeklyPaymentModal .modal-dialog {
            max-width: 800px !important;
            width: 800px !important;
        }
        
        /* Even more specific override */
        .modal#weeklyPaymentModal .modal-dialog.modal-lg {
            max-width: 800px !important;
            width: 800px !important;
        }
        
        .modal-dialog.modal-xl {
            max-width: 1140px !important;
        }
        
        /* Ensure all modals are centered regardless of size */
        .modal.show .modal-dialog {
            transform: none !important;
            margin: 0 !important;
            max-height: calc(100vh - 2rem) !important;
            overflow-y: auto !important;
        }
        
        /* Compact payment history table */
        #paymentHistoryModal .table td {
            padding: 0.25rem 0.5rem !important;
            vertical-align: middle !important;
        }
        
        #paymentHistoryModal .table th {
            padding: 0.5rem !important;
            font-size: 0.875rem !important;
        }
        
        #paymentHistoryModal .badge-sm {
            font-size: 0.75rem !important;
            padding: 0.25rem 0.5rem !important;
        }
        /* Force weekly payment modal to be wider - highest priority */
        #weeklyPaymentModal .modal-dialog {
            max-width: 1000px !important;
            width: 1000px !important;
        }
        
        /* Payment History Modal - same as weekly payment modal */
        #paymentHistoryModal .modal-dialog {
            max-width: 100px !important;
            width: 100px !important;
        }
        
        .modal#paymentHistoryModal .modal-dialog.modal-lg {
            max-width: 1000px !important;
            width: 1000px !important;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container d-flex align-items-center justify-content-center hidden">
        <div class="card p-4" style="width: 400px;">
            <div class="text-center mb-4">
                <i class="fas fa-pool fa-3x text-primary mb-3"></i>
                <h2>USA Pool League</h2>
                <p class="text-muted">Dues Tracker</p>
            </div>
            <form id="loginForm">
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-sign-in-alt me-2"></i>Login
                </button>
            </form>
            <div id="loginError" class="alert alert-danger mt-3 hidden" role="alert"></div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-container">
        <!-- Navigation -->
        <nav class="navbar navbar-dark bg-dark">
            <div class="container-fluid">
                <span class="navbar-brand mb-0 h1">
                    <i class="fas fa-pool me-2"></i>USA Pool League - Dues Tracker
                </span>
                <button class="btn btn-outline-light" onclick="logout()">
                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                </button>
            </div>
        </nav>

        <div class="container-fluid px-4 pt-2 pb-4">
            <!-- Summary Cards -->
            <div class="row mb-2">
                <div class="col-md-4">
                    <div class="card summary-card text-center p-2">
                        <h6 class="mb-1">Total Teams</h6>
                        <h4 id="totalTeams">0</h4>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-danger text-white text-center p-2">
                        <h6 class="mb-1">Teams Behind</h6>
                        <h4 id="unpaidTeams">0</h4>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-info text-white text-center p-2">
                        <h6 class="mb-1">Total League Dues Collected</h6>
                        <h4 id="totalCollected">$0</h4>
                    </div>
                </div>
            </div>
            
            <!-- Division Specific Summary (shown when division is selected) -->
            <div class="row mb-2" id="divisionSpecificSummary" style="display: none;">
                <div class="col-md-12">
                    <div class="card bg-primary text-white text-center p-2">
                        <h6 class="mb-1" id="divisionSpecificTitle">Division Summary</h6>
                        <h4 id="divisionSpecificCollected">$0</h4>
                        <small id="divisionSpecificSubtitle">Total collected for this division</small>
                    </div>
                </div>
            </div>
            
            <!-- Financial Breakdown -->
            <div class="row mb-2">
                <div class="col-md-3">
                    <div class="card bg-warning text-dark text-center p-2">
                        <h6 class="mb-1"><i class="fas fa-trophy me-1"></i>Total Prize Fund</h6>
                        <h5 id="totalPrizeFund">$0</h5>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-success text-white text-center p-2">
                        <h6 class="mb-1"><i class="fas fa-user-tie me-1"></i>League Income</h6>
                        <h5 id="totalLeagueManager">$0</h5>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-info text-white text-center p-2">
                        <h6 class="mb-1"><i class="fas fa-flag me-1"></i>CSI</h6>
                        <h5 id="totalUSAPoolLeague">$0</h5>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-secondary text-white text-center p-2">
                        <h6 class="mb-1"><i class="fas fa-certificate me-1"></i>BCA Sanction Fees</h6>
                        <h5 id="totalBCASanctionFees">$0</h5>
                        <small>$25 per player per year</small>
                    </div>
                </div>
            </div>
            
            <!-- Division Breakdown -->


            <!-- Horizontal Controls Bar -->
            <div class="row mb-3">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body py-3">
                            <div class="row align-items-center">
                                <div class="col-md-3">
                                    <label for="divisionFilter" class="form-label fw-bold mb-1">
                                        <i class="fas fa-filter me-1"></i>Division
                                    </label>
                                    <select class="form-select form-select-sm" id="divisionFilter" onchange="filterTeamsByDivision()">
                                        <option value="all">All Teams</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="weekFilter" class="form-label fw-bold mb-1">
                                        <i class="fas fa-calendar-week me-1"></i>Week
                                    </label>
                                    <select class="form-select form-select-sm" id="weekFilter" onchange="updateWeekDisplay()">
                                        <option value="1">Week 1</option>
                                        <option value="2">Week 2</option>
                                        <option value="3">Week 3</option>
                                        <option value="4">Week 4</option>
                                        <option value="5">Week 5</option>
                                        <option value="6">Week 6</option>
                                        <option value="7">Week 7</option>
                                        <option value="8">Week 8</option>
                                        <option value="9">Week 9</option>
                                        <option value="10">Week 10</option>
                                        <option value="11">Week 11</option>
                                        <option value="12">Week 12</option>
                                        <option value="13">Week 13</option>
                                        <option value="14">Week 14</option>
                                        <option value="15">Week 15</option>
                                        <option value="16">Week 16</option>
                                        <option value="17">Week 17</option>
                                        <option value="18">Week 18</option>
                                        <option value="19">Week 19</option>
                                        <option value="20">Week 20</option>
                                        <option value="21">Week 21</option>
                                        <option value="22">Week 22</option>
                                        <option value="23">Week 23</option>
                                        <option value="24">Week 24</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-bold mb-1">
                                        <i class="fas fa-tools me-1"></i>Actions
                                    </label>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-primary btn-sm" onclick="showAddTeamModal()">
                                            <i class="fas fa-plus me-1"></i>Add Team
                                        </button>
                                        <button class="btn btn-success btn-sm" onclick="showSmartBuilderModal()">
                                            <i class="fas fa-magic me-1"></i>Smart Builder
                                        </button>
                                        <button class="btn btn-info btn-sm" onclick="showDivisionManagement()">
                                            <i class="fas fa-cogs me-1"></i>Divisions
                                        </button>
                                        <button class="btn btn-warning btn-sm" onclick="showPlayersView()">
                                            <i class="fas fa-users me-1"></i>Players
                                        </button>
                                        <button class="btn btn-success btn-sm" onclick="refreshData()">
                                            <i class="fas fa-sync-alt me-1"></i>Refresh
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Teams List -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-users me-2"></i>League Teams</h5>
                            <span class="badge bg-primary fs-6" id="teamCount">0 Teams</span>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Team Name</th>
                                            <th>Division</th>
                                            <th>Captain</th>
                                            <th>Players</th>
                                            <th>BCA Status</th>
                                            <th>Dues Amount</th>
                                            <th>Status</th>
                                            <th>Payment Date</th>
                                            <th>Week <span id="currentWeekDisplay">1</span> Payment</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="teamsTable">
                                        <!-- Teams will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Team Modal -->
    <div class="modal fade" id="addTeamModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Team</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addTeamForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="teamName" class="form-label">Team Name *</label>
                                    <input type="text" class="form-control" id="teamName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="division" class="form-label">Division *</label>
                                    <select class="form-select" id="division" required onchange="updateDuesCalculation()">
                                        <option value="">Select Division</option>
                                        <!-- Divisions will be loaded dynamically -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <h6 class="mt-3">Team Captain</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="captainName" class="form-label">Captain Name *</label>
                                    <select class="form-select" id="captainName" required>
                                        <option value="">Select Captain</option>
                                        <!-- Team members will be populated dynamically -->
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="captainEmail" class="form-label">Captain Email</label>
                                    <input type="email" class="form-control" id="captainEmail">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="captainPhone" class="form-label">Captain Phone</label>
                            <input type="tel" class="form-control" id="captainPhone">
                        </div>
                        
                        <h6 class="mt-3">Team Members</h6>
                        <div class="alert alert-info">
                            <small><i class="fas fa-info-circle me-1"></i><strong>Dues Calculation:</strong> Division rate per player per match × number of teams × total weeks = total dues per player for the season</small>
                        </div>
                        <div id="teamMembersContainer">
                            <div class="row mb-2 member-row">
                                <div class="col-md-3">
                                    <input type="text" class="form-control" placeholder="Player name" name="memberName" oninput="updateDuesCalculation()">
                                </div>
                                <div class="col-md-3">
                                    <input type="email" class="form-control" placeholder="Email (optional)" name="memberEmail">
                                </div>
                                <div class="col-md-3">
                                    <div class="bca-status-container">
                                        <label class="form-label small text-muted mb-1">BCA Status</label>
                                        <div class="btn-group w-100" role="group">
                                            <input type="radio" class="btn-check" name="bcaSanctionPaid" id="bcaPending" value="false" checked>
                                            <label class="btn btn-outline-warning btn-sm" for="bcaPending">
                                                <i class="fas fa-clock"></i> Pending
                                            </label>
                                            
                                            <input type="radio" class="btn-check" name="bcaSanctionPaid" id="bcaPaid" value="true">
                                            <label class="btn btn-outline-success btn-sm" for="bcaPaid">
                                                <i class="fas fa-check"></i> Paid
                                            </label>
                                            
                                            <input type="radio" class="btn-check" name="bcaSanctionPaid" id="bcaPreviously" value="previously">
                                            <label class="btn btn-outline-info btn-sm" for="bcaPreviously">
                                                <i class="fas fa-history"></i> Previously
                                            </label>
                                        </div>
                                        <small class="text-muted">Pending/Paid = $25 fee | Previously = Already sanctioned</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeMember(this)">
                                        <i class="fas fa-trash"></i> Remove
                                    </button>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="addTeamMember()">
                            <i class="fas fa-plus me-1"></i>Add Member
                        </button>
                        <div id="duesCalculation" class="mt-2">
                            <small class="text-muted">Total dues will be calculated automatically based on number of players</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addTeam()">Add Team</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Smart Builder Modal -->
    <div class="modal fade" id="smartBuilderModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-magic me-2"></i>Smart Team & Division Builder
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Step 1: Data Source Selection -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-database me-2"></i>Step 1: Choose Data Source
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="dataSource" id="fargoRate" value="fargo" checked>
                                                <label class="form-check-label" for="fargoRate">
                                                    <strong>Fargo Rate Public Reports</strong>
                                                    <br><small class="text-muted">Import teams and divisions from Fargo Rate standings</small>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="dataSource" id="manualEntry" value="manual">
                                                <label class="form-check-label" for="manualEntry">
                                                    <strong>Manual Entry</strong>
                                                    <br><small class="text-muted">Create teams and divisions manually</small>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 1.5: Update Mode Selection -->
                    <div class="row mb-4" id="updateModeSection">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-cogs me-2"></i>Step 1.5: Choose Update Mode
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="updateMode" id="createNew" value="create" checked>
                                                <label class="form-check-label" for="createNew">
                                                    <strong>Create New Division</strong>
                                                    <br><small class="text-muted">Create a new division with teams</small>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="updateMode" id="updateExisting" value="update">
                                                <label class="form-check-label" for="updateExisting">
                                                    <strong>Update Existing Division</strong>
                                                    <br><small class="text-muted">Complete roster data for existing division</small>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Fargo Rate Configuration -->
                    <div id="fargoConfig" class="row mb-4">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-cog me-2"></i>Step 2: Fargo Rate Configuration
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-12">
                                            <label for="fargoLeagueUrl" class="form-label">Fargo Rate League Reports URL</label>
                                            <input type="url" class="form-control" id="fargoLeagueUrl" placeholder="https://lms.fargorate.com/PublicReport/LeagueReports?leagueId=...">
                                            <small class="form-text text-muted">
                                                Copy the URL from your Fargo Rate league reports page (any division URL will work). 
                                                <br><strong>Example:</strong> https://lms.fargorate.com/PublicReport/LeagueReports?leagueId=e05896bb-b0f4-4a80-bf99-b2ca012ceaaa&divisionId=b345a437-3415-4765-b19a-b2f7014f2cfa
                                            </small>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-12">
                                            <button class="btn btn-primary" onclick="fetchFargoDivisions()">
                                                <i class="fas fa-list me-2"></i>Fetch Available Divisions
                                            </button>
                                            <div id="fargoLoading" class="spinner-border spinner-border-sm ms-2 d-none" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2.5: Division Selection -->
                    <div id="divisionSelectionSection" class="row mb-4" style="display: none;">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-trophy me-2"></i>Step 2.5: Select Division
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-12">
                                            <label for="selectedDivision" class="form-label">Choose Division to Import</label>
                                            <select class="form-select" id="selectedDivision" onchange="onDivisionSelected()">
                                                <option value="">Select a division...</option>
                                            </select>
                                            <small class="form-text text-muted">
                                                Select the division you want to import teams from.
                                            </small>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-12">
                                            <button class="btn btn-success" onclick="fetchSelectedDivisionTeams()" id="fetchTeamsBtn" disabled>
                                                <i class="fas fa-download me-2"></i>Fetch Teams for Selected Division
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2.6: Fargo Rate Teams Preview -->
                    <div id="fargoTeamsSection" class="row mb-4" style="display: none;">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-eye me-2"></i>Step 2.6: Fargo Rate Teams Found
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Team Name</th>
                                                    <th>Captain</th>
                                                    <th>Players</th>
                                                    <th>Total Players</th>
                                                </tr>
                                            </thead>
                                            <tbody id="fargoTeamsPreview">
                                                <!-- Fargo Rate teams will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-12">
                                            <button class="btn btn-primary" onclick="showDivisionSelection()">
                                                <i class="fas fa-arrow-right me-2"></i>Continue to Division Selection
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2.7: Existing Division Selection -->
                    <div id="existingDivisionSection" class="row mb-4" style="display: none;">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-search me-2"></i>Step 2.7: Select Division to Update
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-12">
                                            <label for="existingDivisionSelect" class="form-label">Choose Division to Update</label>
                                            <select class="form-select" id="existingDivisionSelect">
                                                <option value="">Loading existing divisions...</option>
                                            </select>
                                            <small class="form-text text-muted">
                                                Select the division you want to update with the Fargo Rate roster data.
                                            </small>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <button class="btn btn-primary" onclick="loadExistingDivisionTeams()">
                                                <i class="fas fa-sync me-2"></i>Load Division Teams
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2.8: Merge Confirmation -->
                    <div id="mergeConfirmationSection" class="row mb-4" style="display: none;">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-exchange-alt me-2"></i>Step 2.8: Confirm Team Merge
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Action</th>
                                                    <th>Fargo Rate Team</th>
                                                    <th>Existing Team</th>
                                                    <th>Players to Add</th>
                                                </tr>
                                            </thead>
                                            <tbody id="mergePreviewTable">
                                                <!-- Merge preview will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-12">
                                            <button class="btn btn-success" onclick="executeMerge()">
                                                <i class="fas fa-check me-2"></i>Confirm Merge
                                            </button>
                                            <button class="btn btn-secondary ms-2" onclick="cancelMerge()">
                                                <i class="fas fa-times me-2"></i>Cancel
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Preview and Configure -->
                    <div id="previewSection" class="row mb-4" style="display: none;">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-eye me-2"></i>Step 3: Preview & Configure Teams
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="divisionName" class="form-label">Division Name</label>
                                            <input type="text" class="form-control" id="divisionName" placeholder="Enter division name">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="duesPerPlayer" class="form-label">Dues Per Player ($)</label>
                                            <input type="number" class="form-control" id="duesPerPlayer" value="80" min="0" step="5">
                                        </div>
                                    </div>
                                    
                                    <div class="table-responsive">
                                        <table class="table table-sm table-striped">
                                            <thead>
                                                <tr>
                                                    <th>
                                                        <input type="checkbox" id="selectAllTeams" onchange="toggleAllTeams()">
                                                    </th>
                                                    <th>Team Name</th>
                                                    <th>Captain</th>
                                                    <th>Players</th>
                                                    <th>Dues Amount</th>
                                                </tr>
                                            </thead>
                                            <tbody id="teamsPreview">
                                                <!-- Teams will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Create -->
                    <div id="createSection" class="row mb-4" style="display: none;">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-rocket me-2"></i>Step 4: Create Teams & Division
                            </h6>
                            <div class="card">
                                <div class="card-body">
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Ready to create <span id="selectedTeamsCount">0</span> teams in the division "<span id="selectedDivisionName">-</span>"
                                    </div>
                                    <button class="btn btn-success btn-lg" onclick="createTeamsAndDivision()">
                                        <i class="fas fa-magic me-2"></i>Create Teams & Division
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal fade" id="paymentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Record Payment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="paymentForm">
                        <div class="mb-3">
                            <label for="paymentMethod" class="form-label">Payment Method</label>
                            <select class="form-select" id="paymentMethod">
                                <option value="Cash">Cash</option>
                                <option value="Check">Check</option>
                                <option value="Venmo">Venmo</option>
                                <option value="CashApp">CashApp</option>
                                <option value="PayPal">PayPal</option>
                                <option value="Zelle">Zelle</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="paymentAmount" class="form-label">Payment Amount</label>
                            <select class="form-select" id="paymentAmount" onchange="updatePaymentAmount()">
                                <option value="">Select Amount</option>
                                <!-- Options will be populated dynamically -->
                            </select>
                            <small class="text-muted">Select multiple weeks to pay at once</small>
                        </div>
                        <div class="mb-3">
                            <label for="paymentNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="paymentNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="recordPayment()">Record Payment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Weekly Payment Modal -->
    <div class="modal fade" id="weeklyPaymentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Weekly Payment - <span id="weeklyPaymentTeamName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Success Message -->
                    <div id="weeklyPaymentSuccess" class="alert alert-success d-none" role="alert">
                        <i class="fas fa-check-circle me-2"></i>
                        <span id="weeklyPaymentSuccessMessage">Payment updated successfully!</span>
                        <button type="button" class="btn btn-sm btn-outline-success ms-2" onclick="closeWeeklyPaymentModal()">
                            OK
                        </button>
                    </div>
                    
                    <form id="weeklyPaymentForm">
                        <div class="row">
                            <!-- Left Column: Payment Status & Details -->
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Week <span id="weeklyPaymentWeek"></span> Payment Status</label>
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidYes" value="true">
                                                <label class="form-check-label" for="weeklyPaidYes">
                                                    <span class="badge bg-success">Paid</span>
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidNo" value="false" checked>
                                                <label class="form-check-label" for="weeklyPaidNo">
                                                    <span class="badge bg-danger">Not Paid</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidBye" value="bye">
                                                <label class="form-check-label" for="weeklyPaidBye">
                                                    <span class="badge bg-info"><strong>Bye Week</strong></span>
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="weeklyPaid" id="weeklyPaidMakeup" value="makeup">
                                                <label class="form-check-label" for="weeklyPaidMakeup">
                                                    <span class="badge bg-warning"><strong>Make Up</strong></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <small class="text-muted">Bye Week = No dues required | Make Up = Dues still owed</small>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="weeklyPaymentMethod" class="form-label">Payment Method</label>
                                    <select class="form-select" id="weeklyPaymentMethod">
                                        <option value="Cash">Cash</option>
                                        <option value="Check">Check</option>
                                        <option value="Venmo">Venmo</option>
                                        <option value="CashApp">CashApp</option>
                                        <option value="PayPal">PayPal</option>
                                        <option value="Zelle">Zelle</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="weeklyPaymentAmount" class="form-label">Amount</label>
                                    <select class="form-select" id="weeklyPaymentAmount" onchange="updateWeeklyPaymentAmount()">
                                        <option value="">Select Amount</option>
                                        <!-- Options will be populated dynamically -->
                                    </select>
                                    <small class="text-muted">Select amount based on individual dues</small>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="weeklyPaymentNotes" class="form-label">Notes</label>
                                    <textarea class="form-control" id="weeklyPaymentNotes" rows="2"></textarea>
                                </div>
                            </div>
                            
                            <!-- Right Column: BCA Sanction Fees -->
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label"><strong>BCA Sanction Fees ($25 per player)</strong></label>
                                    <div id="bcaSanctionPlayers" class="border rounded p-3" style="max-height: 200px; overflow-y: auto; background-color: #f8f9fa;">
                                        <!-- Player checkboxes will be populated here -->
                                    </div>
                                    <small class="text-muted">Select which players this payment includes BCA sanction fees for</small>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveWeeklyPayment()">Save Payment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Division Management Modal -->
    <div class="modal fade" id="divisionManagementModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Division Management</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-12">
                            <button class="btn btn-primary" onclick="showAddDivisionModal()">
                                <i class="fas fa-plus me-2"></i>Add New Division
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Division Name</th>
                                    <th>Dues Rate</th>
                                    <th>Type</th>
                                    <th>Number of Teams</th>
                                    <th>Total Weeks</th>
                                    <th>Current Teams</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="divisionsTable">
                                <!-- Divisions will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Division Modal -->
    <div class="modal fade" id="addDivisionModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="divisionModalTitle">Add New Division</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addDivisionForm">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="divisionName" class="form-label">Division Name *</label>
                                    <input type="text" class="form-control" id="divisionName" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="firstGameType" class="form-label">Game Type *</label>
                                    <select class="form-select" id="firstGameType" required onchange="updateGameTypeOptions()">
                                        <option value="">Select Game Type</option>
                                        <option value="8-ball">8-ball</option>
                                        <option value="9-ball">9-ball</option>
                                        <option value="10-ball">10-ball</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="isDoublePlay" onchange="toggleDoublePlayOptions()">
                                <label class="form-check-label" for="isDoublePlay">
                                    <strong>Double Play Division</strong> (Teams play both 8-ball and 10-ball each week)
                                </label>
                            </div>
                            <small class="text-muted">Check this if teams play 10 matches per week (5 of each game) instead of 5 matches</small>
                        </div>
                        
                        <!-- Double Play Options (hidden by default) -->
                        <div id="doublePlayOptions" style="display: none;">
                            <div class="mb-3">
                                <label for="doublePlayDivisionName" class="form-label">Double Play Division Name *</label>
                                <input type="text" class="form-control" id="doublePlayDivisionName" placeholder="e.g., Tuesday Night League">
                            </div>
                            <div class="mb-3">
                                <label for="secondGameType" class="form-label">Second Game Type *</label>
                                <select class="form-select" id="secondGameType" required onchange="updateGameTypeOptions()">
                                    <option value="">Select Second Game Type</option>
                                    <option value="8-ball">8-ball</option>
                                    <option value="9-ball">9-ball</option>
                                    <option value="10-ball">10-ball</option>
                                </select>
                            </div>
                            <div class="alert alert-warning">
                                <small><i class="fas fa-info-circle me-1"></i><strong>Final Division Name:</strong> Will be formatted as "Double Play Division Name - Game Type 1 & Game Type 2" (e.g., "Tuesday Night League - 8-ball & 10-ball")</small>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="duesPerPlayerPerMatch" class="form-label">Dues Per Player ($) *</label>
                                    <select class="form-select" id="duesPerPlayerPerMatch" required>
                                        <option value="">Select Dues</option>
                                        <option value="8">$8</option>
                                        <option value="10">$10</option>
                                        <option value="11">$11</option>
                                        <option value="12">$12</option>
                                        <option value="13">$13</option>
                                        <option value="14">$14</option>
                                        <option value="15">$15</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="numberOfTeams" class="form-label">Number of Teams *</label>
                                    <select class="form-select" id="numberOfTeams" required>
                                        <option value="">Select Teams</option>
                                        <option value="4">4 Teams</option>
                                        <option value="5">5 Teams</option>
                                        <option value="6">6 Teams</option>
                                        <option value="7">7 Teams</option>
                                        <option value="8">8 Teams</option>
                                        <option value="9">9 Teams</option>
                                        <option value="10">10 Teams</option>
                                        <option value="11">11 Teams</option>
                                        <option value="12">12 Teams</option>
                                        <option value="13">13 Teams</option>
                                        <option value="14">14 Teams</option>
                                        <option value="15">15 Teams</option>
                                        <option value="16">16 Teams</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="totalWeeks" class="form-label">Total Weeks *</label>
                                    <select class="form-select" id="totalWeeks" required onchange="calculateEndDate()">
                                        <option value="">Select Weeks</option>
                                        <option value="10">10 Weeks</option>
                                        <option value="11">11 Weeks</option>
                                        <option value="12">12 Weeks</option>
                                        <option value="13">13 Weeks</option>
                                        <option value="14">14 Weeks</option>
                                        <option value="15">15 Weeks</option>
                                        <option value="16">16 Weeks</option>
                                        <option value="17">17 Weeks</option>
                                        <option value="18">18 Weeks</option>
                                        <option value="19">19 Weeks</option>
                                        <option value="20">20 Weeks</option>
                                        <option value="21">21 Weeks</option>
                                        <option value="22">22 Weeks</option>
                                        <option value="23">23 Weeks</option>
                                        <option value="24">24 Weeks</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="startDate" class="form-label">Season Start Date *</label>
                                    <input type="date" class="form-control" id="startDate" required onchange="calculateEndDate()">
                                    <div id="startDateDay" class="mt-1" style="display: none;">
                                        <small class="text-primary"><i class="fas fa-calendar-day me-1"></i><strong>Starts on:</strong> <span id="startDayName"></span></small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="endDate" class="form-label">Season End Date</label>
                                    <input type="date" class="form-control" id="endDate" readonly>
                                    <small class="text-muted">Calculated automatically based on start date and weeks</small>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="divisionDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="divisionDescription" rows="3"></textarea>
                        </div>
                        <div class="alert alert-info">
                            <small><i class="fas fa-info-circle me-1"></i><strong>Total Dues Calculation:</strong> Dues per player per match × Matches per week × Total weeks = Total dues per player for the season<br>
                            <strong>Regular Division:</strong> 5 matches per week | <strong>Double Play Division:</strong> 10 matches per week (5 of each game)</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="divisionSubmitBtn" onclick="addDivision()">Create Division</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment History Modal -->
    <div class="modal fade" id="paymentHistoryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Payment History - <span id="paymentHistoryTeamName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Team info header -->
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-users text-primary me-2"></i>
                                        <div>
                                            <small class="text-muted">Division</small><br>
                                            <span id="paymentHistoryDivision" class="fw-bold"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-dollar-sign text-success me-2"></i>
                                        <div>
                                            <small class="text-muted">Dues Rate</small><br>
                                            $<span id="paymentHistoryDuesRate" class="fw-bold"></span>/player
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="row">
                                <div class="col-6">
                                    <div class="text-center">
                                        <small class="text-muted">Total Weeks</small><br>
                                        <span id="paymentHistoryTotalWeeks" class="fw-bold fs-5"></span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="text-center">
                                        <small class="text-muted">Weekly Dues</small><br>
                                        $<span id="paymentHistoryWeeklyDues" class="fw-bold fs-5"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-3">
                    
                    <!-- Payment history table -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0"><i class="fas fa-history me-2"></i>Payment History</h6>
                        <div class="d-flex gap-3">
                            <small><strong>Total Paid:</strong> $<span id="paymentHistoryTotalPaid">0</span></small>
                            <small><strong>Weeks Paid:</strong> <span id="paymentHistoryWeeksPaid">0</span></small>
                            <div>
                                <strong>Status:</strong> <span id="paymentHistoryStatus" class="badge">Current</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-striped table-sm">
                            <thead class="table-dark">
                                <tr>
                                    <th style="width: 8%;">Week</th>
                                    <th style="width: 12%;">Date</th>
                                    <th style="width: 12%;">Status</th>
                                    <th style="width: 10%;">Amount</th>
                                    <th style="width: 10%;">Method</th>
                                    <th style="width: 12%;">Paid Date</th>
                                    <th style="width: 20%;">Notes</th>
                                    <th style="width: 16%;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="paymentHistoryTable">
                                <!-- Payment history will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Players View Modal -->
    <div class="modal fade" id="playersModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-users me-2"></i>All Players - BCA Sanction Status
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Summary Cards -->
                    <div class="row mb-4">
                        <div class="col-md-2">
                            <div class="card bg-primary text-white text-center p-3">
                                <h6>Total Players</h6>
                                <h3 id="totalPlayersCount">0</h3>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card bg-success text-white text-center p-3">
                                <h6>Sanction Paid</h6>
                                <h3 id="sanctionPaidCount">0</h3>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card bg-warning text-dark text-center p-3">
                                <h6>Sanction Pending</h6>
                                <h3 id="sanctionPendingCount">0</h3>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card bg-info text-white text-center p-3">
                                <h6>Previously Sanctioned</h6>
                                <h3 id="previouslySanctionedCount">0</h3>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card bg-secondary text-white text-center p-3">
                                <h6>Total Collected</h6>
                                <h3 id="sanctionFeesCollected">$0</h3>
                            </div>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="playersDivisionFilter" class="form-label">Filter by Division</label>
                            <select class="form-select" id="playersDivisionFilter" onchange="filterPlayersTable()">
                                <option value="all">All Divisions</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="playersStatusFilter" class="form-label">Filter by Status</label>
                            <select class="form-select" id="playersStatusFilter" onchange="filterPlayersTable()">
                                <option value="all">All Players</option>
                                <option value="paid">Sanction Paid</option>
                                <option value="pending">Sanction Pending</option>
                                <option value="previously">Previously Sanctioned</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="playersSearch" class="form-label">Search Players</label>
                            <input type="text" class="form-control" id="playersSearch" placeholder="Search by name..." onkeyup="filterPlayersTable()">
                        </div>
                    </div>

                    <!-- Players Table -->
                    <div class="table-responsive">
                        <table class="table table-striped table-hover" id="playersTable">
                            <thead class="table-dark">
                                <tr>
                                    <th>Player Name</th>
                                    <th>Team</th>
                                    <th>Division</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Sanction Status</th>
                                    <th>Previously Sanctioned</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="playersTableBody">
                                <!-- Players will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
